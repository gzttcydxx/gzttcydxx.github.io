<head>
  <meta http-equiv="Content-Type"content="text/html;charset=utf-8"/>
</head>
<body style="margin: 50px;">
<h1>原文链接：<a href="https://blog.csdn.net/swinfans/article/details/89629641" target="_blank">Pydantic官方文档中文翻译</a></h1>
<article class="baidu_pl">
    <div id="article_content" class="article_content clearfix">
    <link rel="stylesheet" href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/ck_htmledit_views-163de54645.css">
            <div id="content_views" class="markdown_views prism-atom-one-dark" style="user-select: auto;">
                <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                    <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                </svg>
                <h1><a name="t0"></a><a id="1__0"></a>1. 简介</h1> 
<p><strong>1.7.1</strong> 版本的文档。</p> 
<p>使用Python类型注解进行数据验证和设置管理。</p> 
<p>Pydantic 在运行时强制执行类型提示，并在数据无效时提供用户友好的错误信息。</p> 
<p>定义数据如何表示为纯粹和规范的 Python ，并使用 pydantic 对其进行验证。</p> 
<h2><a name="t1"></a><a id="11__10"></a>1.1 示例：</h2> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime
<span class="token keyword">from</span> typing <span class="token keyword">import</span> List<span class="token punctuation">,</span> Optional
<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel


<span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token builtin">id</span><span class="token punctuation">:</span> <span class="token builtin">int</span>
name <span class="token operator">=</span> <span class="token string">'John Doe'</span>
signup_ts<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>datetime<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span>
friends<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>


external_data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
<span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token string">'123'</span><span class="token punctuation">,</span>
<span class="token string">'signup_ts'</span><span class="token punctuation">:</span> <span class="token string">'2019-06-01 12:22'</span><span class="token punctuation">,</span>
<span class="token string">'friends'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'3'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
user <span class="token operator">=</span> User<span class="token punctuation">(</span><span class="token operator">**</span>external_data<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; 123</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">repr</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>signup_ts<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; datetime.datetime(2019, 6, 1, 12, 22)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>friends<span class="token punctuation">)</span>
<span class="token comment">#&gt; [1, 2, 3]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
{
'id': 123,
'signup_ts': datetime.datetime(2019, 6, 1, 12, 22),
'friends': [1, 2, 3],
'name': 'John Doe',
}
"""</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li><li style="color: rgb(153, 153, 153);">33</li></ul></pre> 
<p>这里发生了什么：</p> 
<ul><li><code style="user-select: auto;" onclick="mdcp.copyCode(event)">id</code> 是 <em>int</em> 类型；注释声明告诉pydantic该字段是必须的。如果可能，字符串、字节或浮点数将强制转换为int，否则将引发异常。</li><li><code style="user-select: auto;" onclick="mdcp.copyCode(event)">name</code> 从默认值推断为其为 <em>str</em> 类型，该字段不是必须的，因为它有默认值。</li><li><code style="user-select: auto;" onclick="mdcp.copyCode(event)">signup_ts</code> 是 <em>datetime</em> 类型，该字段不是必须的，默认值为 <em>None</em>。pydantic会将表示unix时间戳（例如1496498400）的 <em>int</em> 类型或表示时间和日期的字符串处理成 <em>datetime</em> 类型。</li><li><em>friends</em> 使用Python的 <em>typing</em> 系统，需要一个整数列表，就像 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">id</code> 字段一样，类整数的对象将会被转换为整数。</li></ul> 
<p>如果验证失败，pydantic会抛出一个错误，列出错误的原因：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> pydantic <span class="token keyword">import</span> ValidationError
<span class="token keyword">try</span><span class="token punctuation">:</span>
User<span class="token punctuation">(</span>signup_ts<span class="token operator">=</span><span class="token string">'broken'</span><span class="token punctuation">,</span> friends<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'not number'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> ValidationError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li></ul></pre> 
<p>输出：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-json has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token punctuation">[</span>
<span class="token punctuation">{<!-- --></span>
<span class="token string">"loc"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
  <span class="token string">"id"</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token string">"msg"</span><span class="token punctuation">:</span> <span class="token string">"field required"</span><span class="token punctuation">,</span>
<span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"value_error.missing"</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">{<!-- --></span>
<span class="token string">"loc"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
  <span class="token string">"signup_ts"</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token string">"msg"</span><span class="token punctuation">:</span> <span class="token string">"invalid datetime format"</span><span class="token punctuation">,</span>
<span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"value_error.datetime"</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">{<!-- --></span>
<span class="token string">"loc"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
  <span class="token string">"friends"</span><span class="token punctuation">,</span>
  <span class="token number">2</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token string">"msg"</span><span class="token punctuation">:</span> <span class="token string">"value is not a valid integer"</span><span class="token punctuation">,</span>
<span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"type_error.integer"</span>
<span class="token punctuation">}</span>
<span class="token punctuation">]</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li></ul></pre> 
<h2><a name="t2"></a><a id="12__94"></a>1.2 基本原理</h2> 
<p>pydantic使用了一些很酷的新语言特性，但我为什么要使用它呢？</p> 
<ul><li> <p>与你的IDE/linter/brain配合得很好</p> <p>不需要学习新的模式定义微语言。如果您知道如何使用 Python 的类型提示，也就知道如何使用 pydantic。</p> <p>因为pydantic数据结构只是您使用类型注解定义的类的实例，所以自动完成、linting、mypy、IDE(尤其是 PyCharm)和您的直觉都应该能够正确地处理经过验证的数据。</p> </li><li> <p>多用途</p> <p>pydantic的 [BaseSettings](# 3.9 设置管理) 类允许在 “验证此请求数据” 上下文和 “加载我的系统设置” 上下文中使用。主要区别在于，系统设置可以从环境变量读取，并且通常需要更复杂的对象，如DSN和Python对象。</p> </li><li> <p>快速</p> <p>pydantic比其他所有测试库都要快。</p> </li><li> <p>可以验证复杂结构</p> <p>使用[递归pydantic模型](# 3.1.2 递归模型)、<code style="user-select: auto;" onclick="mdcp.copyCode(event)">typing</code> 的标准类型 (如 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">List</code>、<code style="user-select: auto;" onclick="mdcp.copyCode(event)">Tuple</code> 和 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Dict</code> 等) 和验证器，可以很清晰且容易地定义、验证和解析复杂数据模式。</p> </li><li> <p>可拓展</p> <p>pydantic允许定义[自定义数据类型](# 3.2.7 自定义数据类型)，或者您可以使用被 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">validator</code> 装饰器装饰的模型上的方法来扩展验证。</p> </li><li> <p>dataclasses 集成</p> <p>和 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">BaseModel</code> 一样，pydantic提供了一个 [<code style="user-select: auto;" onclick="mdcp.copyCode(event)">dataclass</code>](# 3.7 Dataclasses) 装饰器，它创建带有输入数据解析和验证的(几乎)普通的Python数据类。</p> </li></ul> 
<h1><a name="t3"></a><a id="2__124"></a>2. 安装</h1> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;">pip <span class="token function">install</span> pydantic
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>Pydantic除了Python3.6、3.7、3.8 或 3.9（和Python3.6中的 <em>dataclasses</em> 包）之外，不需要其他依赖项。</p> 
<p>Pydantic 可以可选的使用 Cython 进行编译，将会带来 30%-50%的性能提升。</p> 
<p>PyPI可以为Linux、MacOS和64位Windows提供二进制文件。如果您是手动安装，请在安装pydantic之前安装 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">cython</code>，这样编译就会自动进行。</p> 
<p>要测试pydantic 是否已经编译，可以使用如下方法：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">import</span> pydantic
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>pydantic<span class="token punctuation">.</span>compiled<span class="token punctuation">)</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li></ul></pre> 
<p>Pydantic 有三个可选依赖：</p> 
<ul><li>如果需要 email 验证，可以添加 <a href="https://github.com/JoshData/python-email-validator" target="_blank">email-validator</a>。</li><li>要在 Python3.8之前的版本中使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Literal</code>，需要安装 <a href="https://pypi.org/project/typing-extensions/" target="_blank">typing-extensions</a>。</li><li>使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Settings</code> 的 <a href="https://pydantic-docs.helpmanual.io/usage/settings/#dotenv-env-support" target="_blank">dotenv 文件支持</a>需要安装 <a href="https://pypi.org/project/python-dotenv" target="_blank">python-dotenv</a>。</li></ul> 
<p>要将这些与 pydantic 一起安装，可以使用如下方式：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;">pip <span class="token function">install</span> pydantic<span class="token punctuation">[</span>email<span class="token punctuation">]</span>
<span class="token comment"># or</span>
pip <span class="token function">install</span> pydantic<span class="token punctuation">[</span>typing_extensions<span class="token punctuation">]</span>
<span class="token comment"># or</span>
pip <span class="token function">install</span> pydantic<span class="token punctuation">[</span>dotenv<span class="token punctuation">]</span>
<span class="token comment"># or just</span>
pip <span class="token function">install</span> pydantic<span class="token punctuation">[</span>email,typing_extensions,dotenv<span class="token punctuation">]</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li></ul></pre> 
<p>当然，你可以使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">pip install email-validator</code> 和/或 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">pip install typing_extensions</code> 手动安装这些依赖。</p> 
<p>如果想从存储库直接安装 pydantic，可以使用：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;">pip <span class="token function">install</span> git+git://github.com/samuelcolvin/pydantic@master<span class="token comment">#egg=pydantic</span>
<span class="token comment"># or with extras</span>
pip <span class="token function">install</span> git+git://github.com/samuelcolvin/pydantic@master<span class="token comment">#egg=pydantic[email,typing_extensions]</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li></ul></pre> 
<h1><a name="t4"></a><a id="3__171"></a>3. 用法详解</h1> 
<h2><a name="t5"></a><a id="31__173"></a>3.1 模型</h2> 
<p>在pydantic中定义对象的主要方法是通过模型(模型只是继承自 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">BaseModel</code> 的类)。</p> 
<p>您可以将模型看作严格类型语言中的类型，或者看作API中单个端点的需求。</p> 
<p>不受信任的数据可以传递给模型，在解析和验证之后，pydantic保证结果模型实例的字段将符合模型上定义的字段类型。</p> 
<blockquote> 
<p><mark>注意</mark></p> 
<p>pydantic主要是一个解析库，而<strong>不是验证库</strong>。验证是达到目的的一种手段：构建符合所提供的类型和约束的模型。</p> 
<p>换句话说，pydantic保证输出模型的类型和约束，而不是输入数据。</p> 
<p>这听起来像是一个深奥的区别，但其实不然。如果您不确定这是什么意思或者它如何影响您的使用，那么您应该阅读下面关于[数据转换](# 3.1.16 数据转换)的部分。</p> 
</blockquote> 
<h3><a name="t6"></a><a id="311__189"></a>3.1.1 基本模型的使用</h3> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel

<span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token builtin">id</span><span class="token punctuation">:</span> <span class="token builtin">int</span>
name <span class="token operator">=</span> <span class="token string">'Jane Doe'</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li></ul></pre> 
<p>在这里，<code style="user-select: auto;" onclick="mdcp.copyCode(event)">User</code> 是具有两个字段的模型，其中字段 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">id</code> 是整数类型，并且是必需的；<code style="user-select: auto;" onclick="mdcp.copyCode(event)">name</code> 字段是字符串类型，但不是必需的(它有默认值)。<code style="user-select: auto;" onclick="mdcp.copyCode(event)">name</code> 的类型是从其默认值推断来的，因此，类型注解不是必需的(但是，当某些字段没有类型注解时，请注意[这个](# 3.1.11 字段排序)关于字段顺序的警告)。</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;">user <span class="token operator">=</span> User<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token string">'123'</span><span class="token punctuation">)</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>这里的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">user</code> 是 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">User</code> 的一个实例。对象的初始化会执行所有解析和验证，如果没有引发 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">ValidationError</code> 异常，则表明结果模型实例是有效的。</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">assert</span> user<span class="token punctuation">.</span><span class="token builtin">id</span> <span class="token operator">==</span> <span class="token number">123</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>模型的字段可以作为<code style="user-select: auto;" onclick="mdcp.copyCode(event)">User</code> 对象的普通属性访问。字符串 ‘123’ 根据字段类型被强制转换为 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">int</code> 类型：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">assert</span> user<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">'Jane Doe'</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>初始化 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">User</code> 对象时未设置 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">name</code> 的值，所以它的值是默认值：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;">assert user.__fields_set__ == {'id'}
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">User</code> 对象初始化时提供的字段：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">assert</span> user<span class="token punctuation">.</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token punctuation">{<!-- --></span><span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">123</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Jane Doe'</span><span class="token punctuation">}</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">.dict()</code> 或 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">dict(user)</code> 都将会提供一个字段的字典，但 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">.dict()</code> 可以接受许多其他参数：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;">user<span class="token punctuation">.</span><span class="token builtin">id</span> <span class="token operator">=</span> <span class="token number">321</span>
<span class="token keyword">assert</span> user<span class="token punctuation">.</span><span class="token builtin">id</span> <span class="token operator">==</span> <span class="token number">321</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li></ul></pre> 
<p>这个模型是可变模型，所以字段值可以更改。</p> 
<h4><a id="3111__238"></a>3.1.1.1 模型属性</h4> 
<p>上面的例子只展示了模型所能做的事情的冰山一角。模型具有以下方法和属性：</p> 
<ul><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">dict()</code></p> <p>返回模型的字段和值的字典。参见 [导出模型](# 3.6.1 model.dict(…))。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">json()</code></p> <p>返回表示 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">dict()</code> 的 JSON 字符串。参见 [导出模型](# 3.6.1 model.dict(…))。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">copy()</code></p> <p>返回模型的副本(默认情况下为浅副本)。参见 [导出模型](# 3.6.1 model.dict(…))。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">parse_obj()</code></p> <p>如果一个对象不是字典，可以使用该方法将其加载到具有错误处理的模型中。参见 [帮助函数](# 3.1.5 帮助函数)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">parse_raw()</code></p> <p>用于加载多种格式字符串的实用程序。参见 [帮助函数](# 3.1.5 帮助函数)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">parse_file()</code></p> <p>与 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">parse_raw()</code> 类似，但是作用于文件路径。参见 [帮助函数](# 3.1.5 帮助函数)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">from_orm()</code></p> <p>从任意类加载数据到模型中。参见 [<a href="https://so.csdn.net/so/search?q=ORM&amp;spm=1001.2101.3001.7020" target="_blank" class="hl hl-1" data-report-view="{&quot;spm&quot;:&quot;1001.2101.3001.7020&quot;,&quot;dest&quot;:&quot;https://so.csdn.net/so/search?q=ORM&amp;spm=1001.2101.3001.7020&quot;}" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.7020&quot;,&quot;dest&quot;:&quot;https://so.csdn.net/so/search?q=ORM&amp;spm=1001.2101.3001.7020&quot;}" data-tit="ORM" data-pretit="orm">ORM</a> 模式](# 3.1.3 ORM 模式)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">schema()</code></p> <p>返回一个将模型表示为 JSON 模式的字典。参见 [模式](# 3.5 模式)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">schema_json()</code></p> <p>返回表示 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">schema()</code> 的 JSON 字符串。参见 [模式](# 3.5 模式)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">construct()</code></p> <p>用于创建模型而不执行验证的类方法；参见 [创建未经验证的模型](# 3.1.5.1 创建未经验证的模型)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">__fields_set__</code></p> <p>当模型实例初始化时设置的字段名称集合。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">__config__</code></p> <p>模型的配置类。参见 [模型配置](# 3.4 模型配置)。</p> </li></ul> 
<h3><a name="t7"></a><a id="312__290"></a>3.1.2 递归模型</h3> 
<p>可以通过在注解中使用模型本身作为类型来定义更复杂的分层数据结构。</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> typing <span class="token keyword">import</span> List
<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel


<span class="token keyword">class</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
count<span class="token punctuation">:</span> <span class="token builtin">int</span>
size<span class="token punctuation">:</span> <span class="token builtin">float</span> <span class="token operator">=</span> <span class="token boolean">None</span>


<span class="token keyword">class</span> <span class="token class-name">Bar</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
apple <span class="token operator">=</span> <span class="token string">'x'</span>
banana <span class="token operator">=</span> <span class="token string">'y'</span>


<span class="token keyword">class</span> <span class="token class-name">Spam</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
foo<span class="token punctuation">:</span> Foo
bars<span class="token punctuation">:</span> List<span class="token punctuation">[</span>Bar<span class="token punctuation">]</span>


m <span class="token operator">=</span> Spam<span class="token punctuation">(</span>foo<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'count'</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">}</span><span class="token punctuation">,</span> bars<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">'apple'</span><span class="token punctuation">:</span> <span class="token string">'x1'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">'apple'</span><span class="token punctuation">:</span> <span class="token string">'x2'</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span>
<span class="token comment">#&gt; foo=Foo(count=4, size=None) bars=[Bar(apple='x1', banana='y'),</span>
<span class="token comment">#&gt; Bar(apple='x2', banana='y')]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
{
'foo': {'count': 4, 'size': None},
'bars': [
    {'apple': 'x1', 'banana': 'y'},
    {'apple': 'x2', 'banana': 'y'},
],
}
"""</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li><li style="color: rgb(153, 153, 153);">33</li></ul></pre> 
<p>对于自引用模型，参见 [延迟注解](# 3.10 延迟注解)。</p> 
<h3><a name="t8"></a><a id="313_ORM__332"></a>3.1.3 ORM 模式</h3> 
<p>可以从任意类实例创建Pydantic模型，以支持映射到ORM对象的模型。</p> 
<p>要达到这个目的，需要：</p> 
<ul><li>模型的内部类 [<code style="user-select: auto;" onclick="mdcp.copyCode(event)">Config</code>](# 3.4 模型配置) 的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">orm_mode</code> 属性必须设置为 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">True</code>。</li><li>必须使用特殊的构造函数 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">from_orm</code> 来创建模型实例。</li></ul> 
<p>这里的示例使用SQLAlchemy，但是相同的方法应该适用于任何ORM。</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> typing <span class="token keyword">import</span> List
<span class="token keyword">from</span> sqlalchemy <span class="token keyword">import</span> Column<span class="token punctuation">,</span> Integer<span class="token punctuation">,</span> String
<span class="token keyword">from</span> sqlalchemy<span class="token punctuation">.</span>dialects<span class="token punctuation">.</span>postgresql <span class="token keyword">import</span> ARRAY
<span class="token keyword">from</span> sqlalchemy<span class="token punctuation">.</span>ext<span class="token punctuation">.</span>declarative <span class="token keyword">import</span> declarative_base
<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel<span class="token punctuation">,</span> constr

Base <span class="token operator">=</span> declarative_base<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">CompanyOrm</span><span class="token punctuation">(</span>Base<span class="token punctuation">)</span><span class="token punctuation">:</span>
__tablename__ <span class="token operator">=</span> <span class="token string">'companies'</span>
<span class="token builtin">id</span> <span class="token operator">=</span> Column<span class="token punctuation">(</span>Integer<span class="token punctuation">,</span> primary_key<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> nullable<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
public_key <span class="token operator">=</span> Column<span class="token punctuation">(</span>String<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> nullable<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> unique<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
name <span class="token operator">=</span> Column<span class="token punctuation">(</span>String<span class="token punctuation">(</span><span class="token number">63</span><span class="token punctuation">)</span><span class="token punctuation">,</span> unique<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
domains <span class="token operator">=</span> Column<span class="token punctuation">(</span>ARRAY<span class="token punctuation">(</span>String<span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">CompanyModel</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token builtin">id</span><span class="token punctuation">:</span> <span class="token builtin">int</span>
public_key<span class="token punctuation">:</span> constr<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span>
name<span class="token punctuation">:</span> constr<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">63</span><span class="token punctuation">)</span>
domains<span class="token punctuation">:</span> List<span class="token punctuation">[</span>constr<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

<span class="token keyword">class</span> <span class="token class-name">Config</span><span class="token punctuation">:</span>
    orm_mode <span class="token operator">=</span> <span class="token boolean">True</span>


co_orm <span class="token operator">=</span> CompanyOrm<span class="token punctuation">(</span>
<span class="token builtin">id</span><span class="token operator">=</span><span class="token number">123</span><span class="token punctuation">,</span>
public_key<span class="token operator">=</span><span class="token string">'foobar'</span><span class="token punctuation">,</span>
name<span class="token operator">=</span><span class="token string">'Testing'</span><span class="token punctuation">,</span>
domains<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'example.com'</span><span class="token punctuation">,</span> <span class="token string">'foobar.com'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>co_orm<span class="token punctuation">)</span>
<span class="token comment">#&gt; &lt;models_orm_mode.CompanyOrm object at 0x7f2e727a27c0&gt;</span>
co_model <span class="token operator">=</span> CompanyModel<span class="token punctuation">.</span>from_orm<span class="token punctuation">(</span>co_orm<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>co_model<span class="token punctuation">)</span>
<span class="token comment">#&gt; id=123 public_key='foobar' name='Testing' domains=['example.com',</span>
<span class="token comment">#&gt; 'foobar.com']</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li><li style="color: rgb(153, 153, 153);">33</li><li style="color: rgb(153, 153, 153);">34</li><li style="color: rgb(153, 153, 153);">35</li><li style="color: rgb(153, 153, 153);">36</li><li style="color: rgb(153, 153, 153);">37</li><li style="color: rgb(153, 153, 153);">38</li><li style="color: rgb(153, 153, 153);">39</li></ul></pre> 
<h4><a id="3131__385"></a>3.1.3.1 保留名称</h4> 
<p>您可能想使用保留的SQLAlchemy字段命名列。在这种情况下，可以使用字段别名：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">import</span> typing

<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel<span class="token punctuation">,</span> Field
<span class="token keyword">import</span> sqlalchemy <span class="token keyword">as</span> sa
<span class="token keyword">from</span> sqlalchemy<span class="token punctuation">.</span>ext<span class="token punctuation">.</span>declarative <span class="token keyword">import</span> declarative_base


<span class="token keyword">class</span> <span class="token class-name">MyModel</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
metadata<span class="token punctuation">:</span> typing<span class="token punctuation">.</span>Dict<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">]</span> <span class="token operator">=</span> Field<span class="token punctuation">(</span>alias<span class="token operator">=</span><span class="token string">'metadata_'</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Config</span><span class="token punctuation">:</span>
    orm_mode <span class="token operator">=</span> <span class="token boolean">True</span>


BaseModel <span class="token operator">=</span> declarative_base<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">SQLModel</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
__tablename__ <span class="token operator">=</span> <span class="token string">'my_table'</span>
<span class="token builtin">id</span> <span class="token operator">=</span> sa<span class="token punctuation">.</span>Column<span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span> sa<span class="token punctuation">.</span>Integer<span class="token punctuation">,</span> primary_key<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token comment"># 'metadata' is reserved by SQLAlchemy, hence the '_'</span>
metadata_ <span class="token operator">=</span> sa<span class="token punctuation">.</span>Column<span class="token punctuation">(</span><span class="token string">'metadata'</span><span class="token punctuation">,</span> sa<span class="token punctuation">.</span>JSON<span class="token punctuation">)</span>


sql_model <span class="token operator">=</span> SQLModel<span class="token punctuation">(</span>metadata_<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'key'</span><span class="token punctuation">:</span> <span class="token string">'val'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token builtin">id</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

pydantic_model <span class="token operator">=</span> MyModel<span class="token punctuation">.</span>from_orm<span class="token punctuation">(</span>sql_model<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>pydantic_model<span class="token punctuation">.</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; {'metadata': {'key': 'val'}}</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>pydantic_model<span class="token punctuation">.</span><span class="token builtin">dict</span><span class="token punctuation">(</span>by_alias<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; {'metadata_': {'key': 'val'}}</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li></ul></pre> 
<blockquote> 
<p><mark>注意</mark></p> 
<p>上面的示例之所以能够工作，是因为对于字段填充，别名优先于字段名。访问 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">SQLModel</code> 的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">metadata</code> 属性将导致<code style="user-select: auto;" onclick="mdcp.copyCode(event)">ValidationError</code>。</p> 
</blockquote> 
<h4><a id="3132__ORM__428"></a>3.1.3.2 递归 ORM 模型</h4> 
<p>ORM实例将使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">from_orm</code> 递归解析，也可以在顶层解析。</p> 
<p>这里使用一个普通类来演示这个原理，但是可以使用任何ORM类。</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> typing <span class="token keyword">import</span> List
<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel


<span class="token keyword">class</span> <span class="token class-name">PetCls</span><span class="token punctuation">:</span>
<span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> species<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    self<span class="token punctuation">.</span>name <span class="token operator">=</span> name
    self<span class="token punctuation">.</span>species <span class="token operator">=</span> species


<span class="token keyword">class</span> <span class="token class-name">PersonCls</span><span class="token punctuation">:</span>
<span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token builtin">float</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">,</span> pets<span class="token punctuation">:</span> List<span class="token punctuation">[</span>PetCls<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    self<span class="token punctuation">.</span>name <span class="token operator">=</span> name
    self<span class="token punctuation">.</span>age <span class="token operator">=</span> age
    self<span class="token punctuation">.</span>pets <span class="token operator">=</span> pets


<span class="token keyword">class</span> <span class="token class-name">Pet</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
name<span class="token punctuation">:</span> <span class="token builtin">str</span>
species<span class="token punctuation">:</span> <span class="token builtin">str</span>

<span class="token keyword">class</span> <span class="token class-name">Config</span><span class="token punctuation">:</span>
    orm_mode <span class="token operator">=</span> <span class="token boolean">True</span>


<span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
name<span class="token punctuation">:</span> <span class="token builtin">str</span>
age<span class="token punctuation">:</span> <span class="token builtin">float</span> <span class="token operator">=</span> <span class="token boolean">None</span>
pets<span class="token punctuation">:</span> List<span class="token punctuation">[</span>Pet<span class="token punctuation">]</span>

<span class="token keyword">class</span> <span class="token class-name">Config</span><span class="token punctuation">:</span>
    orm_mode <span class="token operator">=</span> <span class="token boolean">True</span>


bones <span class="token operator">=</span> PetCls<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'Bones'</span><span class="token punctuation">,</span> species<span class="token operator">=</span><span class="token string">'dog'</span><span class="token punctuation">)</span>
orion <span class="token operator">=</span> PetCls<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'Orion'</span><span class="token punctuation">,</span> species<span class="token operator">=</span><span class="token string">'cat'</span><span class="token punctuation">)</span>
anna <span class="token operator">=</span> PersonCls<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'Anna'</span><span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span> pets<span class="token operator">=</span><span class="token punctuation">[</span>bones<span class="token punctuation">,</span> orion<span class="token punctuation">]</span><span class="token punctuation">)</span>
anna_model <span class="token operator">=</span> Person<span class="token punctuation">.</span>from_orm<span class="token punctuation">(</span>anna<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>anna_model<span class="token punctuation">)</span>
<span class="token comment">#&gt; name='Anna' age=20.0 pets=[Pet(name='Bones', species='dog'),</span>
<span class="token comment">#&gt; Pet(name='Orion', species='cat')]</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li><li style="color: rgb(153, 153, 153);">33</li><li style="color: rgb(153, 153, 153);">34</li><li style="color: rgb(153, 153, 153);">35</li><li style="color: rgb(153, 153, 153);">36</li><li style="color: rgb(153, 153, 153);">37</li><li style="color: rgb(153, 153, 153);">38</li><li style="color: rgb(153, 153, 153);">39</li><li style="color: rgb(153, 153, 153);">40</li><li style="color: rgb(153, 153, 153);">41</li></ul></pre> 
<p>Pydantic使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">GetterDict</code> 类 (请参阅 <a href="https://github.com/samuelcolvin/pydantic/blob/master/pydantic/utils.py" target="_blank">util.py</a>) 处理任意类，该类试图为任何类提供一个类似于字典的接口。可以通过将 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">GetterDict</code> 的自定义子类设置为 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Config.getter_dict</code> 的值来覆盖默认行为(参考 [模型配置](# 3.4 模型配置))。</p> 
<p>您还可以使用带有 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">pre=True</code> 的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">root_validators</code> 定制类验证。在这种情况下，<code style="user-select: auto;" onclick="mdcp.copyCode(event)">validator</code> 函数将被传递一个可以复制和修改的<code style="user-select: auto;" onclick="mdcp.copyCode(event)">GetterDict</code> 实例。</p> 
<h3><a name="t9"></a><a id="314__482"></a>3.1.4 错误处理</h3> 
<p>每当在正在验证的数据中发现错误时，pydantic都会引发 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">ValidationError</code>。</p> 
<blockquote> 
<p><mark>注意</mark></p> 
<p>验证代码不应该引发 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">ValidationError</code> 本身，而是引发 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">ValueError</code>、<code style="user-select: auto;" onclick="mdcp.copyCode(event)">TypeError</code> 或 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">AssertionError</code>(或 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">ValueError</code> 或<code style="user-select: auto;" onclick="mdcp.copyCode(event)">TypeError</code> 的子类)，这些异常将被捕获并用于填充 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">ValidationError</code>。</p> 
</blockquote> 
<p>无论发现的错误数量如何，都只会出现一个异常，<code style="user-select: auto;" onclick="mdcp.copyCode(event)">ValidationError</code> 将包含关于所有错误及其发生方式的信息。</p> 
<p>你可以通过几种方式访问这些错误：</p> 
<ul><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">e.errors()</code></p> <p>返回输入数据中发现的错误的列表。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">e.json()</code></p> <p>返回一个表示 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">errors</code> 的 JSON。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">str(e)</code></p> <p>返回人类可读的错误表示。</p> </li></ul> 
<p>每一个错误对象包含：</p> 
<ul><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">loc</code></p> <p>错误的位置列表。列表中的第一项将是发生错误的字段，如果该字段是[子模型](# 3.1.2 递归模型)，则将出现后续项以指示错误的嵌套位置。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">type</code></p> <p>计算机可读的错误类型的标识符。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">msg</code></p> <p>人类可读的错误解释。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">ctx</code></p> <p>包含呈现错误消息所需的值的可选对象。</p> </li></ul> 
<p>下面是一个示例：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> typing <span class="token keyword">import</span> List
<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel<span class="token punctuation">,</span> ValidationError<span class="token punctuation">,</span> conint


<span class="token keyword">class</span> <span class="token class-name">Location</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
lat <span class="token operator">=</span> <span class="token number">0.1</span>
lng <span class="token operator">=</span> <span class="token number">10.1</span>


<span class="token keyword">class</span> <span class="token class-name">Model</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
is_required<span class="token punctuation">:</span> <span class="token builtin">float</span>
gt_int<span class="token punctuation">:</span> conint<span class="token punctuation">(</span>gt<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span>
list_of_ints<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span>
a_float<span class="token punctuation">:</span> <span class="token builtin">float</span> <span class="token operator">=</span> <span class="token boolean">None</span>
recursive_model<span class="token punctuation">:</span> Location <span class="token operator">=</span> <span class="token boolean">None</span>


data <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>
list_of_ints<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'bad'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
a_float<span class="token operator">=</span><span class="token string">'not a float'</span><span class="token punctuation">,</span>
recursive_model<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'lat'</span><span class="token punctuation">:</span> <span class="token number">4.2</span><span class="token punctuation">,</span> <span class="token string">'lng'</span><span class="token punctuation">:</span> <span class="token string">'New York'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
gt_int<span class="token operator">=</span><span class="token number">21</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>

<span class="token keyword">try</span><span class="token punctuation">:</span>
Model<span class="token punctuation">(</span><span class="token operator">**</span>data<span class="token punctuation">)</span>
<span class="token keyword">except</span> ValidationError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
5 validation errors for Model
is_required
  field required (type=value_error.missing)
gt_int
  ensure this value is greater than 42 (type=value_error.number.not_gt;
limit_value=42)
list_of_ints -&gt; 2
  value is not a valid integer (type=type_error.integer)
a_float
  value is not a valid float (type=type_error.float)
recursive_model -&gt; lng
  value is not a valid float (type=type_error.float)
"""</span>

<span class="token keyword">try</span><span class="token punctuation">:</span>
Model<span class="token punctuation">(</span><span class="token operator">**</span>data<span class="token punctuation">)</span>
<span class="token keyword">except</span> ValidationError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
[
  {
    "loc": [
      "is_required"
    ],
    "msg": "field required",
    "type": "value_error.missing"
  },
  {
    "loc": [
      "gt_int"
    ],
    "msg": "ensure this value is greater than 42",
    "type": "value_error.number.not_gt",
    "ctx": {
      "limit_value": 42
    }
  },
  {
    "loc": [
      "list_of_ints",
      2
    ],
    "msg": "value is not a valid integer",
    "type": "type_error.integer"
  },
  {
    "loc": [
      "a_float"
    ],
    "msg": "value is not a valid float",
    "type": "type_error.float"
  },
  {
    "loc": [
      "recursive_model",
      "lng"
    ],
    "msg": "value is not a valid float",
    "type": "type_error.float"
  }
]
"""</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li><li style="color: rgb(153, 153, 153);">33</li><li style="color: rgb(153, 153, 153);">34</li><li style="color: rgb(153, 153, 153);">35</li><li style="color: rgb(153, 153, 153);">36</li><li style="color: rgb(153, 153, 153);">37</li><li style="color: rgb(153, 153, 153);">38</li><li style="color: rgb(153, 153, 153);">39</li><li style="color: rgb(153, 153, 153);">40</li><li style="color: rgb(153, 153, 153);">41</li><li style="color: rgb(153, 153, 153);">42</li><li style="color: rgb(153, 153, 153);">43</li><li style="color: rgb(153, 153, 153);">44</li><li style="color: rgb(153, 153, 153);">45</li><li style="color: rgb(153, 153, 153);">46</li><li style="color: rgb(153, 153, 153);">47</li><li style="color: rgb(153, 153, 153);">48</li><li style="color: rgb(153, 153, 153);">49</li><li style="color: rgb(153, 153, 153);">50</li><li style="color: rgb(153, 153, 153);">51</li><li style="color: rgb(153, 153, 153);">52</li><li style="color: rgb(153, 153, 153);">53</li><li style="color: rgb(153, 153, 153);">54</li><li style="color: rgb(153, 153, 153);">55</li><li style="color: rgb(153, 153, 153);">56</li><li style="color: rgb(153, 153, 153);">57</li><li style="color: rgb(153, 153, 153);">58</li><li style="color: rgb(153, 153, 153);">59</li><li style="color: rgb(153, 153, 153);">60</li><li style="color: rgb(153, 153, 153);">61</li><li style="color: rgb(153, 153, 153);">62</li><li style="color: rgb(153, 153, 153);">63</li><li style="color: rgb(153, 153, 153);">64</li><li style="color: rgb(153, 153, 153);">65</li><li style="color: rgb(153, 153, 153);">66</li><li style="color: rgb(153, 153, 153);">67</li><li style="color: rgb(153, 153, 153);">68</li><li style="color: rgb(153, 153, 153);">69</li><li style="color: rgb(153, 153, 153);">70</li><li style="color: rgb(153, 153, 153);">71</li><li style="color: rgb(153, 153, 153);">72</li><li style="color: rgb(153, 153, 153);">73</li><li style="color: rgb(153, 153, 153);">74</li><li style="color: rgb(153, 153, 153);">75</li><li style="color: rgb(153, 153, 153);">76</li><li style="color: rgb(153, 153, 153);">77</li><li style="color: rgb(153, 153, 153);">78</li><li style="color: rgb(153, 153, 153);">79</li><li style="color: rgb(153, 153, 153);">80</li><li style="color: rgb(153, 153, 153);">81</li><li style="color: rgb(153, 153, 153);">82</li><li style="color: rgb(153, 153, 153);">83</li><li style="color: rgb(153, 153, 153);">84</li><li style="color: rgb(153, 153, 153);">85</li><li style="color: rgb(153, 153, 153);">86</li><li style="color: rgb(153, 153, 153);">87</li><li style="color: rgb(153, 153, 153);">88</li><li style="color: rgb(153, 153, 153);">89</li><li style="color: rgb(153, 153, 153);">90</li><li style="color: rgb(153, 153, 153);">91</li></ul></pre> 
<p><em><code style="user-select: auto;" onclick="mdcp.copyCode(event)">json()</code>方法默认设置了 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">indent=2</code>，但是我在这里和下面对JSON 进行了调整，使其更加简洁。</em></p> 
<h4><a id="3141__622"></a>3.1.4.1 定制错误</h4> 
<p>在您的自定义数据类型或验证器中，您应该使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">ValueError</code>、<code style="user-select: auto;" onclick="mdcp.copyCode(event)">TypeError</code> 或 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">AssertionError</code> 来引发错误。</p> 
<p>有关 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">@validator</code> 装饰器的使用细节，请参阅 [验证器](# 3.3 验证器)。</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel<span class="token punctuation">,</span> ValidationError<span class="token punctuation">,</span> validator


<span class="token keyword">class</span> <span class="token class-name">Model</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
foo<span class="token punctuation">:</span> <span class="token builtin">str</span>

@validator<span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">name_must_contain_space</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> v <span class="token operator">!=</span> <span class="token string">'bar'</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">'value must be "bar"'</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> v


<span class="token keyword">try</span><span class="token punctuation">:</span>
Model<span class="token punctuation">(</span>foo<span class="token operator">=</span><span class="token string">'ber'</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> ValidationError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>errors<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
[
    {
        'loc': ('foo',),
        'msg': 'value must be "bar"',
        'type': 'value_error',
    },
]
"""</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li></ul></pre> 
<p>您也可以定义自己的错误类，它可以指定自定义错误代码、消息模板和上下文：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel<span class="token punctuation">,</span> PydanticValueError<span class="token punctuation">,</span> ValidationError<span class="token punctuation">,</span> validator


<span class="token keyword">class</span> <span class="token class-name">NotABarError</span><span class="token punctuation">(</span>PydanticValueError<span class="token punctuation">)</span><span class="token punctuation">:</span>
code <span class="token operator">=</span> <span class="token string">'not_a_bar'</span>
msg_template <span class="token operator">=</span> <span class="token string">'value is not "bar", got "{wrong_value}"'</span>


<span class="token keyword">class</span> <span class="token class-name">Model</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
foo<span class="token punctuation">:</span> <span class="token builtin">str</span>

@validator<span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">name_must_contain_space</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> v <span class="token operator">!=</span> <span class="token string">'bar'</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> NotABarError<span class="token punctuation">(</span>wrong_value<span class="token operator">=</span>v<span class="token punctuation">)</span>
    <span class="token keyword">return</span> v


<span class="token keyword">try</span><span class="token punctuation">:</span>
Model<span class="token punctuation">(</span>foo<span class="token operator">=</span><span class="token string">'ber'</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> ValidationError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
[
  {
    "loc": [
      "foo"
    ],
    "msg": "value is not \"bar\", got \"ber\"",
    "type": "value_error.not_a_bar",
    "ctx": {
      "wrong_value": "ber"
    }
  }
]
"""</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li><li style="color: rgb(153, 153, 153);">33</li><li style="color: rgb(153, 153, 153);">34</li><li style="color: rgb(153, 153, 153);">35</li><li style="color: rgb(153, 153, 153);">36</li></ul></pre> 
<h3><a name="t10"></a><a id="315__699"></a>3.1.5 帮助函数</h3> 
<p>Pydantic 在模型上提供了三个 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">classmethod</code> 帮助函数用于解析数据：</p> 
<ul><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">parse_obj</code></p> <p>这与模型中的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">__init__</code> 方法非常相似，除了它使用的是 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">dict</code> 而不是关键字参数。如果传递的对象不是 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">dict</code>，则会引发<code style="user-select: auto;" onclick="mdcp.copyCode(event)">ValidationError</code>。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">parse_raw</code></p> <p>它接受一个 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">str</code> 或 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">bytes</code> 并将其解析为 <em>json</em>，然后将结果传递给 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">parse_obj</code>。适当地设置 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">content_type</code> 参数也支持解析<em>pickle</em> 数据。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">parse_file</code></p> <p>它接受一个文件路径，读取文件并将内容传递给 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">parse_raw</code>。如果省略了 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">content_type</code>，将从文件的扩展名进行推断。</p> </li></ul> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">import</span> pickle
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime
<span class="token keyword">from</span> pathlib <span class="token keyword">import</span> Path

<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel<span class="token punctuation">,</span> ValidationError


<span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token builtin">id</span><span class="token punctuation">:</span> <span class="token builtin">int</span>
name <span class="token operator">=</span> <span class="token string">'John Doe'</span>
signup_ts<span class="token punctuation">:</span> datetime <span class="token operator">=</span> <span class="token boolean">None</span>


m <span class="token operator">=</span> User<span class="token punctuation">.</span>parse_obj<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">123</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'James'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span>
<span class="token comment">#&gt; id=123 signup_ts=None name='James'</span>

<span class="token keyword">try</span><span class="token punctuation">:</span>
User<span class="token punctuation">.</span>parse_obj<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'not'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'dict'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> ValidationError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
1 validation error for User
__root__
  User expected dict not list (type=type_error)
"""</span>

<span class="token comment"># assumes json as no content type passed</span>
m <span class="token operator">=</span> User<span class="token punctuation">.</span>parse_raw<span class="token punctuation">(</span><span class="token string">'{"id": 123, "name": "James"}'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span>
<span class="token comment">#&gt; id=123 signup_ts=None name='James'</span>

pickle_data <span class="token operator">=</span> pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
<span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">123</span><span class="token punctuation">,</span>
<span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'James'</span><span class="token punctuation">,</span>
<span class="token string">'signup_ts'</span><span class="token punctuation">:</span> datetime<span class="token punctuation">(</span><span class="token number">2017</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
m <span class="token operator">=</span> User<span class="token punctuation">.</span>parse_raw<span class="token punctuation">(</span>
pickle_data<span class="token punctuation">,</span> content_type<span class="token operator">=</span><span class="token string">'application/pickle'</span><span class="token punctuation">,</span> allow_pickle<span class="token operator">=</span><span class="token boolean">True</span>
<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span>
<span class="token comment">#&gt; id=123 signup_ts=datetime.datetime(2017, 7, 14, 0, 0) name='James'</span>

path <span class="token operator">=</span> Path<span class="token punctuation">(</span><span class="token string">'data.json'</span><span class="token punctuation">)</span>
path<span class="token punctuation">.</span>write_text<span class="token punctuation">(</span><span class="token string">'{"id": 123, "name": "James"}'</span><span class="token punctuation">)</span>
m <span class="token operator">=</span> User<span class="token punctuation">.</span>parse_file<span class="token punctuation">(</span>path<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span>
<span class="token comment">#&gt; id=123 signup_ts=None name='James'</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li><li style="color: rgb(153, 153, 153);">33</li><li style="color: rgb(153, 153, 153);">34</li><li style="color: rgb(153, 153, 153);">35</li><li style="color: rgb(153, 153, 153);">36</li><li style="color: rgb(153, 153, 153);">37</li><li style="color: rgb(153, 153, 153);">38</li><li style="color: rgb(153, 153, 153);">39</li><li style="color: rgb(153, 153, 153);">40</li><li style="color: rgb(153, 153, 153);">41</li><li style="color: rgb(153, 153, 153);">42</li><li style="color: rgb(153, 153, 153);">43</li><li style="color: rgb(153, 153, 153);">44</li><li style="color: rgb(153, 153, 153);">45</li><li style="color: rgb(153, 153, 153);">46</li><li style="color: rgb(153, 153, 153);">47</li><li style="color: rgb(153, 153, 153);">48</li></ul></pre> 
<blockquote> 
<p><mark>警告</mark></p> 
<p>引用 <a href="https://docs.python.org/3/library/pickle.html" target="_blank"><code style="user-select: auto;" onclick="mdcp.copyCode(event)">pickle</code> 的官方文档</a>，“pickle模块对于错误或恶意构造的数据是不安全的。切勿从不可信或未经身份验证的来源获取数据。”</p> 
</blockquote> 
<blockquote> 
<p><mark>注意</mark></p> 
<p>由于它可能导致任意代码的执行，因此作为一种安全措施，您需要显式地将 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">allow_pickle</code> 传递给解析函数，以便加载pickle数据。</p> 
</blockquote> 
<h4><a id="3151__774"></a>3.1.5.1 创建未经验证的模型</h4> 
<p>Pydantic还提供了 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">construct()</code> 方法，允许创建<strong>未经验证</strong>的模型。当数据已经被验证或来自可信的源，并且你想要尽可能高效地创建一个模型 (使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">construct()</code> 方法创建模型通常比创建完整验证的模型块 30 倍)。</p> 
<blockquote> 
<p><mark>警告</mark></p> 
<p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">construct()</code> 不做任何验证，这意味着它可以创建无效的模型。<strong>您务必只对已经经过验证或您信任的数据使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">construct()</code> 方法</strong>。</p> 
</blockquote> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel


<span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token builtin">id</span><span class="token punctuation">:</span> <span class="token builtin">int</span>
age<span class="token punctuation">:</span> <span class="token builtin">int</span>
name<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">'John Doe'</span>


original_user <span class="token operator">=</span> User<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">123</span><span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span>

user_data <span class="token operator">=</span> original_user<span class="token punctuation">.</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>user_data<span class="token punctuation">)</span>
<span class="token comment">#&gt; {'id': 123, 'age': 32, 'name': 'John Doe'}</span>
fields_set <span class="token operator">=</span> original_user<span class="token punctuation">.</span>__fields_set__
<span class="token keyword">print</span><span class="token punctuation">(</span>fields_set<span class="token punctuation">)</span>
<span class="token comment">#&gt; {'id', 'age'}</span>

<span class="token comment"># ...</span>
<span class="token comment"># pass user_data and fields_set to RPC or save to the database etc.</span>
<span class="token comment"># ...</span>

<span class="token comment"># you can then create a new instance of User without</span>
<span class="token comment"># re-running validation which would be unnecessary at this point:</span>
new_user <span class="token operator">=</span> User<span class="token punctuation">.</span>construct<span class="token punctuation">(</span>_fields_set<span class="token operator">=</span>fields_set<span class="token punctuation">,</span> <span class="token operator">**</span>user_data<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">repr</span><span class="token punctuation">(</span>new_user<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; User(name='John Doe', id=123, age=32)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>new_user<span class="token punctuation">.</span>__fields_set__<span class="token punctuation">)</span>
<span class="token comment">#&gt; {'id', 'age'}</span>

<span class="token comment"># construct can be dangerous, only use it with validated data!:</span>
bad_user <span class="token operator">=</span> User<span class="token punctuation">.</span>construct<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token string">'dog'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">repr</span><span class="token punctuation">(</span>bad_user<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; User(name='John Doe', id='dog')</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li><li style="color: rgb(153, 153, 153);">33</li><li style="color: rgb(153, 153, 153);">34</li></ul></pre> 
<p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">construct()</code> 方法的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">_fields_set</code> 关键字参数是可选的，但是允许您更精确地知道哪些字段是初始化时设置的，哪些是具有默认值的。如果该参数被省略，那么 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">__fields_set__</code> 将只包含数据提供的键。</p> 
<p>例如，在上面的示例中，如果未提供 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">_fields_set</code> 参数，<code style="user-select: auto;" onclick="mdcp.copyCode(event)">new_user.__fields_set__</code> 将会是 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">{'id', 'age', 'name'}</code>。</p> 
<h3><a name="t11"></a><a id="316__823"></a>3.1.6 泛型模型</h3> 
<p>Pydantic支持创建泛型模型，以便更容易重用公共模型结构。</p> 
<blockquote> 
<p><mark>警告</mark></p> 
<p>泛型模型只在Python &gt;=3.7中得到支持，这是因为在python 3.6和python 3.7之间实现泛型的方式有许多细微的变化。</p> 
</blockquote> 
<p>为了声明泛型模型，必须执行下面的步骤：</p> 
<ul><li>声明一个或多个 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">typing.TypeVar</code> 实例来参数化您的模型。</li><li>声明一个继承自 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">pydantic.generics.GenericModel</code> 和 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">typing.Generic</code> 的 pydantic 模型，其中将 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">TypeVar</code> 实例作为参数传递给 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">typing.Generic</code> 。</li><li>使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">TypeVar</code> 实例对将要使用其他类型或pydantic模型进行替换的字段进行注解。</li></ul> 
<p>下面是一个使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">GenericModel</code> 创建一个易于重用的HTTP响应有效负载包装器的例子：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> typing <span class="token keyword">import</span> Generic<span class="token punctuation">,</span> TypeVar<span class="token punctuation">,</span> Optional<span class="token punctuation">,</span> List

<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel<span class="token punctuation">,</span> validator<span class="token punctuation">,</span> ValidationError
<span class="token keyword">from</span> pydantic<span class="token punctuation">.</span>generics <span class="token keyword">import</span> GenericModel

DataT <span class="token operator">=</span> TypeVar<span class="token punctuation">(</span><span class="token string">'DataT'</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
code<span class="token punctuation">:</span> <span class="token builtin">int</span>
message<span class="token punctuation">:</span> <span class="token builtin">str</span>


<span class="token keyword">class</span> <span class="token class-name">DataModel</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
numbers<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span>
people<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span>


<span class="token keyword">class</span> <span class="token class-name">Response</span><span class="token punctuation">(</span>GenericModel<span class="token punctuation">,</span> Generic<span class="token punctuation">[</span>DataT<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
data<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>DataT<span class="token punctuation">]</span>
error<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>Error<span class="token punctuation">]</span>

@validator<span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> always<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">check_consistency</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> v<span class="token punctuation">,</span> values<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> v <span class="token keyword">is</span> <span class="token operator">not</span> <span class="token boolean">None</span> <span class="token operator">and</span> values<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span> <span class="token keyword">is</span> <span class="token operator">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">'must not provide both data and error'</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> v <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token operator">and</span> values<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">)</span> <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">'must provide data or error'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> v


data <span class="token operator">=</span> DataModel<span class="token punctuation">(</span>numbers<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> people<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
error <span class="token operator">=</span> Error<span class="token punctuation">(</span>code<span class="token operator">=</span><span class="token number">404</span><span class="token punctuation">,</span> message<span class="token operator">=</span><span class="token string">'Not found'</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>Response<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">(</span>data<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; data=1 error=None</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>Response<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">(</span>data<span class="token operator">=</span><span class="token string">'value'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; data='value' error=None</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>Response<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">(</span>data<span class="token operator">=</span><span class="token string">'value'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; {'data': 'value', 'error': None}</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>Response<span class="token punctuation">[</span>DataModel<span class="token punctuation">]</span><span class="token punctuation">(</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
{
'data': {'numbers': [1, 2, 3], 'people': []},
'error': None,
}
"""</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>Response<span class="token punctuation">[</span>DataModel<span class="token punctuation">]</span><span class="token punctuation">(</span>error<span class="token operator">=</span>error<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
{
'data': None,
'error': {'code': 404, 'message': 'Not found'},
}
"""</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
Response<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">(</span>data<span class="token operator">=</span><span class="token string">'value'</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> ValidationError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
2 validation errors for Response[int]
data
  value is not a valid integer (type=type_error.integer)
error
  must provide data or error (type=value_error)
"""</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li><li style="color: rgb(153, 153, 153);">33</li><li style="color: rgb(153, 153, 153);">34</li><li style="color: rgb(153, 153, 153);">35</li><li style="color: rgb(153, 153, 153);">36</li><li style="color: rgb(153, 153, 153);">37</li><li style="color: rgb(153, 153, 153);">38</li><li style="color: rgb(153, 153, 153);">39</li><li style="color: rgb(153, 153, 153);">40</li><li style="color: rgb(153, 153, 153);">41</li><li style="color: rgb(153, 153, 153);">42</li><li style="color: rgb(153, 153, 153);">43</li><li style="color: rgb(153, 153, 153);">44</li><li style="color: rgb(153, 153, 153);">45</li><li style="color: rgb(153, 153, 153);">46</li><li style="color: rgb(153, 153, 153);">47</li><li style="color: rgb(153, 153, 153);">48</li><li style="color: rgb(153, 153, 153);">49</li><li style="color: rgb(153, 153, 153);">50</li><li style="color: rgb(153, 153, 153);">51</li><li style="color: rgb(153, 153, 153);">52</li><li style="color: rgb(153, 153, 153);">53</li><li style="color: rgb(153, 153, 153);">54</li><li style="color: rgb(153, 153, 153);">55</li><li style="color: rgb(153, 153, 153);">56</li><li style="color: rgb(153, 153, 153);">57</li><li style="color: rgb(153, 153, 153);">58</li><li style="color: rgb(153, 153, 153);">59</li><li style="color: rgb(153, 153, 153);">60</li><li style="color: rgb(153, 153, 153);">61</li><li style="color: rgb(153, 153, 153);">62</li><li style="color: rgb(153, 153, 153);">63</li><li style="color: rgb(153, 153, 153);">64</li><li style="color: rgb(153, 153, 153);">65</li></ul></pre> 
<p>如果您在泛型模型定义中设置 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Config</code> 或使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">validator</code>，则其将以从 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">BaseModel</code> 继承时相同的方式应用于具体的子类。在泛型类上定义的任何方法也将被继承。</p> 
<p>Pydantic的泛型也正确地与mypy集成，因此如果您不使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">GenericModel</code> 声明类型，就可以得到mypy所提供的所有类型检查。</p> 
<blockquote> 
<p><mark>注意</mark></p> 
<p>在内部，pydantic在运行时使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">create_model</code> 生成(缓存的)具体 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">BaseModel</code>，因此使用GenericModel基本上不会带来任何开销。</p> 
</blockquote> 
<p>为了在不替换 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">TypeVar</code> 实例的情况下继承 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">GenericModel</code>，类也必须继承 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">type.Generic</code>：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> typing <span class="token keyword">import</span> TypeVar<span class="token punctuation">,</span> Generic
<span class="token keyword">from</span> pydantic<span class="token punctuation">.</span>generics <span class="token keyword">import</span> GenericModel

TypeX <span class="token operator">=</span> TypeVar<span class="token punctuation">(</span><span class="token string">'TypeX'</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">BaseClass</span><span class="token punctuation">(</span>GenericModel<span class="token punctuation">,</span> Generic<span class="token punctuation">[</span>TypeX<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
X<span class="token punctuation">:</span> TypeX


<span class="token keyword">class</span> <span class="token class-name">ChildClass</span><span class="token punctuation">(</span>BaseClass<span class="token punctuation">[</span>TypeX<span class="token punctuation">]</span><span class="token punctuation">,</span> Generic<span class="token punctuation">[</span>TypeX<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token comment"># Inherit from Generic[TypeX]</span>
<span class="token keyword">pass</span>


<span class="token comment"># Replace TypeX by int</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ChildClass<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">(</span>X<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; X=1</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li></ul></pre> 
<p>您还可以创建 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">GenericModel</code> 的泛型子类，以部分或全部替换超类中的类型参数。</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> typing <span class="token keyword">import</span> TypeVar<span class="token punctuation">,</span> Generic
<span class="token keyword">from</span> pydantic<span class="token punctuation">.</span>generics <span class="token keyword">import</span> GenericModel

TypeX <span class="token operator">=</span> TypeVar<span class="token punctuation">(</span><span class="token string">'TypeX'</span><span class="token punctuation">)</span>
TypeY <span class="token operator">=</span> TypeVar<span class="token punctuation">(</span><span class="token string">'TypeY'</span><span class="token punctuation">)</span>
TypeZ <span class="token operator">=</span> TypeVar<span class="token punctuation">(</span><span class="token string">'TypeZ'</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">BaseClass</span><span class="token punctuation">(</span>GenericModel<span class="token punctuation">,</span> Generic<span class="token punctuation">[</span>TypeX<span class="token punctuation">,</span> TypeY<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
x<span class="token punctuation">:</span> TypeX
y<span class="token punctuation">:</span> TypeY


<span class="token keyword">class</span> <span class="token class-name">ChildClass</span><span class="token punctuation">(</span>BaseClass<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">,</span> TypeY<span class="token punctuation">]</span><span class="token punctuation">,</span> Generic<span class="token punctuation">[</span>TypeY<span class="token punctuation">,</span> TypeZ<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
z<span class="token punctuation">:</span> TypeZ


<span class="token comment"># Replace TypeY by str</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ChildClass<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token string">'y'</span><span class="token punctuation">,</span> z<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; x=1 y='y' z=3</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li></ul></pre> 
<p>如果具体子类的名称很重要，您还可以重写默认行为：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> typing <span class="token keyword">import</span> Generic<span class="token punctuation">,</span> TypeVar<span class="token punctuation">,</span> Type<span class="token punctuation">,</span> Any<span class="token punctuation">,</span> Tuple

<span class="token keyword">from</span> pydantic<span class="token punctuation">.</span>generics <span class="token keyword">import</span> GenericModel

DataT <span class="token operator">=</span> TypeVar<span class="token punctuation">(</span><span class="token string">'DataT'</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">Response</span><span class="token punctuation">(</span>GenericModel<span class="token punctuation">,</span> Generic<span class="token punctuation">[</span>DataT<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
data<span class="token punctuation">:</span> DataT
    
@<span class="token builtin">classmethod</span>
<span class="token keyword">def</span> <span class="token function">__concrete_name__</span><span class="token punctuation">(</span>cls<span class="token punctuation">:</span> Type<span class="token punctuation">[</span>Any<span class="token punctuation">]</span><span class="token punctuation">,</span> params<span class="token punctuation">:</span> Tuple<span class="token punctuation">[</span>Type<span class="token punctuation">[</span>Any<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">str</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> f<span class="token string">'{params[0].__name__.title()}Response'</span>


int_resp <span class="token operator">=</span> Response<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">(</span>data<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>int_resp<span class="token punctuation">)</span>
<span class="token comment">#&gt; data=1</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">repr</span><span class="token punctuation">(</span>int_resp<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; IntResponse(data=1)</span>
str_resp <span class="token operator">=</span> Response<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">(</span>data<span class="token operator">=</span><span class="token string">'a'</span><span class="token punctuation">)</span> 
<span class="token keyword">print</span><span class="token punctuation">(</span>str_resp<span class="token punctuation">)</span>
<span class="token comment">#&gt; data='a'</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">repr</span><span class="token punctuation">(</span>str_resp<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; StrResponse(data='a')</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li></ul></pre> 
<p>在嵌套模型中使用相同类型允许您在模型的不同点强制类型关系：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> typing <span class="token keyword">import</span> Generic<span class="token punctuation">,</span> TypeVar

<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> ValidationError
<span class="token keyword">from</span> pydantic<span class="token punctuation">.</span>generics <span class="token keyword">import</span> GenericModel

T <span class="token operator">=</span> TypeVar<span class="token punctuation">(</span><span class="token string">'T'</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">InnerT</span><span class="token punctuation">(</span>GenericModel<span class="token punctuation">,</span> Generic<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
inner<span class="token punctuation">:</span> T


<span class="token keyword">class</span> <span class="token class-name">OuterT</span><span class="token punctuation">(</span>GenericModel<span class="token punctuation">,</span> Generic<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
outer<span class="token punctuation">:</span> T
nested<span class="token punctuation">:</span> InnerT<span class="token punctuation">[</span>T<span class="token punctuation">]</span>


nested <span class="token operator">=</span> InnerT<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">(</span>inner<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>OuterT<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">(</span>outer<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> nested<span class="token operator">=</span>nested<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; outer=1 nested=InnerT[T][int](inner=1)</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
nested <span class="token operator">=</span> InnerT<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">(</span>inner<span class="token operator">=</span><span class="token string">'a'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>OuterT<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">(</span>outer<span class="token operator">=</span><span class="token string">'a'</span><span class="token punctuation">,</span> nested<span class="token operator">=</span>nested<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> ValidationError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
2 validation errors for OuterT[int]
outer
  value is not a valid integer (type=type_error.integer)
nested -&gt; inner
  value is not a valid integer (type=type_error.integer)
"""</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li></ul></pre> 
<p>Pydantic对待 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">GenericModel</code> 的方式与它对待内置泛型类型(如 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">List</code> 和 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Dict</code> )的方式类似，比如让它们保持未参数化，或者使用有界(bounded)类型实例：</p> 
<ul><li>如果在实例化泛型模型之前没有指定参数，那么它们将被视为 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Any</code>。</li><li>您可以使用一个或多个有界(<em>bounded</em>)参数对模型进行参数化，以添加子类检查。</li></ul> 
<p>另外，与 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">List</code> 和 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Dict</code> 一样，使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">TypeVar</code> 指定的任何参数都可以在以后用具体类型替换。</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> typing <span class="token keyword">import</span> Generic<span class="token punctuation">,</span> TypeVar

<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> ValidationError
<span class="token keyword">from</span> pydantic<span class="token punctuation">.</span>generics <span class="token keyword">import</span> GenericModel

AT <span class="token operator">=</span> TypeVar<span class="token punctuation">(</span><span class="token string">'AT'</span><span class="token punctuation">)</span>
BT <span class="token operator">=</span> TypeVar<span class="token punctuation">(</span><span class="token string">'BT'</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">Model</span><span class="token punctuation">(</span>GenericModel<span class="token punctuation">,</span> Generic<span class="token punctuation">[</span>AT<span class="token punctuation">,</span> BT<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
a<span class="token punctuation">:</span> AT
b<span class="token punctuation">:</span> BT


<span class="token keyword">print</span><span class="token punctuation">(</span>Model<span class="token punctuation">(</span>a<span class="token operator">=</span><span class="token string">'a'</span><span class="token punctuation">,</span> b<span class="token operator">=</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; a='a' b='a'</span>

IntT <span class="token operator">=</span> TypeVar<span class="token punctuation">(</span><span class="token string">'IntT'</span><span class="token punctuation">,</span> bound<span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">)</span>
typevar_model <span class="token operator">=</span> Model<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">,</span> IntT<span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>typevar_model<span class="token punctuation">(</span>a<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; a=1 b=1</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
typevar_model<span class="token punctuation">(</span>a<span class="token operator">=</span><span class="token string">'a'</span><span class="token punctuation">,</span> b<span class="token operator">=</span><span class="token string">'a'</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> ValidationError <span class="token keyword">as</span> exc<span class="token punctuation">:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>exc<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
2 validation errors for Model[int, IntT]
a
  value is not a valid integer (type=type_error.integer)
b
  value is not a valid integer (type=type_error.integer)
"""</span>

concrete_model <span class="token operator">=</span> typevar_model<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>concrete_model<span class="token punctuation">(</span>a<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; a=1 b=1</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li><li style="color: rgb(153, 153, 153);">33</li><li style="color: rgb(153, 153, 153);">34</li><li style="color: rgb(153, 153, 153);">35</li><li style="color: rgb(153, 153, 153);">36</li></ul></pre> 
<h3><a name="t12"></a><a id="317__1076"></a>3.1.7 动态模型创建</h3> 
<p>有些情况下，模型的形状直到运行时才知道。为此，pydantic提供了 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">create_model</code> 方法来允许动态创建模型。</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel<span class="token punctuation">,</span> create_model

DynamicFoobarModel <span class="token operator">=</span> create_model<span class="token punctuation">(</span><span class="token string">'DynamicFoobarModel'</span><span class="token punctuation">,</span> foo<span class="token operator">=</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">,</span> bar<span class="token operator">=</span><span class="token number">123</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">StaticFoobarModel</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
foo<span class="token punctuation">:</span> <span class="token builtin">str</span>
bar<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">123</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li></ul></pre> 
<p>在这里，<code style="user-select: auto;" onclick="mdcp.copyCode(event)">StaticFooBarModel</code> 和 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">DynamicFooBarModel</code> 是相同的。</p> 
<blockquote> 
<p><mark>警告</mark></p> 
<p>请参阅 [具有 Optional 注解的必须字段](# 3.1.12.1 具有 Optional 注解的必须字段) 中的注释，以了解使用省略号作为字段默认值的字段与仅含有注解的字段之间的区别。更多细节请参见<a href="https://github.com/samuelcolvin/pydantic/issues/1047" target="_blank">samuelcolvin/pydantic#1047</a>。</p> 
</blockquote> 
<p>字段可以由 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">(&lt;type&gt;, &lt;default value&gt;)</code> 形式的元组定义，也可以仅由默认值定义。<code style="user-select: auto;" onclick="mdcp.copyCode(event)">__config__</code> 和 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">__base__</code> 这两个特殊的关键字参数可以用来定制新模型。这包括使用额外的字段拓展基本模型。</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel<span class="token punctuation">,</span> create_model


<span class="token keyword">class</span> <span class="token class-name">FooModel</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
foo<span class="token punctuation">:</span> <span class="token builtin">str</span>
bar<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">123</span>


BarModel <span class="token operator">=</span> create_model<span class="token punctuation">(</span>
<span class="token string">'BarModel'</span><span class="token punctuation">,</span>
apple<span class="token operator">=</span><span class="token string">'russet'</span><span class="token punctuation">,</span>
banana<span class="token operator">=</span><span class="token string">'yellow'</span><span class="token punctuation">,</span>
__base__<span class="token operator">=</span>FooModel<span class="token punctuation">,</span>
<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>BarModel<span class="token punctuation">)</span>
<span class="token comment">#&gt; &lt;class 'pydantic.main.BarModel'&gt;</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>BarModel<span class="token punctuation">.</span>__fields__<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; dict_keys(['foo', 'bar', 'apple', 'banana'])</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li></ul></pre> 
<p>也可以通过给 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">__validators__</code> 参数传递一个字典来添加验证器：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> pydantic <span class="token keyword">import</span> create_model<span class="token punctuation">,</span> ValidationError<span class="token punctuation">,</span> validator


<span class="token keyword">def</span> <span class="token function">username_alphanumeric</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token keyword">assert</span> v<span class="token punctuation">.</span>isalnum<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'must be alphanumeric'</span>
<span class="token keyword">return</span> v


validators <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
<span class="token string">'username_validator'</span><span class="token punctuation">:</span>
validator<span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>username_alphanumeric<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

UserModel <span class="token operator">=</span> create_model<span class="token punctuation">(</span>
<span class="token string">'UserModel'</span><span class="token punctuation">,</span>
username<span class="token operator">=</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
__validators__<span class="token operator">=</span>validators
<span class="token punctuation">)</span>

user <span class="token operator">=</span> UserModel<span class="token punctuation">(</span>username<span class="token operator">=</span><span class="token string">'scolvin'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>
<span class="token comment">#&gt; username='scolvin'</span>

<span class="token keyword">try</span><span class="token punctuation">:</span>
UserModel<span class="token punctuation">(</span>username<span class="token operator">=</span><span class="token string">'scolvi%n'</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> ValidationError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
1 validation error for UserModel
username
  must be alphanumeric (type=assertion_error)
"""</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li></ul></pre> 
<h3><a name="t13"></a><a id="318__1157"></a>3.1.8 自定义根类型</h3> 
<p>可以通过声明 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">__root__</code> 字段来使用自定义根类型定义Pydantic 模型。</p> 
<p>根类型可以是 pydantic 支持的任意类型，该类型通过 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">__root__</code> 字段上的类型提示来指定。根值可以通过模型的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">__init__</code> 方法的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">__root__</code> 参数传递，或者作为 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">parse_obj</code> 的第一个且唯一的一个参数。</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> typing <span class="token keyword">import</span> List
<span class="token keyword">import</span> json
<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel
<span class="token keyword">from</span> pydantic<span class="token punctuation">.</span>schema <span class="token keyword">import</span> schema


<span class="token keyword">class</span> <span class="token class-name">Pets</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
__root__<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span>


<span class="token keyword">print</span><span class="token punctuation">(</span>Pets<span class="token punctuation">(</span>__root__<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'dog'</span><span class="token punctuation">,</span> <span class="token string">'cat'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; __root__=['dog', 'cat']</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>Pets<span class="token punctuation">(</span>__root__<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'dog'</span><span class="token punctuation">,</span> <span class="token string">'cat'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; ["dog", "cat"]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>Pets<span class="token punctuation">.</span>parse_obj<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'dog'</span><span class="token punctuation">,</span> <span class="token string">'cat'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; __root__=['dog', 'cat']</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>Pets<span class="token punctuation">.</span>schema<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
{
'title': 'Pets',
'type': 'array',
'items': {'type': 'string'},
}
"""</span>
pets_schema <span class="token operator">=</span> schema<span class="token punctuation">(</span><span class="token punctuation">[</span>Pets<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>pets_schema<span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
{
"definitions": {
"Pets": {
  "title": "Pets",
  "type": "array",
  "items": {
    "type": "string"
  }
}
}
}
"""</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li><li style="color: rgb(153, 153, 153);">33</li><li style="color: rgb(153, 153, 153);">34</li><li style="color: rgb(153, 153, 153);">35</li><li style="color: rgb(153, 153, 153);">36</li><li style="color: rgb(153, 153, 153);">37</li><li style="color: rgb(153, 153, 153);">38</li><li style="color: rgb(153, 153, 153);">39</li></ul></pre> 
<p>如果使用字典作为第一个参数调用一个具有自定义根类型的模型的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">parse_obj</code> 方法，将会应用下面的逻辑：</p> 
<ul><li>如果自定义的根类型是映射类型(例如 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Dict</code> 或 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Mapping</code>)，参数本身总是根据自定义根类型进行验证。</li><li>对于其他自定义根类型，如果字典仅有一个键，且其名称为 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">__root__</code>，则该键对应的值将根据自定义根类型进行验证。</li></ul> 
<p>下面是一个示例：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> typing <span class="token keyword">import</span> List<span class="token punctuation">,</span> Dict
<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel<span class="token punctuation">,</span> ValidationError


<span class="token keyword">class</span> <span class="token class-name">Pets</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
__root__<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span>


<span class="token keyword">print</span><span class="token punctuation">(</span>Pets<span class="token punctuation">.</span>parse_obj<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'dog'</span><span class="token punctuation">,</span> <span class="token string">'cat'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; __root__=['dog', 'cat']</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>Pets<span class="token punctuation">.</span>parse_obj<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'__root__'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'dog'</span><span class="token punctuation">,</span> <span class="token string">'cat'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># not recommended</span>
<span class="token comment">#&gt; __root__=['dog', 'cat']</span>


<span class="token keyword">class</span> <span class="token class-name">PetsByName</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
__root__<span class="token punctuation">:</span> Dict<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">]</span>


<span class="token keyword">print</span><span class="token punctuation">(</span>PetsByName<span class="token punctuation">.</span>parse_obj<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'Otis'</span><span class="token punctuation">:</span> <span class="token string">'dog'</span><span class="token punctuation">,</span> <span class="token string">'Milo'</span><span class="token punctuation">:</span> <span class="token string">'cat'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; __root__={'Otis': 'dog', 'Milo': 'cat'}</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
PetsByName<span class="token punctuation">.</span>parse_obj<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'__root__'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">'Otis'</span><span class="token punctuation">:</span> <span class="token string">'dog'</span><span class="token punctuation">,</span> <span class="token string">'Milo'</span><span class="token punctuation">:</span> <span class="token string">'cat'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> ValidationError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
1 validation error for PetsByName
__root__ -&gt; __root__
  str type expected (type=type_error.str)
"""</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li></ul></pre> 
<blockquote> 
<p><mark>警告</mark></p> 
<p>在字典上调用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">parse_obj</code> 方法时，对于非映射的自定义根类型使用单个键 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">"__root__"</code>，目前仅为保持向后兼容而支持，但不建议这样做，将来的版本中可能会删除。</p> 
</blockquote> 
<p>如果您想直接访问剩余的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">__root__</code> 字段中的条目，或者在这些条目上迭代，您可以实现自定义的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">__iter__</code> 和 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">__getitem__</code> 函数，如下面的例子所示。</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> typing <span class="token keyword">import</span> List
<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel


<span class="token keyword">class</span> <span class="token class-name">Pets</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
__root__<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span>

<span class="token keyword">def</span> <span class="token function">__iter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token builtin">iter</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>__root__<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">__getitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> self<span class="token punctuation">.</span>__root__<span class="token punctuation">[</span>item<span class="token punctuation">]</span>


pets <span class="token operator">=</span> Pets<span class="token punctuation">.</span>parse_obj<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'dog'</span><span class="token punctuation">,</span> <span class="token string">'cat'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>pets<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; dog</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">[</span>pet <span class="token keyword">for</span> pet <span class="token keyword">in</span> pets<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; ['dog', 'cat']</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li></ul></pre> 
<h3><a name="t14"></a><a id="319__1272"></a>3.1.9 伪不变性</h3> 
<p>可以通过 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">allow_mutation = False</code> 将模型配置为不可变的。当设置了这个值时，尝试更改实例属性的值将会引发错误。有 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Config</code> 的更多细节，请参见[模型配置](# 3.4 模型配置)。</p> 
<blockquote> 
<p><mark>警告</mark></p> 
<p>Python中的不变性从来都不是严格的。如果开发人员是果断的/愚蠢的，他们总是可以修改一个所谓的 “不可变” 对象。</p> 
</blockquote> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel


<span class="token keyword">class</span> <span class="token class-name">FooBarModel</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
a<span class="token punctuation">:</span> <span class="token builtin">str</span>
b<span class="token punctuation">:</span> <span class="token builtin">dict</span>

<span class="token keyword">class</span> <span class="token class-name">Config</span><span class="token punctuation">:</span>
    allow_mutation <span class="token operator">=</span> <span class="token boolean">False</span>


foobar <span class="token operator">=</span> FooBarModel<span class="token punctuation">(</span>a<span class="token operator">=</span><span class="token string">'hello'</span><span class="token punctuation">,</span> b<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'apple'</span><span class="token punctuation">:</span> <span class="token string">'pear'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">try</span><span class="token punctuation">:</span>
foobar<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token string">'different'</span>
<span class="token keyword">except</span> TypeError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token comment">#&gt; "FooBarModel" is immutable and does not support item assignment</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>foobar<span class="token punctuation">.</span>a<span class="token punctuation">)</span>
<span class="token comment">#&gt; hello</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>foobar<span class="token punctuation">.</span>b<span class="token punctuation">)</span>
<span class="token comment">#&gt; {'apple': 'pear'}</span>
foobar<span class="token punctuation">.</span>b<span class="token punctuation">[</span><span class="token string">'apple'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'grape'</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>foobar<span class="token punctuation">.</span>b<span class="token punctuation">)</span>
<span class="token comment">#&gt; {'apple': 'grape'}</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li></ul></pre> 
<p>尝试更改 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">a</code> 将会引发一个错误，而 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">a</code> 则保持不变。然而，字典 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">b</code> 是可变的，并且 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">foobar</code> 的不可变性不能阻止 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">b</code> 被改变。</p> 
<h3><a name="t15"></a><a id="3110__1311"></a>3.1.10 抽象基类</h3> 
<p>Pydantic模型可以与 Python 的抽象基类一起使用。</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">import</span> abc
<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel


<span class="token keyword">class</span> <span class="token class-name">FooBarModel</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">,</span> abc<span class="token punctuation">.</span>ABC<span class="token punctuation">)</span><span class="token punctuation">:</span>
a<span class="token punctuation">:</span> <span class="token builtin">str</span>
b<span class="token punctuation">:</span> <span class="token builtin">int</span>

@abc<span class="token punctuation">.</span>abstractmethod
<span class="token keyword">def</span> <span class="token function">my_abstract_method</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li></ul></pre> 
<h3><a name="t16"></a><a id="3111__1329"></a>3.1.11 字段排序</h3> 
<p>由于以下原因，字段顺序是很重要的：</p> 
<ul><li>验证是按照字段的定义顺序执行的；[字段验证器](# 3.3 验证器) 可以访问前一个字段的值，但不能访问后一个字段的值。</li><li>字段顺序保留在模型 [模式](# 3.5 模式) 中。</li><li>字段顺序保留在 [验证错误](# 3.1.4 错误处理) 中。</li><li>字段顺序被 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">.dict()</code> 和 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">.json()</code> 等保留。</li></ul> 
<p>从<strong>v1.0</strong>开始，所有具有注解的字段(无论是只有注解还是具有默认值)都将位于没有注解的字段之前。在它们各自的组中，字段按照定义时的顺序保存。</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel<span class="token punctuation">,</span> ValidationError


<span class="token keyword">class</span> <span class="token class-name">Model</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
a<span class="token punctuation">:</span> <span class="token builtin">int</span>
b <span class="token operator">=</span> <span class="token number">2</span>
c<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">1</span>
d <span class="token operator">=</span> <span class="token number">0</span>
e<span class="token punctuation">:</span> <span class="token builtin">float</span>


<span class="token keyword">print</span><span class="token punctuation">(</span>Model<span class="token punctuation">.</span>__fields__<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; dict_keys(['a', 'c', 'e', 'b', 'd'])</span>
m <span class="token operator">=</span> Model<span class="token punctuation">(</span>e<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> a<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; {'a': 1, 'c': 1, 'e': 2.0, 'b': 2, 'd': 0}</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
Model<span class="token punctuation">(</span>a<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">,</span> b<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">,</span> d<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">,</span> e<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> ValidationError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
error_locations <span class="token operator">=</span> <span class="token punctuation">[</span>e<span class="token punctuation">[</span><span class="token string">'loc'</span><span class="token punctuation">]</span> <span class="token keyword">for</span> e <span class="token keyword">in</span> e<span class="token punctuation">.</span>errors<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>error_locations<span class="token punctuation">)</span>
<span class="token comment">#&gt; [('a',), ('c',), ('e',), ('b',), ('d',)]</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li></ul></pre> 
<blockquote> 
<p><mark>警告</mark></p> 
<p>如上例所示，在同一个模型中结合使用带注释的字段和不带注释的字段会导致惊人的字段顺序。(这是由于Python的限制)</p> 
<p>因此，<strong>我们建议向所有字段添加类型注解</strong>，即使默认值将自行确定类型以确保保留字段顺序。</p> 
</blockquote> 
<h3><a name="t17"></a><a id="3112__1372"></a>3.1.12 必需字段</h3> 
<p>要将字段声明为必需的，可以只使用注释来声明它，或者可以使用省略号(<code style="user-select: auto;" onclick="mdcp.copyCode(event)">...</code>)作为值：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel<span class="token punctuation">,</span> Field


<span class="token keyword">class</span> <span class="token class-name">Model</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
a<span class="token punctuation">:</span> <span class="token builtin">int</span>
b<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
c<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> Field<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li></ul></pre> 
<p>其中 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Field</code> 指的是 [字段函数](# 3.5.1 字段定制)。</p> 
<p>在这里，<code style="user-select: auto;" onclick="mdcp.copyCode(event)">a</code>、<code style="user-select: auto;" onclick="mdcp.copyCode(event)">b</code> 和 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">c</code> 都是必需的。然而，在 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">b</code> 中使用省略号将会导致在 <a href="https://pydantic-docs.helpmanual.io/usage/mypy/" target="_blank">mypy</a> 中不能很好的工作，在<strong>v1.0</strong>中大多数情况下都应该避免使用。</p> 
<h4><a id="31121__Optional__1390"></a>3.1.12.1 具有 Optional 注解的必须字段</h4> 
<blockquote> 
<p><mark>警告</mark></p> 
<p>从版本<strong>v1.2</strong>开始，仅含有注解的可空(<code style="user-select: auto;" onclick="mdcp.copyCode(event)">Optional[...]</code>、<code style="user-select: auto;" onclick="mdcp.copyCode(event)">Union[None, ...]</code> 和 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Any</code>)字段与以 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">...</code> 作为默认值的可空字段不再具有相同的含义。</p> 
<p>在某些情况下，这可能导致<strong>v1.2</strong>不能完全向后兼容早期的**v1.***版本。</p> 
</blockquote> 
<p>如果想要指定一个可接受 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">None</code> 值的必须字段，可以使用具有 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">...</code> 的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Optional</code>：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> typing <span class="token keyword">import</span> Optional
<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel<span class="token punctuation">,</span> Field<span class="token punctuation">,</span> ValidationError


<span class="token keyword">class</span> <span class="token class-name">Model</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
a<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span>
b<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
c<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span> <span class="token operator">=</span> Field<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>


<span class="token keyword">print</span><span class="token punctuation">(</span>Model<span class="token punctuation">(</span>b<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; a=None b=1 c=2</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
Model<span class="token punctuation">(</span>a<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> ValidationError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
1 validation error for Model
c
  field required (type=value_error.missing)
"""</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li></ul></pre> 
<p>在这个模型中，<code style="user-select: auto;" onclick="mdcp.copyCode(event)">a</code>、<code style="user-select: auto;" onclick="mdcp.copyCode(event)">b</code> 和 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">c</code> 都可以接受 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">None</code> 作为值。但 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">a</code> 是可选的，而 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">b</code> 和 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">c</code> 都是必需的。<code style="user-select: auto;" onclick="mdcp.copyCode(event)">b</code> 和 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">c</code> 需要一个值，即使这个值是 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">None</code>。</p> 
<h3><a name="t18"></a><a id="3113__1426"></a>3.1.13 具有动态默认值的字段</h3> 
<p>当声明一个带有默认值的字段时，你也许想让这个默认值是动态的(例如，对于每一个模型来说是不同的)，则可以通过 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">default_factory</code> 来实现。</p> 
<blockquote> 
<p><mark>Beta 版本</mark></p> 
<p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">default_factory</code> 参数仍处于<strong>beta</strong>版本，它是在<strong>v1.5</strong>中临时添加到pydantic的。它可能会在未来的版本中发生重大的变化，它的签名或者行为直到<strong>v2</strong>才会稳定。在它还处于临时阶段时，来自社区的反馈将非常有用；评论<a href="https://github.com/samuelcolvin/pydantic/issues/866" target="_blank">#866</a>或者创建一个新问题。</p> 
</blockquote> 
<p>示例用法：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime
<span class="token keyword">from</span> uuid <span class="token keyword">import</span> UUID<span class="token punctuation">,</span> uuid4
<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel<span class="token punctuation">,</span> Field


<span class="token keyword">class</span> <span class="token class-name">Model</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
uid<span class="token punctuation">:</span> UUID <span class="token operator">=</span> Field<span class="token punctuation">(</span>default_factory<span class="token operator">=</span>uuid4<span class="token punctuation">)</span>
updated<span class="token punctuation">:</span> datetime <span class="token operator">=</span> Field<span class="token punctuation">(</span>default_factory<span class="token operator">=</span>datetime<span class="token punctuation">.</span>utcnow<span class="token punctuation">)</span>


m1 <span class="token operator">=</span> Model<span class="token punctuation">(</span><span class="token punctuation">)</span>
m2 <span class="token operator">=</span> Model<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'{m1.uid} != {m2.uid}'</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; 27ce808f-9293-47ac-860e-aebe5d6ffac7 != a583211f-b357-4b92-9632-cd1b3bbd2e1b</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'{m1.updated} != {m2.updated}'</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; 2020-10-28 20:03:32.840916 != 2020-10-28 20:03:32.840934</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li></ul></pre> 
<p>其中 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Field</code> 引用 [字段函数](# 3.5.1 字段定制)。</p> 
<blockquote> 
<p><mark>警告</mark></p> 
<p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">default_factory</code> 希望设置字段类型，此外，如果您希望使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">validate_all</code> 验证默认值，则pydantic需要调用<code style="user-select: auto;" onclick="mdcp.copyCode(event)">default_factory</code>，这可能会导致副作用!</p> 
</blockquote> 
<h3><a name="t19"></a><a id="3114__1461"></a>3.1.14 私有模型属性</h3> 
<p>如果您需要使用从模型字段中排除的内部属性，则可以使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">PrivateAttr</code> 来声明：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime
<span class="token keyword">from</span> random <span class="token keyword">import</span> randint

<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel<span class="token punctuation">,</span> PrivateAttr


<span class="token keyword">class</span> <span class="token class-name">TimeAwareModel</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
_processed_at<span class="token punctuation">:</span> datetime <span class="token operator">=</span> PrivateAttr<span class="token punctuation">(</span>default_factory<span class="token operator">=</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">)</span>
_secret_value<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> PrivateAttr<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">**</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">**</span>data<span class="token punctuation">)</span>
    <span class="token comment"># this could also be done with default_factory</span>
    self<span class="token punctuation">.</span>_secret_value <span class="token operator">=</span> randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>


m <span class="token operator">=</span> TimeAwareModel<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>_processed_at<span class="token punctuation">)</span>
<span class="token comment">#&gt; 2020-10-28 20:03:33.179004</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>_secret_value<span class="token punctuation">)</span>
<span class="token comment">#&gt; 5</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li></ul></pre> 
<p>私有属性的名称必须以下划线开始，以避免与模型字段的冲突：<code style="user-select: auto;" onclick="mdcp.copyCode(event)">_attr</code> 和 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">__attr__</code> 这两种形式都支持。</p> 
<p>如果 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Config.underscore_attrs_are_private</code> 是 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">True</code>，任何非 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">ClassVar</code> 下划线属性都将被当做私有属性：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> typing <span class="token keyword">import</span> ClassVar

<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel


<span class="token keyword">class</span> <span class="token class-name">Model</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
_class_var<span class="token punctuation">:</span> ClassVar<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'class var value'</span>
_private_attr<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">'private attr value'</span>

<span class="token keyword">class</span> <span class="token class-name">Config</span><span class="token punctuation">:</span>
    underscore_attrs_are_private <span class="token operator">=</span> <span class="token boolean">True</span>


<span class="token keyword">print</span><span class="token punctuation">(</span>Model<span class="token punctuation">.</span>_class_var<span class="token punctuation">)</span>
<span class="token comment">#&gt; class var value</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>Model<span class="token punctuation">.</span>_private_attr<span class="token punctuation">)</span>
<span class="token comment">#&gt; &lt;member '_private_attr' of 'Model' objects&gt;</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>Model<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>_private_attr<span class="token punctuation">)</span>
<span class="token comment">#&gt; private attr value</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li></ul></pre> 
<p>在创建类时，pydantic构造由私有属性填充的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">__slots__</code>。</p> 
<h3><a name="t20"></a><a id="3115__1517"></a>3.1.15 将数据解析到特定的类型</h3> 
<p>Pydantic包含一个独立的实用程序函数 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">parse_obj_as</code>，可以使用它以更特别的方式应用解析逻辑来填充Pydantic模型。这个函数的行为类似于 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">BaseModel.parse_obj</code>，但是可以使用任意的pydantic兼容类型。</p> 
<p>当您希望将结果解析为<code style="user-select: auto;" onclick="mdcp.copyCode(event)">BaseModel</code> 的直接子类之外的类型时，该函数将特别有用。例如：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> typing <span class="token keyword">import</span> List

<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel<span class="token punctuation">,</span> parse_obj_as


<span class="token keyword">class</span> <span class="token class-name">Item</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token builtin">id</span><span class="token punctuation">:</span> <span class="token builtin">int</span>
name<span class="token punctuation">:</span> <span class="token builtin">str</span>


<span class="token comment"># `item_data` could come from an API call, eg., via something like:</span>
<span class="token comment"># item_data = requests.get('https://my-api.com/items').json()</span>
item_data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'My Item'</span><span class="token punctuation">}</span><span class="token punctuation">]</span>

items <span class="token operator">=</span> parse_obj_as<span class="token punctuation">(</span>List<span class="token punctuation">[</span>Item<span class="token punctuation">]</span><span class="token punctuation">,</span> item_data<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>items<span class="token punctuation">)</span>
<span class="token comment">#&gt; [Item(id=1, name='My Item')]</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li></ul></pre> 
<p>这个函数能够将数据解析为作为 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">BaseModel</code> 字段的pydantic可以处理的任何类型。</p> 
<p>Pydantic还包括两个类似的独立函数 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">parse_file_as</code> 和 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">parse_raw_as</code>，它们类似于 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">BaseModel.parse_file</code> 和 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">BaseModel.parse_raw</code>。</p> 
<h3><a name="t21"></a><a id="3116__1547"></a>3.1.16 数据转换</h3> 
<p>pydantic可以对输入数据进行强制转换，以使其符合模型字段类型，在某些情况下，这可能会导致信息丢失。例如：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel


<span class="token keyword">class</span> <span class="token class-name">Model</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
a<span class="token punctuation">:</span> <span class="token builtin">int</span>
b<span class="token punctuation">:</span> <span class="token builtin">float</span>
c<span class="token punctuation">:</span> <span class="token builtin">str</span>


<span class="token keyword">print</span><span class="token punctuation">(</span>Model<span class="token punctuation">(</span>a<span class="token operator">=</span><span class="token number">3.1415</span><span class="token punctuation">,</span> b<span class="token operator">=</span><span class="token string">' 2.72 '</span><span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; {'a': 3, 'b': 2.72, 'c': '123'}</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li></ul></pre> 
<p>这是经过深思熟虑的决定，通常是最有用的方法。在<a href="https://github.com/samuelcolvin/pydantic/issues/578" target="_blank">这里</a>可以看到关于这个问题的更长的讨论。</p> 
<h3><a name="t22"></a><a id="3117__1567"></a>3.1.17 模型签名</h3> 
<p>所有pydantic模型将根据其字段生成签名：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">import</span> inspect
<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel<span class="token punctuation">,</span> Field


<span class="token keyword">class</span> <span class="token class-name">FooModel</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token builtin">id</span><span class="token punctuation">:</span> <span class="token builtin">int</span>
name<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token boolean">None</span>
description<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">'Foo'</span>
apple<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> Field<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> alias<span class="token operator">=</span><span class="token string">'pear'</span><span class="token punctuation">)</span>


<span class="token keyword">print</span><span class="token punctuation">(</span>inspect<span class="token punctuation">.</span>signature<span class="token punctuation">(</span>FooModel<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; (*, id: int, name: str = None, description: str = 'Foo', pear: int) -&gt; None</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li></ul></pre> 
<p>准确的签名对于自省目的和像 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">FastAPI</code> 或 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">hypothesis</code> 这样的库非常有用。</p> 
<p>生成的签名也将尊重定制的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">__init__</code> 函数：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">import</span> inspect

<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel


<span class="token keyword">class</span> <span class="token class-name">MyModel</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token builtin">id</span><span class="token punctuation">:</span> <span class="token builtin">int</span>
info<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">'Foo'</span>

<span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token builtin">id</span><span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">,</span> bar<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token operator">**</span>data<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""My custom init!"""</span>
    <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token builtin">id</span><span class="token punctuation">,</span> bar<span class="token operator">=</span>bar<span class="token punctuation">,</span> <span class="token operator">**</span>data<span class="token punctuation">)</span>


<span class="token keyword">print</span><span class="token punctuation">(</span>inspect<span class="token punctuation">.</span>signature<span class="token punctuation">(</span>MyModel<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; (id: int = 1, *, bar: str, info: str = 'Foo') -&gt; None</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li></ul></pre> 
<p>要将一个字段包含在签名中，其别名或名称必须是有效的Python标识符。pydantic倾向于使用别名而不是名称，但如果别名不是有效的python标识符，则可以使用字段名称。</p> 
<p>如果字段的别名和名称都是无效标识符，则将添加一个 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">**data</code> 参数。此外，如果 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Config.extra</code> 是 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Extra.allow</code>，则 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">**data</code> 参数将始终出现在签名中。</p> 
<blockquote> 
<p><mark>注意</mark></p> 
<p>模型签名中的类型与模型注释中声明的类型相同，不一定是可以实际提供给该字段的所有类型。这个问题可能会在<a href="https://github.com/samuelcolvin/pydantic/issues/1055" target="_blank">#1055</a>被解决后被修复。</p> 
</blockquote> 
<h2><a name="t23"></a><a id="32__1618"></a>3.2 字段类型</h2> 
<p>pydantic在可能的情况下使用[标准库类型](# 3.2.1 标准库类型)定义字段，从而使学习曲线更加平滑。 但是，对于许多有用的应用程序，不存在标准库类型，因此pydantic实现了[许多常用类型](#3.2.3 Pydantic 类型)。</p> 
<p>如果现有类型无法满足需求，您还可以使用自定义属性和验证来实现[与pydantic兼容的自定义数据类型](# 3.2.7 自定义数据类型)。</p> 
<h3><a name="t24"></a><a id="321__1624"></a>3.2.1 标准库类型</h3> 
<p>pydantic支持python标准库中的许多常见类型。如果需要更严格的处理，请查看[严格类型](# 3.2.5 Strict类型)；如果您需要对允许的值进行约束(例如，要求一个正整数)，请参阅[约束类型](# 3.2.4 约束类型)。</p> 
<ul><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">bool</code></p> <p>有关如何验证布尔值以及允许哪些值的详细信息，请参阅下面的[布尔类型](# 3.2.1.6 Boolean)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">int</code></p> <p>pydantic 使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">int(v)</code> 来强制将一个值转换为 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">int</code> 类型。请参阅[这里](# 3.1.16 数据转换)关于数据转换期间信息丢失的警告。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">float</code></p> <p>同样的，使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">float(v)</code> 来将一个值强制转换为 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">float</code> 类型。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">str</code></p> <p>字符串按原样接受，<code style="user-select: auto;" onclick="mdcp.copyCode(event)">int</code>、<code style="user-select: auto;" onclick="mdcp.copyCode(event)">float</code> 和 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Decimal</code> 使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">str(v)</code> 强制转换，<code style="user-select: auto;" onclick="mdcp.copyCode(event)">bytes</code> 和 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">bytearray</code> 使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">v.decode()</code> 转换，继承自 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">str</code> 的枚举使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">v.value</code> 转换，所有其他类型都会导致错误。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">bytes</code></p> <p>字节是按原格式接受的，<code style="user-select: auto;" onclick="mdcp.copyCode(event)">bytearray</code> 使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">bytes(v)</code> 进行转换，<code style="user-select: auto;" onclick="mdcp.copyCode(event)">str</code> 使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">v.encode()</code> 进行转换，<code style="user-select: auto;" onclick="mdcp.copyCode(event)">int</code>、<code style="user-select: auto;" onclick="mdcp.copyCode(event)">float</code> 和 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Decimal</code> 使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">str(v).encode()</code> 进行转换。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">list</code></p> <p>允许 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">list</code>、<code style="user-select: auto;" onclick="mdcp.copyCode(event)">tuple</code>、<code style="user-select: auto;" onclick="mdcp.copyCode(event)">set</code>、<code style="user-select: auto;" onclick="mdcp.copyCode(event)">frozenset</code>、<code style="user-select: auto;" onclick="mdcp.copyCode(event)">deque</code> 或生成器，并会转换成列表。对于子类型约束，参见下面的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">typing.List</code> 。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">tuple</code></p> <p>允许 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">list</code>、<code style="user-select: auto;" onclick="mdcp.copyCode(event)">tuple</code>、<code style="user-select: auto;" onclick="mdcp.copyCode(event)">set</code>、<code style="user-select: auto;" onclick="mdcp.copyCode(event)">frozenset</code>、<code style="user-select: auto;" onclick="mdcp.copyCode(event)">deque</code> 或生成器，并会转换成元组。对于子类型约束，参见下面的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">typing.Tuple</code> 。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">dict</code></p> <p>会尝试使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">dict(v)</code> 来转换为字典。对于子类型约束，参见下面的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">typing.Dict</code> 。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">set</code></p> <p>允许 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">list</code>、<code style="user-select: auto;" onclick="mdcp.copyCode(event)">tuple</code>、<code style="user-select: auto;" onclick="mdcp.copyCode(event)">set</code>、<code style="user-select: auto;" onclick="mdcp.copyCode(event)">frozenset</code>、<code style="user-select: auto;" onclick="mdcp.copyCode(event)">deque</code> 或生成器，并会转换成集合。对于子类型约束，参见下面的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">typing.Set</code> 。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">frozenset</code></p> <p>允许 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">list</code>、<code style="user-select: auto;" onclick="mdcp.copyCode(event)">tuple</code>、<code style="user-select: auto;" onclick="mdcp.copyCode(event)">set</code>、<code style="user-select: auto;" onclick="mdcp.copyCode(event)">frozenset</code>、<code style="user-select: auto;" onclick="mdcp.copyCode(event)">deque</code> 或生成器，并会转换成冻结集合。对于子类型约束，参见下面的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">typing.FrozenSet</code> 。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">deque</code></p> <p>允许 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">list</code>、<code style="user-select: auto;" onclick="mdcp.copyCode(event)">tuple</code>、<code style="user-select: auto;" onclick="mdcp.copyCode(event)">set</code>、<code style="user-select: auto;" onclick="mdcp.copyCode(event)">frozenset</code>、<code style="user-select: auto;" onclick="mdcp.copyCode(event)">deque</code> 或生成器，并会转换成双端队列。对于子类型约束，参见下面的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">typing.Deque</code> 。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">datetime.date</code></p> <p>有关解析和验证的更多细节，请参见下面的[日期时间类型](# 3.2.1.5 <a href="https://so.csdn.net/so/search?q=Datetime&amp;spm=1001.2101.3001.7020" target="_blank" class="hl hl-1" data-report-view="{&quot;spm&quot;:&quot;1001.2101.3001.7020&quot;,&quot;dest&quot;:&quot;https://so.csdn.net/so/search?q=Datetime&amp;spm=1001.2101.3001.7020&quot;}" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.7020&quot;,&quot;dest&quot;:&quot;https://so.csdn.net/so/search?q=Datetime&amp;spm=1001.2101.3001.7020&quot;}" data-tit="Datetime" data-pretit="datetime">Datetime</a>)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">datetime.time</code></p> <p>有关解析和验证的更多细节，请参见下面的[日期时间类型](# 3.2.1.5 Datetime)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">datetime.datetime</code></p> <p>有关解析和验证的更多细节，请参见下面的[日期时间类型](# 3.2.1.5 Datetime)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">datetime.timedelta</code></p> <p>有关解析和验证的更多细节，请参见下面的[日期时间类型](# 3.2.2.3 Datetime)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">typing.Any</code></p> <p>允许任何值，包括 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">None</code>，因此一个 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Any</code> 字段是可选的。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">typing.TypeVar</code></p> <p>根据 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">constraints</code> 或 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">bound</code> 约束允许的值。参见 [TypeVar](# 3.2.1.9 TypeVar)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">typing.Union</code></p> <p>有关解析和验证的更多细节，请参见[Union](# 3.2.1.3 Union)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">typing.Optional</code></p> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">Optional[x]</code> 是 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Union[x, None]</code> 的快捷方式。有关解析和验证的详细信息，请参阅[Union](# 3.2.1.3 Union)；有关可以接收 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">None</code> 作为值的必需字段的详细信息，请参阅 [必需字段](# 3.1.12 必需字段)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">typing.List</code></p> <p>有关解析和验证的更多细节，参见 [typing中的可迭代类型](# 3.2.1.1 typing 中的可迭代类型)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">typing.Tuple</code></p> <p>有关解析和验证的更多细节，参见 [typing中的可迭代类型。](# 3.2.1.1 typing 中的可迭代类型)</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">typing.Dict</code></p> <p>有关解析和验证的更多细节，参见 [typing中的可迭代类型。](# 3.2.1.1 typing 中的可迭代类型)</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">typing.Set</code></p> <p>有关解析和验证的更多细节，参见 [typing中的可迭代类型。](# 3.2.1.1 typing 中的可迭代类型)</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">typing.FrozenSet</code></p> <p>有关解析和验证的更多细节，参见 [typing中的可迭代类型。](# 3.2.1.1 typing 中的可迭代类型)</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">typing.Deque</code></p> <p>有关解析和验证的更多细节，参见 [typing中的可迭代类型。](# 3.2.1.1 typing 中的可迭代类型)</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">typing.Sequence</code></p> <p>有关解析和验证的更多细节，参见 [typing中的可迭代类型。](# 3.2.1.1 typing 中的可迭代类型)</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">typing.Iterable</code></p> <p>这是为不应该被消耗的可迭代对象保留的。有关解析和验证的更多细节，请参阅下面的[无限生成器](# 3.2.1.2 无限生成器)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">typing.Type</code></p> <p>有关解析和验证的更多细节，参见 [Type](# 3.2.1.8 Type)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">typing.Callable</code></p> <p>有关解析和验证的更多细节，参见 [Callable](# 3.2.1.7 Callable)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">typing.Pattern</code></p> <p>将会导致输入值被传递到 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">re.compile(v)</code> 以创建一个正则表达式模式。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">ipaddress.IPv4Address</code></p> <p>通过将值传递给 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">IPv4Address(v)</code>，简单地使用类型本身进行验证；有关其他自定义IP地址类型，请参阅[Pydantic类型](# 3.2.3 Pydantic 类型)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">ipaddress.IPv4Interface</code></p> <p>通过将值传递给 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">IPv4Interface(v)</code>，简单地使用类型本身进行验证；有关其他自定义IP地址类型，请参阅[Pydantic类型](3.2.3 Pydantic 类型)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">ipaddress.IPv4Network</code></p> <p>通过将值传递给 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">IPv4Network(v)</code>，简单地使用类型本身进行验证；有关其他自定义IP地址类型，请参阅[Pydantic类型](3.2.3 Pydantic 类型)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">ipaddress.IPv6Address</code></p> <p>通过将值传递给 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">IPv6Address(v)</code>，简单地使用类型本身进行验证；有关其他自定义IP地址类型，请参阅[Pydantic类型](3.2.3 Pydantic 类型)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">ipaddress.IPv6Interface</code></p> <p>通过将值传递给 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">IPv6Interface(v)</code>，简单地使用类型本身进行验证；有关其他自定义IP地址类型，请参阅[Pydantic类型](3.2.3 Pydantic 类型)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">ipaddress.IPv6.Network</code></p> <p>通过将值传递给 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">IPv6Network(v)</code>，简单地使用类型本身进行验证；有关其他自定义IP地址类型，请参阅[Pydantic类型](3.2.3 Pydantic 类型)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">enum.Enum</code></p> <p>检查值是有效的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Enum</code> 实例。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">subclass of enum.Enum</code></p> <p>检查值是有效的枚举成员。更多细节，参见 [Enum 和 Choice](# 3.2.1.4 Enum 和 Choice)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">enum.IntEnum</code></p> <p>检查值是有效的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">IntEnum</code> 实例。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">subclass of enum.IntEnum</code></p> <p>检查值是有效的整数枚举成员。更多细节，参见 [Enum 和 Choice](# 3.2.1.4 Enum 和 Choice)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">decimal.Decimal</code></p> <p>pydantic 会尝试将值转换为字符串，然后将那个字符串传递个 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Decimal(v)</code>。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">pathlib.Path</code></p> <p>通过将值传递给 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Path(v)</code> ，简单地使用类型本身进行验证。对于其他更严格的路径类型，参见 [Pydantic类型](3.2.3 Pydantic 类型)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">uuid.UUID</code></p> <p>字符串和字节(转换为字符串)被传递到 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">UUID(v)</code>，对于 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">bytes</code> 和 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">bytearray</code> ，回退到 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">UUID(bytes=v)</code>；有关其他更严格的UUID类型，请参见 [Pydantic类型](3.2.3 Pydantic 类型)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">ByteSize</code></p> <p>将带有单位的字节字符串转换为字节。</p> </li></ul> 
<h4><a id="3211_typing__1804"></a>3.2.1.1 typing 中的可迭代类型</h4> 
<p>Pydantic使用在PEP 484中定义的标准库 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">typing</code> 来定义复杂对象。</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> typing <span class="token keyword">import</span> <span class="token punctuation">(</span>
Deque<span class="token punctuation">,</span> Dict<span class="token punctuation">,</span> FrozenSet<span class="token punctuation">,</span> List<span class="token punctuation">,</span> Optional<span class="token punctuation">,</span> Sequence<span class="token punctuation">,</span> Set<span class="token punctuation">,</span> Tuple<span class="token punctuation">,</span> Union
<span class="token punctuation">)</span>

<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel


<span class="token keyword">class</span> <span class="token class-name">Model</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
simple_list<span class="token punctuation">:</span> <span class="token builtin">list</span> <span class="token operator">=</span> <span class="token boolean">None</span>
list_of_ints<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span>

simple_tuple<span class="token punctuation">:</span> <span class="token builtin">tuple</span> <span class="token operator">=</span> <span class="token boolean">None</span>
tuple_of_different_types<span class="token punctuation">:</span> Tuple<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">float</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token builtin">bool</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span>

simple_dict<span class="token punctuation">:</span> <span class="token builtin">dict</span> <span class="token operator">=</span> <span class="token boolean">None</span>
dict_str_float<span class="token punctuation">:</span> Dict<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token builtin">float</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span>

simple_set<span class="token punctuation">:</span> <span class="token builtin">set</span> <span class="token operator">=</span> <span class="token boolean">None</span>
set_bytes<span class="token punctuation">:</span> Set<span class="token punctuation">[</span><span class="token builtin">bytes</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span>
frozen_set<span class="token punctuation">:</span> FrozenSet<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span>

str_or_bytes<span class="token punctuation">:</span> Union<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token builtin">bytes</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span>
none_or_str<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span>

sequence_of_ints<span class="token punctuation">:</span> Sequence<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span>

compound<span class="token punctuation">:</span> Dict<span class="token punctuation">[</span>Union<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token builtin">bytes</span><span class="token punctuation">]</span><span class="token punctuation">,</span> List<span class="token punctuation">[</span>Set<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span>

deque<span class="token punctuation">:</span> Deque<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span>


<span class="token keyword">print</span><span class="token punctuation">(</span>Model<span class="token punctuation">(</span>simple_list<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'3'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>simple_list<span class="token punctuation">)</span>
<span class="token comment">#&gt; ['1', '2', '3']</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>Model<span class="token punctuation">(</span>list_of_ints<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'3'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>list_of_ints<span class="token punctuation">)</span>
<span class="token comment">#&gt; [1, 2, 3]</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>Model<span class="token punctuation">(</span>simple_dict<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'a'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token string">'b'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>simple_dict<span class="token punctuation">)</span>
<span class="token comment">#&gt; {'a': 1, b'b': 2}</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>Model<span class="token punctuation">(</span>dict_str_float<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'a'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token string">'b'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>dict_str_float<span class="token punctuation">)</span>
<span class="token comment">#&gt; {'a': 1.0, 'b': 2.0}</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>Model<span class="token punctuation">(</span>simple_tuple<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>simple_tuple<span class="token punctuation">)</span>
<span class="token comment">#&gt; (1, 2, 3, 4)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>Model<span class="token punctuation">(</span>tuple_of_different_types<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>tuple_of_different_types<span class="token punctuation">)</span>
<span class="token comment">#&gt; (4, 3.0, '2', True)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>Model<span class="token punctuation">(</span>sequence_of_ints<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sequence_of_ints<span class="token punctuation">)</span>
<span class="token comment">#&gt; [1, 2, 3, 4]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>Model<span class="token punctuation">(</span>sequence_of_ints<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sequence_of_ints<span class="token punctuation">)</span>
<span class="token comment">#&gt; (1, 2, 3, 4)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>Model<span class="token punctuation">(</span>deque<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>deque<span class="token punctuation">)</span>
<span class="token comment">#&gt; deque([1, 2, 3])</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li><li style="color: rgb(153, 153, 153);">33</li><li style="color: rgb(153, 153, 153);">34</li><li style="color: rgb(153, 153, 153);">35</li><li style="color: rgb(153, 153, 153);">36</li><li style="color: rgb(153, 153, 153);">37</li><li style="color: rgb(153, 153, 153);">38</li><li style="color: rgb(153, 153, 153);">39</li><li style="color: rgb(153, 153, 153);">40</li><li style="color: rgb(153, 153, 153);">41</li><li style="color: rgb(153, 153, 153);">42</li><li style="color: rgb(153, 153, 153);">43</li><li style="color: rgb(153, 153, 153);">44</li><li style="color: rgb(153, 153, 153);">45</li><li style="color: rgb(153, 153, 153);">46</li><li style="color: rgb(153, 153, 153);">47</li><li style="color: rgb(153, 153, 153);">48</li><li style="color: rgb(153, 153, 153);">49</li><li style="color: rgb(153, 153, 153);">50</li><li style="color: rgb(153, 153, 153);">51</li><li style="color: rgb(153, 153, 153);">52</li><li style="color: rgb(153, 153, 153);">53</li></ul></pre> 
<h4><a id="3212__1864"></a>3.2.1.2 无限生成器</h4> 
<p>如果你有一个生成器，您可以使用上面所述的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Sequence</code>。在这种情况下，生成器将被消耗并作为列表存储在模型中，其中的值将使用<code style="user-select: auto;" onclick="mdcp.copyCode(event)">Sequence</code> 的子类型进行验证（例如 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Sequence[int]</code> 中的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">int</code>）。</p> 
<p>但是如果您有一个生成器，并且不想其被消耗，例如无限生成器或远程数据加载器，则可以用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Iterable</code> 定义其类型：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> typing <span class="token keyword">import</span> Iterable
<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel


<span class="token keyword">class</span> <span class="token class-name">Model</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
infinite<span class="token punctuation">:</span> Iterable<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span>


<span class="token keyword">def</span> <span class="token function">infinite_ints</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
i <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    <span class="token keyword">yield</span> i
    i <span class="token operator">+=</span> <span class="token number">1</span>


m <span class="token operator">=</span> Model<span class="token punctuation">(</span>infinite<span class="token operator">=</span>infinite_ints<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span>
<span class="token comment">#&gt; infinite=&lt;generator object infinite_ints at 0x7fcb8ff44580&gt;</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> m<span class="token punctuation">.</span>infinite<span class="token punctuation">:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token comment">#&gt; 0</span>
<span class="token comment">#&gt; 1</span>
<span class="token comment">#&gt; 2</span>
<span class="token comment">#&gt; 3</span>
<span class="token comment">#&gt; 4</span>
<span class="token comment">#&gt; 5</span>
<span class="token comment">#&gt; 6</span>
<span class="token comment">#&gt; 7</span>
<span class="token comment">#&gt; 8</span>
<span class="token comment">#&gt; 9</span>
<span class="token comment">#&gt; 10</span>
<span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token number">10</span><span class="token punctuation">:</span>
    <span class="token keyword">break</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li><li style="color: rgb(153, 153, 153);">33</li><li style="color: rgb(153, 153, 153);">34</li></ul></pre> 
<blockquote> 
<p><mark>警告</mark></p> 
<p>对于类型注解为 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Iterable</code> 的字段，只执行简单的检查，以确定其是可迭代的，并且该可迭代对象不会被消费。</p> 
<p>不执行对它们的值的验证，因为如果不消费可迭代对象，就无法进行验证。</p> 
</blockquote> 
<blockquote> 
<p><mark>提示</mark></p> 
<p>如果您想要验证无限生成器的值，您可以创建一个单独的模型，并在使用生成器时使用它，并根据需要报告验证错误。</p> 
<p>pydantic无法为您自动验证这些值，因为如果要进行验证，则必须消费无限生成器。</p> 
</blockquote> 
<h5><a id="32121__1919"></a>3.2.1.2.1 验证无限生成器的第一个值</h5> 
<p>您可以创建一个验证器来验证无限生成器中的第一个值，但仍然不完全使用它。</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">import</span> itertools
<span class="token keyword">from</span> typing <span class="token keyword">import</span> Iterable
<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel<span class="token punctuation">,</span> validator<span class="token punctuation">,</span> ValidationError
<span class="token keyword">from</span> pydantic<span class="token punctuation">.</span>fields <span class="token keyword">import</span> ModelField


<span class="token keyword">class</span> <span class="token class-name">Model</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
infinite<span class="token punctuation">:</span> Iterable<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span>

@validator<span class="token punctuation">(</span><span class="token string">'infinite'</span><span class="token punctuation">)</span>
<span class="token comment"># You don't need to add the "ModelField", but it will help your</span>
<span class="token comment"># editor give you completion and catch errors</span>
<span class="token keyword">def</span> <span class="token function">infinite_first_int</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> iterable<span class="token punctuation">,</span> field<span class="token punctuation">:</span> ModelField<span class="token punctuation">)</span><span class="token punctuation">:</span>
    first_value <span class="token operator">=</span> <span class="token builtin">next</span><span class="token punctuation">(</span>iterable<span class="token punctuation">)</span>
    <span class="token keyword">if</span> field<span class="token punctuation">.</span>sub_fields<span class="token punctuation">:</span>
        <span class="token comment"># The Iterable had a parameter type, in this case it's int</span>
        <span class="token comment"># We use it to validate the first value</span>
        sub_field <span class="token operator">=</span> field<span class="token punctuation">.</span>sub_fields<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        v<span class="token punctuation">,</span> error <span class="token operator">=</span> sub_field<span class="token punctuation">.</span>validate<span class="token punctuation">(</span>first_value<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span> loc<span class="token operator">=</span><span class="token string">'first_value'</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> error<span class="token punctuation">:</span>
            <span class="token keyword">raise</span> ValidationError<span class="token punctuation">(</span><span class="token punctuation">[</span>error<span class="token punctuation">]</span><span class="token punctuation">,</span> cls<span class="token punctuation">)</span>
    <span class="token comment"># This creates a new generator that returns the first value and then</span>
    <span class="token comment"># the rest of the values from the (already started) iterable</span>
    <span class="token keyword">return</span> itertools<span class="token punctuation">.</span>chain<span class="token punctuation">(</span><span class="token punctuation">[</span>first_value<span class="token punctuation">]</span><span class="token punctuation">,</span> iterable<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">infinite_ints</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
i <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    <span class="token keyword">yield</span> i
    i <span class="token operator">+=</span> <span class="token number">1</span>


m <span class="token operator">=</span> Model<span class="token punctuation">(</span>infinite<span class="token operator">=</span>infinite_ints<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span>
<span class="token comment">#&gt; infinite=&lt;itertools.chain object at 0x7fcb8ff18c10&gt;</span>


<span class="token keyword">def</span> <span class="token function">infinite_strs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> letter <span class="token keyword">in</span> <span class="token string">'allthesingleladies'</span><span class="token punctuation">:</span>
        <span class="token keyword">yield</span> letter


<span class="token keyword">try</span><span class="token punctuation">:</span>
Model<span class="token punctuation">(</span>infinite<span class="token operator">=</span>infinite_strs<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> ValidationError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
1 validation error for Model
infinite -&gt; first_value
  value is not a valid integer (type=type_error.integer)
"""</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li><li style="color: rgb(153, 153, 153);">33</li><li style="color: rgb(153, 153, 153);">34</li><li style="color: rgb(153, 153, 153);">35</li><li style="color: rgb(153, 153, 153);">36</li><li style="color: rgb(153, 153, 153);">37</li><li style="color: rgb(153, 153, 153);">38</li><li style="color: rgb(153, 153, 153);">39</li><li style="color: rgb(153, 153, 153);">40</li><li style="color: rgb(153, 153, 153);">41</li><li style="color: rgb(153, 153, 153);">42</li><li style="color: rgb(153, 153, 153);">43</li><li style="color: rgb(153, 153, 153);">44</li><li style="color: rgb(153, 153, 153);">45</li><li style="color: rgb(153, 153, 153);">46</li><li style="color: rgb(153, 153, 153);">47</li><li style="color: rgb(153, 153, 153);">48</li><li style="color: rgb(153, 153, 153);">49</li><li style="color: rgb(153, 153, 153);">50</li><li style="color: rgb(153, 153, 153);">51</li><li style="color: rgb(153, 153, 153);">52</li><li style="color: rgb(153, 153, 153);">53</li></ul></pre> 
<h4><a id="3213_Union_1979"></a>3.2.1.3 Union</h4> 
<p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">Union</code> 类型允许一个模型属性接受不同的类型，例如：</p> 
<blockquote> 
<p><mark>警告</mark></p> 
<p>此脚本是完整的，应该 “按原样” 运行。然而，它可能不能反映所期望的行为；见下文。</p> 
</blockquote> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> uuid <span class="token keyword">import</span> UUID
<span class="token keyword">from</span> typing <span class="token keyword">import</span> Union
<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel


<span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token builtin">id</span><span class="token punctuation">:</span> Union<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">,</span> UUID<span class="token punctuation">]</span>
name<span class="token punctuation">:</span> <span class="token builtin">str</span>


user_01 <span class="token operator">=</span> User<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">123</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'John Doe'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>user_01<span class="token punctuation">)</span>
<span class="token comment">#&gt; id=123 name='John Doe'</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>user_01<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; 123</span>
user_02 <span class="token operator">=</span> User<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token string">'1234'</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'John Doe'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>user_02<span class="token punctuation">)</span>
<span class="token comment">#&gt; id=1234 name='John Doe'</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>user_02<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; 1234</span>
user_03_uuid <span class="token operator">=</span> UUID<span class="token punctuation">(</span><span class="token string">'cf57432e-809e-4353-adbd-9d5c0d733868'</span><span class="token punctuation">)</span>
user_03 <span class="token operator">=</span> User<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span>user_03_uuid<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'John Doe'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>user_03<span class="token punctuation">)</span>
<span class="token comment">#&gt; id=275603287559914445491632874575877060712 name='John Doe'</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>user_03<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; 275603287559914445491632874575877060712</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>user_03_uuid<span class="token punctuation">.</span><span class="token builtin">int</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; 275603287559914445491632874575877060712</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li></ul></pre> 
<p>但是，如上面所示，pydantic将尝试 “匹配” <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Union</code> 下定义的任何类型，并将使用第一个匹配的类型。在上面的示例中，<code style="user-select: auto;" onclick="mdcp.copyCode(event)">user_03</code> 的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">id</code> 被定义为 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">uuid.UUID</code> 类 (在属性的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Union</code> 注解下定义)，但由于 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">uuid.UUID</code> 可以编组为一个 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">int</code>，因此它选择与 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">int</code> 类型匹配，而不考虑其他类型。</p> 
<p>因此，建议在定义 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Union</code> 注解时，首先包含最特定的类型，然后再包含不那么特定的类型。在上面的例子中，<code style="user-select: auto;" onclick="mdcp.copyCode(event)">UUID</code> 类应该在 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">int</code> 和<code style="user-select: auto;" onclick="mdcp.copyCode(event)">str</code> 类之前，以排除意外的表示：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> uuid <span class="token keyword">import</span> UUID
<span class="token keyword">from</span> typing <span class="token keyword">import</span> Union
<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel


<span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token builtin">id</span><span class="token punctuation">:</span> Union<span class="token punctuation">[</span>UUID<span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">]</span>
name<span class="token punctuation">:</span> <span class="token builtin">str</span>


user_03_uuid <span class="token operator">=</span> UUID<span class="token punctuation">(</span><span class="token string">'cf57432e-809e-4353-adbd-9d5c0d733868'</span><span class="token punctuation">)</span>
user_03 <span class="token operator">=</span> User<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span>user_03_uuid<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'John Doe'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>user_03<span class="token punctuation">)</span>
<span class="token comment">#&gt; id=UUID('cf57432e-809e-4353-adbd-9d5c0d733868') name='John Doe'</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>user_03<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; cf57432e-809e-4353-adbd-9d5c0d733868</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>user_03_uuid<span class="token punctuation">.</span><span class="token builtin">int</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; 275603287559914445491632874575877060712</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li></ul></pre> 
<blockquote> 
<p><mark>提示</mark></p> 
<p>类型 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Optional[x]</code> 是 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Union[x, None]</code> 的快捷方式。</p> 
<p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">Optional[x]</code> 也可以用于指定一个必需字段也可以接受 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">None</code> 作为其值。</p> 
<p>更多细节，参见 [必需字段](# 3.1.12 必需字段)。</p> 
</blockquote> 
<h4><a id="3214_Enum__Choice_2051"></a>3.2.1.4 Enum 和 Choice</h4> 
<p>Pydantic使用 Python 的标准 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">enum</code> 类来定义选择：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> enum <span class="token keyword">import</span> Enum<span class="token punctuation">,</span> IntEnum

<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel<span class="token punctuation">,</span> ValidationError


<span class="token keyword">class</span> <span class="token class-name">FruitEnum</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">,</span> Enum<span class="token punctuation">)</span><span class="token punctuation">:</span>
pear <span class="token operator">=</span> <span class="token string">'pear'</span>
banana <span class="token operator">=</span> <span class="token string">'banana'</span>


<span class="token keyword">class</span> <span class="token class-name">ToolEnum</span><span class="token punctuation">(</span>IntEnum<span class="token punctuation">)</span><span class="token punctuation">:</span>
spanner <span class="token operator">=</span> <span class="token number">1</span>
wrench <span class="token operator">=</span> <span class="token number">2</span>


<span class="token keyword">class</span> <span class="token class-name">CookingModel</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
fruit<span class="token punctuation">:</span> FruitEnum <span class="token operator">=</span> FruitEnum<span class="token punctuation">.</span>pear
tool<span class="token punctuation">:</span> ToolEnum <span class="token operator">=</span> ToolEnum<span class="token punctuation">.</span>spanner


<span class="token keyword">print</span><span class="token punctuation">(</span>CookingModel<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; fruit=&lt;FruitEnum.pear: 'pear'&gt; tool=&lt;ToolEnum.spanner: 1&gt;</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>CookingModel<span class="token punctuation">(</span>tool<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> fruit<span class="token operator">=</span><span class="token string">'banana'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; fruit=&lt;FruitEnum.banana: 'banana'&gt; tool=&lt;ToolEnum.wrench: 2&gt;</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
CookingModel<span class="token punctuation">(</span>fruit<span class="token operator">=</span><span class="token string">'other'</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> ValidationError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
1 validation error for CookingModel
fruit
  value is not a valid enumeration member; permitted: 'pear', 'banana'
(type=type_error.enum; enum_values=[&lt;FruitEnum.pear: 'pear'&gt;,
&lt;FruitEnum.banana: 'banana'&gt;])
"""</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li><li style="color: rgb(153, 153, 153);">33</li><li style="color: rgb(153, 153, 153);">34</li><li style="color: rgb(153, 153, 153);">35</li></ul></pre> 
<h4><a id="3215_Datetime_2093"></a>3.2.1.5 Datetime</h4> 
<p>Pydantic 支持下面一些 <a href="https://docs.python.org/library/datetime.html#available-types" target="_blank">datetime</a> 了类型：</p> 
<ul><li><code style="user-select: auto;" onclick="mdcp.copyCode(event)">datetime</code> 字段可以是： 
<ul><li><code style="user-select: auto;" onclick="mdcp.copyCode(event)">datetime</code>：存在 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">datetime</code> 对象时</li><li><code style="user-select: auto;" onclick="mdcp.copyCode(event)">int</code> 或 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">float</code>：假定为 Unix 时间时。例如，自1970年1月1日以来的秒数 (如果 &gt;= <code style="user-select: auto;" onclick="mdcp.copyCode(event)">-2e10</code> 或 &lt;= <code style="user-select: auto;" onclick="mdcp.copyCode(event)">2e10</code>) 或毫秒数 (如果 &lt; <code style="user-select: auto;" onclick="mdcp.copyCode(event)">-2e10</code> 或 &gt; <code style="user-select: auto;" onclick="mdcp.copyCode(event)">2e10</code>)。</li><li><code style="user-select: auto;" onclick="mdcp.copyCode(event)">str</code>：下面的格式可用时： 
<ul><li><code style="user-select: auto;" onclick="mdcp.copyCode(event)">YYYY-MM-DD[T]HH:MM[:SS[.ffffff]][Z or [±]HH[:]MM]]]</code></li><li>作为字符串的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">int</code> 或 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">float</code>s (假定为Unix time)</li></ul> </li></ul> </li><li><code style="user-select: auto;" onclick="mdcp.copyCode(event)">date</code> 字段可以是： 
<ul><li><code style="user-select: auto;" onclick="mdcp.copyCode(event)">date</code>：存在 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">date</code> 对象时</li><li><code style="user-select: auto;" onclick="mdcp.copyCode(event)">int</code> 或<code style="user-select: auto;" onclick="mdcp.copyCode(event)">float</code>： 参见 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">datetime</code></li><li><code style="user-select: auto;" onclick="mdcp.copyCode(event)">str</code>：下面的格式可用时： 
<ul><li><code style="user-select: auto;" onclick="mdcp.copyCode(event)">YYYY-MM-DD</code></li><li><code style="user-select: auto;" onclick="mdcp.copyCode(event)">int</code> 或 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">float</code> 参见 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">datetime</code></li></ul> </li></ul> </li><li><code style="user-select: auto;" onclick="mdcp.copyCode(event)">time</code> 字段可以是： 
<ul><li><code style="user-select: auto;" onclick="mdcp.copyCode(event)">time</code>：存在 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">time</code> 对象时</li><li><code style="user-select: auto;" onclick="mdcp.copyCode(event)">str</code>：下面的格式可用时： 
<ul><li><code style="user-select: auto;" onclick="mdcp.copyCode(event)">HH:MM[:SS[.ffffff]][Z or [±]HH[:]MM]]]</code></li></ul> </li></ul> </li><li><code style="user-select: auto;" onclick="mdcp.copyCode(event)">timedelta</code> 字段可以是： 
<ul><li><code style="user-select: auto;" onclick="mdcp.copyCode(event)">timedelta</code>：存在 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">timedelta</code> 对象时</li><li><code style="user-select: auto;" onclick="mdcp.copyCode(event)">int</code> 或 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">float</code>：假定为"秒"</li><li><code style="user-select: auto;" onclick="mdcp.copyCode(event)">str</code>：下面的格式可用时： 
<ul><li><code style="user-select: auto;" onclick="mdcp.copyCode(event)">[-][DD ][HH:MM]SS[.ffffff]</code></li><li><code style="user-select: auto;" onclick="mdcp.copyCode(event)">[±]P[DD]DT[HH]H[MM]M[SS]S</code> (ISO 8601 的 timedelta 格式)</li></ul> </li></ul> </li></ul> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> datetime <span class="token keyword">import</span> date<span class="token punctuation">,</span> datetime<span class="token punctuation">,</span> time<span class="token punctuation">,</span> timedelta
<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel


<span class="token keyword">class</span> <span class="token class-name">Model</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
d<span class="token punctuation">:</span> date <span class="token operator">=</span> <span class="token boolean">None</span>
dt<span class="token punctuation">:</span> datetime <span class="token operator">=</span> <span class="token boolean">None</span>
t<span class="token punctuation">:</span> time <span class="token operator">=</span> <span class="token boolean">None</span>
td<span class="token punctuation">:</span> timedelta <span class="token operator">=</span> <span class="token boolean">None</span>


m <span class="token operator">=</span> Model<span class="token punctuation">(</span>
d<span class="token operator">=</span><span class="token number">1966280412345.6789</span><span class="token punctuation">,</span>
dt<span class="token operator">=</span><span class="token string">'2032-04-23T10:20:30.400+02:30'</span><span class="token punctuation">,</span>
t<span class="token operator">=</span>time<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
td<span class="token operator">=</span><span class="token string">'P3DT12H30M5S'</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
{
'd': datetime.date(2032, 4, 22),
'dt': datetime.datetime(2032, 4, 23, 10, 20, 30, 400000,
tzinfo=datetime.timezone(datetime.timedelta(seconds=9000))),
't': datetime.time(4, 8, 16),
'td': datetime.timedelta(days=3, seconds=45005),
}
"""</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li></ul></pre> 
<h4><a id="3216_Boolean_2151"></a>3.2.1.6 Boolean</h4> 
<blockquote> 
<p><mark>警告</mark></p> 
<p>从<strong>v1.0</strong>版本开始，解析 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">bool</code> 字段的逻辑发生了变化。</p> 
<p>在<strong>v1.0</strong>之前，<code style="user-select: auto;" onclick="mdcp.copyCode(event)">bool</code> 解析从来不会失败，会导致一些意想不到的结果。新的逻辑如下所述。</p> 
</blockquote> 
<p>如果不是下面的值之一，标准的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">bool</code> 字段将会引发 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">ValidationError</code> ：</p> 
<ul><li>有效的布尔值(例如 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">True</code> 或 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">False</code>)；</li><li>整数 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">0</code> 或 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">1</code>；</li><li>一个字符串，在转换为小写后，等于 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">0</code>、<code style="user-select: auto;" onclick="mdcp.copyCode(event)">off</code>、<code style="user-select: auto;" onclick="mdcp.copyCode(event)">f</code>、<code style="user-select: auto;" onclick="mdcp.copyCode(event)">false</code>、<code style="user-select: auto;" onclick="mdcp.copyCode(event)">n</code>、<code style="user-select: auto;" onclick="mdcp.copyCode(event)">no</code>、<code style="user-select: auto;" onclick="mdcp.copyCode(event)">1</code>、<code style="user-select: auto;" onclick="mdcp.copyCode(event)">on</code>、<code style="user-select: auto;" onclick="mdcp.copyCode(event)">t</code>、<code style="user-select: auto;" onclick="mdcp.copyCode(event)">true</code>、<code style="user-select: auto;" onclick="mdcp.copyCode(event)">y</code>、<code style="user-select: auto;" onclick="mdcp.copyCode(event)">yes</code> 其中之一；</li><li>一个 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">bytes</code>，在解码为 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">str</code> 后，依据上一个规则有效。</li></ul> 
<blockquote> 
<p><mark>注意</mark></p> 
<p>如果想要更严格的布尔逻辑(例如，只允许 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">True</code> 或 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">False</code> 的字段)，可以使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">StrictBool</code>。</p> 
</blockquote> 
<p>下面的脚本模拟了这些行为：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel<span class="token punctuation">,</span> ValidationError


<span class="token keyword">class</span> <span class="token class-name">BooleanModel</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
bool_value<span class="token punctuation">:</span> <span class="token builtin">bool</span>


<span class="token keyword">print</span><span class="token punctuation">(</span>BooleanModel<span class="token punctuation">(</span>bool_value<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; bool_value=False</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>BooleanModel<span class="token punctuation">(</span>bool_value<span class="token operator">=</span><span class="token string">'False'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; bool_value=False</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
BooleanModel<span class="token punctuation">(</span>bool_value<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> ValidationError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
1 validation error for BooleanModel
bool_value
  value could not be parsed to a boolean (type=type_error.bool)
"""</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li></ul></pre> 
<h4><a id="3217_Callable_2195"></a>3.2.1.7 Callable</h4> 
<p>字段也可以是 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Callable</code> 类型：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> typing <span class="token keyword">import</span> Callable
<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel


<span class="token keyword">class</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
callback<span class="token punctuation">:</span> Callable<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">]</span>


m <span class="token operator">=</span> Foo<span class="token punctuation">(</span>callback<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span>
<span class="token comment">#&gt; callback=&lt;function &lt;lambda&gt; at 0x7fcb90290dc0&gt;</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li></ul></pre> 
<blockquote> 
<p><mark>警告</mark></p> 
<p>类型为 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Callble</code> 的字段只执行简单的检查以确定参数是否可调用；不执行参数、参数类型或返回类型的验证。</p> 
</blockquote> 
<h4><a id="3218_Type_2217"></a>3.2.1.8 Type</h4> 
<p>Pydantic支持使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Type[T]</code> 来指定一个字段只可以接受类 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">T</code> 的子类(而不是实例)。</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> typing <span class="token keyword">import</span> Type

<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel
<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> ValidationError


<span class="token keyword">class</span> <span class="token class-name">Foo</span><span class="token punctuation">:</span>
<span class="token keyword">pass</span>


<span class="token keyword">class</span> <span class="token class-name">Bar</span><span class="token punctuation">(</span>Foo<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token keyword">pass</span>


<span class="token keyword">class</span> <span class="token class-name">Other</span><span class="token punctuation">:</span>
<span class="token keyword">pass</span>


<span class="token keyword">class</span> <span class="token class-name">SimpleModel</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
just_subclasses<span class="token punctuation">:</span> Type<span class="token punctuation">[</span>Foo<span class="token punctuation">]</span>


SimpleModel<span class="token punctuation">(</span>just_subclasses<span class="token operator">=</span>Foo<span class="token punctuation">)</span>
SimpleModel<span class="token punctuation">(</span>just_subclasses<span class="token operator">=</span>Bar<span class="token punctuation">)</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
SimpleModel<span class="token punctuation">(</span>just_subclasses<span class="token operator">=</span>Other<span class="token punctuation">)</span>
<span class="token keyword">except</span> ValidationError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
1 validation error for SimpleModel
just_subclasses
  subclass of Foo expected (type=type_error.subclass; expected_class=Foo)
"""</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li><li style="color: rgb(153, 153, 153);">33</li></ul></pre> 
<p>也可以使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Type</code> 来指定允许任意类：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> typing <span class="token keyword">import</span> Type

<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel<span class="token punctuation">,</span> ValidationError


<span class="token keyword">class</span> <span class="token class-name">Foo</span><span class="token punctuation">:</span>
<span class="token keyword">pass</span>


<span class="token keyword">class</span> <span class="token class-name">LenientSimpleModel</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
any_class_goes<span class="token punctuation">:</span> Type


LenientSimpleModel<span class="token punctuation">(</span>any_class_goes<span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">)</span>
LenientSimpleModel<span class="token punctuation">(</span>any_class_goes<span class="token operator">=</span>Foo<span class="token punctuation">)</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
LenientSimpleModel<span class="token punctuation">(</span>any_class_goes<span class="token operator">=</span>Foo<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> ValidationError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
1 validation error for LenientSimpleModel
any_class_goes
  a class is expected (type=type_error.class)
"""</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li></ul></pre> 
<h4><a id="3219_TypeVar_2286"></a>3.2.1.9 TypeVar</h4> 
<p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">TypeVar</code> 支持无约束(unconstrained)、有约束(constrained) 或有绑定(with bound)。</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> typing <span class="token keyword">import</span> TypeVar
<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel

Foobar <span class="token operator">=</span> TypeVar<span class="token punctuation">(</span><span class="token string">'Foobar'</span><span class="token punctuation">)</span>
BoundFloat <span class="token operator">=</span> TypeVar<span class="token punctuation">(</span><span class="token string">'BoundFloat'</span><span class="token punctuation">,</span> bound<span class="token operator">=</span><span class="token builtin">float</span><span class="token punctuation">)</span>
IntStr <span class="token operator">=</span> TypeVar<span class="token punctuation">(</span><span class="token string">'IntStr'</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">Model</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
a<span class="token punctuation">:</span> Foobar  <span class="token comment"># equivalent of ": Any"</span>
b<span class="token punctuation">:</span> BoundFloat  <span class="token comment"># equivalent of ": float"</span>
c<span class="token punctuation">:</span> IntStr  <span class="token comment"># equivalent of ": Union[int, str]"</span>


<span class="token keyword">print</span><span class="token punctuation">(</span>Model<span class="token punctuation">(</span>a<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> b<span class="token operator">=</span><span class="token number">4.2</span><span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; a=[1] b=4.2 c='x'</span>

<span class="token comment"># a may be None and is therefore optional</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>Model<span class="token punctuation">(</span>b<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; a=None b=1.0 c=1</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li></ul></pre> 
<h3><a name="t25"></a><a id="322_Literal_2313"></a>3.2.2 Literal类型</h3> 
<blockquote> 
<p><mark>注意：</mark></p> 
<p>这是自python 3.8以来的python标准库的一个新特性；在python 3.8之前，则需要安装 <a href="https://pypi.org/project/typing-extensions/" target="_blank">typing-extensions</a>。</p> 
</blockquote> 
<p>pydantic支持使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">typing.Literal</code> (或者在 Python3.8之前，使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">typing_extensions.Literal</code>) 作为一种轻量级的方式来指定一个字段只能接受特定的字面量：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> typing <span class="token keyword">import</span> Literal

<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel<span class="token punctuation">,</span> ValidationError


<span class="token keyword">class</span> <span class="token class-name">Pie</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
flavor<span class="token punctuation">:</span> Literal<span class="token punctuation">[</span><span class="token string">'apple'</span><span class="token punctuation">,</span> <span class="token string">'pumpkin'</span><span class="token punctuation">]</span>


Pie<span class="token punctuation">(</span>flavor<span class="token operator">=</span><span class="token string">'apple'</span><span class="token punctuation">)</span>
Pie<span class="token punctuation">(</span>flavor<span class="token operator">=</span><span class="token string">'pumpkin'</span><span class="token punctuation">)</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
Pie<span class="token punctuation">(</span>flavor<span class="token operator">=</span><span class="token string">'cherry'</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> ValidationError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
1 validation error for Pie
flavor
  unexpected value; permitted: 'apple', 'pumpkin'
(type=value_error.const; given=cherry; permitted=('apple', 'pumpkin'))
"""</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li></ul></pre> 
<p>这个字段类型的一个好处是，它可以用来检查一个或多个特定值是否相等，而不需要声明自定义验证器：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> typing <span class="token keyword">import</span> ClassVar<span class="token punctuation">,</span> List<span class="token punctuation">,</span> Union

<span class="token keyword">from</span> typing <span class="token keyword">import</span> Literal

<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel<span class="token punctuation">,</span> ValidationError


<span class="token keyword">class</span> <span class="token class-name">Cake</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
kind<span class="token punctuation">:</span> Literal<span class="token punctuation">[</span><span class="token string">'cake'</span><span class="token punctuation">]</span>
required_utensils<span class="token punctuation">:</span> ClassVar<span class="token punctuation">[</span>List<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'fork'</span><span class="token punctuation">,</span> <span class="token string">'knife'</span><span class="token punctuation">]</span>


<span class="token keyword">class</span> <span class="token class-name">IceCream</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
kind<span class="token punctuation">:</span> Literal<span class="token punctuation">[</span><span class="token string">'icecream'</span><span class="token punctuation">]</span>
required_utensils<span class="token punctuation">:</span> ClassVar<span class="token punctuation">[</span>List<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'spoon'</span><span class="token punctuation">]</span>


<span class="token keyword">class</span> <span class="token class-name">Meal</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
dessert<span class="token punctuation">:</span> Union<span class="token punctuation">[</span>Cake<span class="token punctuation">,</span> IceCream<span class="token punctuation">]</span>


<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>Meal<span class="token punctuation">(</span>dessert<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'kind'</span><span class="token punctuation">:</span> <span class="token string">'cake'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>dessert<span class="token punctuation">)</span><span class="token punctuation">.</span>__name__<span class="token punctuation">)</span>
<span class="token comment">#&gt; Cake</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>Meal<span class="token punctuation">(</span>dessert<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'kind'</span><span class="token punctuation">:</span> <span class="token string">'icecream'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>dessert<span class="token punctuation">)</span><span class="token punctuation">.</span>__name__<span class="token punctuation">)</span>
<span class="token comment">#&gt; IceCream</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
Meal<span class="token punctuation">(</span>dessert<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'kind'</span><span class="token punctuation">:</span> <span class="token string">'pie'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> ValidationError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
2 validation errors for Meal
dessert -&gt; kind
  unexpected value; permitted: 'cake' (type=value_error.const; given=pie;
permitted=('cake',))
dessert -&gt; kind
  unexpected value; permitted: 'icecream' (type=value_error.const;
given=pie; permitted=('icecream',))
"""</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li><li style="color: rgb(153, 153, 153);">33</li><li style="color: rgb(153, 153, 153);">34</li><li style="color: rgb(153, 153, 153);">35</li><li style="color: rgb(153, 153, 153);">36</li><li style="color: rgb(153, 153, 153);">37</li><li style="color: rgb(153, 153, 153);">38</li></ul></pre> 
<p>在带注解的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Union</code> 中使用适当的排序，你可以使用它来解析特定的降序类型(types of descreasing)：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> typing <span class="token keyword">import</span> Optional<span class="token punctuation">,</span> Union

<span class="token keyword">from</span> typing <span class="token keyword">import</span> Literal

<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel


<span class="token keyword">class</span> <span class="token class-name">Dessert</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
kind<span class="token punctuation">:</span> <span class="token builtin">str</span>


<span class="token keyword">class</span> <span class="token class-name">Pie</span><span class="token punctuation">(</span>Dessert<span class="token punctuation">)</span><span class="token punctuation">:</span>
kind<span class="token punctuation">:</span> Literal<span class="token punctuation">[</span><span class="token string">'pie'</span><span class="token punctuation">]</span>
flavor<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span>


<span class="token keyword">class</span> <span class="token class-name">ApplePie</span><span class="token punctuation">(</span>Pie<span class="token punctuation">)</span><span class="token punctuation">:</span>
flavor<span class="token punctuation">:</span> Literal<span class="token punctuation">[</span><span class="token string">'apple'</span><span class="token punctuation">]</span>


<span class="token keyword">class</span> <span class="token class-name">PumpkinPie</span><span class="token punctuation">(</span>Pie<span class="token punctuation">)</span><span class="token punctuation">:</span>
flavor<span class="token punctuation">:</span> Literal<span class="token punctuation">[</span><span class="token string">'pumpkin'</span><span class="token punctuation">]</span>


<span class="token keyword">class</span> <span class="token class-name">Meal</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
dessert<span class="token punctuation">:</span> Union<span class="token punctuation">[</span>ApplePie<span class="token punctuation">,</span> PumpkinPie<span class="token punctuation">,</span> Pie<span class="token punctuation">,</span> Dessert<span class="token punctuation">]</span>


<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>Meal<span class="token punctuation">(</span>dessert<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'kind'</span><span class="token punctuation">:</span> <span class="token string">'pie'</span><span class="token punctuation">,</span> <span class="token string">'flavor'</span><span class="token punctuation">:</span> <span class="token string">'apple'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>dessert<span class="token punctuation">)</span><span class="token punctuation">.</span>__name__<span class="token punctuation">)</span>
<span class="token comment">#&gt; ApplePie</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>Meal<span class="token punctuation">(</span>dessert<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'kind'</span><span class="token punctuation">:</span> <span class="token string">'pie'</span><span class="token punctuation">,</span> <span class="token string">'flavor'</span><span class="token punctuation">:</span> <span class="token string">'pumpkin'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>dessert<span class="token punctuation">)</span><span class="token punctuation">.</span>__name__<span class="token punctuation">)</span>
<span class="token comment">#&gt; PumpkinPie</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>Meal<span class="token punctuation">(</span>dessert<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'kind'</span><span class="token punctuation">:</span> <span class="token string">'pie'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>dessert<span class="token punctuation">)</span><span class="token punctuation">.</span>__name__<span class="token punctuation">)</span>
<span class="token comment">#&gt; Pie</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>Meal<span class="token punctuation">(</span>dessert<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'kind'</span><span class="token punctuation">:</span> <span class="token string">'cake'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>dessert<span class="token punctuation">)</span><span class="token punctuation">.</span>__name__<span class="token punctuation">)</span>
<span class="token comment">#&gt; Dessert</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li><li style="color: rgb(153, 153, 153);">33</li><li style="color: rgb(153, 153, 153);">34</li><li style="color: rgb(153, 153, 153);">35</li><li style="color: rgb(153, 153, 153);">36</li></ul></pre> 
<h3><a name="t26"></a><a id="323_Pydantic__2429"></a>3.2.3 Pydantic 类型</h3> 
<p>Pydantic 也提供了许多其他有用的类型：</p> 
<ul><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">FilePath</code></p> <p>与 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Path</code> 类似，但路径必须存在并且必须是文件。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">DirectoryPath</code></p> <p>与 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Path</code> 类似，但路径必须存在并且必须是目录。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">EmailStr</code></p> <p>需要安装 <a href="https://github.com/JoshData/python-email-validator" target="_blank">email-validator</a>；输入字符串必须是有效的 email地址，输出是一个简单字符串。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">NameEmail</code></p> <p>需要安装 <a href="https://github.com/JoshData/python-email-validator" target="_blank">email-validator</a>；输入字符串必须是有效的 email地址或是 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Fred Bloggs &lt;fred.bloggs@example.com&gt;</code> 这样的格式，输出是一个 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">NameEmail</code> 对象，该对象有两个属性：<code style="user-select: auto;" onclick="mdcp.copyCode(event)">name</code> 和 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">email</code>。对于 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Fred Bloggs &lt;fred.bloggs@example.com&gt;</code>，名称将会是 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Fred Bloggs</code>。对于 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">fred.bloggs@example.com</code>，名称将会是 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">fred.bloggs</code>。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">PyObject</code></p> <p>需要一个可调用对象或一个包含 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">.</code> 的表示导入路径的字符串。如果提供的是一个字符串，则从该字符串所表示的导入路径加载最后一个 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">.</code> 右边的子串所表示的可导入Python 对象。 例如，如果提供了 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">'math.cos'</code>，则结果字段值将为函数 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">cos</code>。如果提供了 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">pydantic.dataclasses.dataclass</code>，则结果字段值将为 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">dataclass</code>。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">Color</code></p> <p>用于解析 HTML 和 CSS 颜色。参见 [Color类型](3.2.3.2 Color 类型)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">Json</code></p> <p>一个特殊的类型包装器，在解析之前加载JSON； 参见 [JSON类型](# 3.2.3.4 Json 类型)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">PaymentCardNumber</code></p> <p>对支付卡进行解析和验证；参见 [PaymentCardNumber 类型](3.2.3.5 PaymentCardNumber)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">AnyUrl</code></p> <p>任意 URL。参见 [URL](# 3.2.3.1 URL)</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">AnyHttpUrl</code></p> <p>一个 HTTP URL。参见 [URL](# 3.2.3.1 URL)</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">HttpUrl</code></p> <p>更严格的HTTP URL。参见 [URL](# 3.2.3.1 URL)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">PostgresDsn</code></p> <p>Postgres DSN 样式的 URL。参见 [URL](# 3.2.3.1 URL)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">RedisDsn</code></p> <p>Redis DSN 样式的 URL。参见 [URL](# 3.2.3.1 URL)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">stricturl</code></p> <p>用于任意URL约束的类型方法。参见 [URL](# 3.2.3.1 URL)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">UUID1</code></p> <p>需要类型1的有效UUID。参见[上面](# 3.2.1 标准库类型)的UUID。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">UUID3</code></p> <p>需要类型3的有效UUID。参见[上面](# 3.2.1 标准库类型)的UUID。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">UUID4</code></p> <p>需要类型4的有效UUID。参见[上面](# 3.2.1 标准库类型)的UUID。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">UUID5</code></p> <p>需要类型5的有效UUID。参见[上面](# 3.2.1 标准库类型)的UUID。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">SecretBytes</code></p> <p>值部分(partially)保密的字节。参见 [Secret](# 3.2.3.3 Secret 类型)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">SecretStr</code></p> <p>值部分(partially)保密的字符串。参见 [Secret](# 3.2.3.3 Secret 类型)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">IPvAnyAddress</code></p> <p>允许一个 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">IPv4Address</code> 或一个 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">IPv6Address</code>。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">IPvAnyInterface</code></p> <p>允许一个 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">IPv4Interface</code> 或一个 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">IPv6Interface</code>。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">IPvAnyNetwork</code></p> <p>允许一个 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">IPv4Network</code> 或一个 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">IPv6Network</code>。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">NegativeFloat</code></p> <p>允许负的浮点数； 使用标准的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">float</code> 解析，然后检查该值是否小于0； 请参阅 [约束类型](3.2.4 约束类型)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">NegativeInt</code></p> <p>允许负的整数； 使用标准的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">int</code> 解析，然后检查该值是否小于0； 请参阅 [约束类型](3.2.4 约束类型)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">PositiveFloat</code></p> <p>允许正的浮点数； 使用标准的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">float</code> 解析，然后检查该值是否大于0； 请参阅 [约束类型](3.2.4 约束类型)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">PosiviteInt</code></p> <p>允许正的整数； 使用标准的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">int</code> 解析，然后检查该值是否大于0； 请参阅 [约束类型](3.2.4 约束类型)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">conbytes</code></p> <p>用于约束 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">bytes</code> 的类型方法。请参阅 [约束类型](3.2.4 约束类型)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">condecimal</code></p> <p>用于约束 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Decimal</code> 的类型方法。请参阅 [约束类型](3.2.4 约束类型)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">confloat</code></p> <p>用于约束 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">float</code> 的类型方法。请参阅 [约束类型](3.2.4 约束类型)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">conint</code></p> <p>用于约束 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">int</code> 的类型方法。请参阅 [约束类型](3.2.4 约束类型)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">conlist</code></p> <p>用于约束 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">list</code> 的类型方法。请参阅 [约束类型](3.2.4 约束类型)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">conset</code></p> <p>用于约束 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">set</code> 的类型方法。请参阅 [约束类型](3.2.4 约束类型)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">constr</code></p> <p>用于约束 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">str</code> 的类型方法。请参阅 [约束类型](3.2.4 约束类型)。</p> </li></ul> 
<h4><a id="3231_URL_2569"></a>3.2.3.1 URL</h4> 
<p>对于 URI/URL验证，可以使用以下类型：</p> 
<ul><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">AnyUrl</code></p> <p>允许任意方案，不需要TLD。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">AnyHttpUrl</code></p> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">http</code> 或 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">https</code> 方案，不需要TLD。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">HttpUrl</code></p> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">http</code> 或 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">https</code> 方案，需要TLD，最大长度 2083。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">PostgresDsn</code></p> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">postgres</code> 或 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">postgresql</code> 方案，需要用户信息，不需要 TLD。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">RedisDsn</code></p> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">redis</code> 方案，不需要用户信息。不需要 TLD (更改：从<strong>v1.6</strong>开始不需要用户信息)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">stricturl</code></p> <p>带有如下关键字参数的方法：</p> 
<ul><li><code style="user-select: auto;" onclick="mdcp.copyCode(event)">strip_whitespace: bool = True</code></li><li><code style="user-select: auto;" onclick="mdcp.copyCode(event)">min_length: int = 1</code></li><li><code style="user-select: auto;" onclick="mdcp.copyCode(event)">max_length: int = 2 ** 16</code></li><li><code style="user-select: auto;" onclick="mdcp.copyCode(event)">tld_required: bool = True</code></li><li><code style="user-select: auto;" onclick="mdcp.copyCode(event)">allowed_schemes: Optional[Set[str]] = None</code></li></ul> </li></ul> 
<p>当提供了无效的 URL 时，上面这些类型(都继承自<code style="user-select: auto;" onclick="mdcp.copyCode(event)">AnyUrl</code>)都会尝试给出描述性的错误。</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel<span class="token punctuation">,</span> HttpUrl<span class="token punctuation">,</span> ValidationError


<span class="token keyword">class</span> <span class="token class-name">MyModel</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
url<span class="token punctuation">:</span> HttpUrl


m <span class="token operator">=</span> MyModel<span class="token punctuation">(</span>url<span class="token operator">=</span><span class="token string">'http://www.example.com'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>url<span class="token punctuation">)</span>
<span class="token comment">#&gt; http://www.example.com</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
MyModel<span class="token punctuation">(</span>url<span class="token operator">=</span><span class="token string">'ftp://invalid.url'</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> ValidationError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
1 validation error for MyModel
url
  URL scheme not permitted (type=value_error.url.scheme;
allowed_schemes={'https', 'http'})
"""</span>

<span class="token keyword">try</span><span class="token punctuation">:</span>
MyModel<span class="token punctuation">(</span>url<span class="token operator">=</span><span class="token string">'not a url'</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> ValidationError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
1 validation error for MyModel
url
  invalid or missing URL scheme (type=value_error.url.scheme)
"""</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li></ul></pre> 
<p>如果需要自定义的 URI/URL 类型，则可以按照与上面定义的类型类似的方式来创建它。</p> 
<h5><a id="32311_URL__2640"></a>3.2.3.1.1 URL 属性</h5> 
<p>假定输入 URL 为 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">http://samuel:pass@example.com:8000/the/path/?query=here#fragment=is;this=bit</code>，上面的类型导出如下的属性：</p> 
<ul><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">scheme</code></p> <p>总是设置。URL 方案( 上面的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">http</code>)</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">host</code></p> <p>总是设置。URL 主机 (上面的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">example.com</code>)</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">host_type</code></p> <p>总是设置。描述主机类型，或</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">domain</code></p> <p>例如，<code style="user-select: auto;" onclick="mdcp.copyCode(event)">example.com</code></p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">int_domain</code></p> <p>国际域名，参见[下面](# 3.2.4.1.2 国际域名)，例如 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">exampl£e.org</code></p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">ipv4</code></p> <p>一个 IP V4 地址，例如 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">127.0.0.1</code> 或</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">ipv6</code></p> <p>一个IP V6 地址，例如 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">2001:db8:ff00:42</code></p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">user</code></p> <p>可选。如果包括的话，则表示用户名 (上面的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">samuel</code>)</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">password</code></p> <p>可选。如果包括的话，则表示密码 (上面的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">pass</code>)</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">tld</code></p> <p>可选。顶级域名 (上面的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">com</code>)，<strong>注意：这对于任何两级域都是错误的，例如 “co.uk”</strong>。如果您需要完整的TLD验证，则需要实施自己的TLD列表。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">port</code></p> <p>可选。表示端口(上面的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">8000</code>)</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">path</code></p> <p>可选。表示路径(上面的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">/the/path/</code>)</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">query</code></p> <p>可选。表示 URL 查询 (也叫查询字符串或 GET 参数) (上面的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">query=here</code>)</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">fragment</code></p> <p>可选。片段 (上面的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">fragment=is;this=bit</code>)</p> </li></ul> 
<p>如果需要进一步的验证，验证器可以使用这些属性来强制执行特定的行为：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel<span class="token punctuation">,</span> HttpUrl<span class="token punctuation">,</span> PostgresDsn<span class="token punctuation">,</span> ValidationError<span class="token punctuation">,</span> validator


<span class="token keyword">class</span> <span class="token class-name">MyModel</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
url<span class="token punctuation">:</span> HttpUrl


m <span class="token operator">=</span> MyModel<span class="token punctuation">(</span>url<span class="token operator">=</span><span class="token string">'http://www.example.com'</span><span class="token punctuation">)</span>

<span class="token comment"># the repr() method for a url will display all properties of the url</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">repr</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; HttpUrl('http://www.example.com', scheme='http', host='www.example.com',</span>
<span class="token comment">#&gt; tld='com', host_type='domain')</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>url<span class="token punctuation">.</span>scheme<span class="token punctuation">)</span>
<span class="token comment">#&gt; http</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>url<span class="token punctuation">.</span>host<span class="token punctuation">)</span>
<span class="token comment">#&gt; www.example.com</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>url<span class="token punctuation">.</span>host_type<span class="token punctuation">)</span>
<span class="token comment">#&gt; domain</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>url<span class="token punctuation">.</span>port<span class="token punctuation">)</span>
<span class="token comment">#&gt; None</span>


<span class="token keyword">class</span> <span class="token class-name">MyDatabaseModel</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
db<span class="token punctuation">:</span> PostgresDsn

@validator<span class="token punctuation">(</span><span class="token string">'db'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">check_db_name</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">assert</span> v<span class="token punctuation">.</span>path <span class="token operator">and</span> <span class="token builtin">len</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>path<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'database must be provided'</span>
    <span class="token keyword">return</span> v


m <span class="token operator">=</span> MyDatabaseModel<span class="token punctuation">(</span>db<span class="token operator">=</span><span class="token string">'postgres://user:pass@localhost:5432/foobar'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>db<span class="token punctuation">)</span>
<span class="token comment">#&gt; postgres://user:pass@localhost:5432/foobar</span>

<span class="token keyword">try</span><span class="token punctuation">:</span>
MyDatabaseModel<span class="token punctuation">(</span>db<span class="token operator">=</span><span class="token string">'postgres://user:pass@localhost:5432'</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> ValidationError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
1 validation error for MyDatabaseModel
db
  database must be provided (type=assertion_error)
"""</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li><li style="color: rgb(153, 153, 153);">33</li><li style="color: rgb(153, 153, 153);">34</li><li style="color: rgb(153, 153, 153);">35</li><li style="color: rgb(153, 153, 153);">36</li><li style="color: rgb(153, 153, 153);">37</li><li style="color: rgb(153, 153, 153);">38</li><li style="color: rgb(153, 153, 153);">39</li><li style="color: rgb(153, 153, 153);">40</li><li style="color: rgb(153, 153, 153);">41</li><li style="color: rgb(153, 153, 153);">42</li><li style="color: rgb(153, 153, 153);">43</li><li style="color: rgb(153, 153, 153);">44</li><li style="color: rgb(153, 153, 153);">45</li></ul></pre> 
<h5><a id="32312__2750"></a>3.2.3.1.2 国际域名</h5> 
<p>“国际域名” (例如，主机或TLD包含非ASCII字符的URL) 将通过<a href="https://en.wikipedia.org/wiki/Punycode" target="_blank">punycode</a>进行编码（请参见<a href="https://www.xudongz.com/blog/2017/idn-phishing/" target="_blank">本文</a>，以了解其重要性的详细说明）：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel<span class="token punctuation">,</span> HttpUrl


<span class="token keyword">class</span> <span class="token class-name">MyModel</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
url<span class="token punctuation">:</span> HttpUrl


m1 <span class="token operator">=</span> MyModel<span class="token punctuation">(</span>url<span class="token operator">=</span><span class="token string">'http://puny£code.com'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>m1<span class="token punctuation">.</span>url<span class="token punctuation">)</span>
<span class="token comment">#&gt; http://xn--punycode-eja.com</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>m1<span class="token punctuation">.</span>url<span class="token punctuation">.</span>host_type<span class="token punctuation">)</span>
<span class="token comment">#&gt; int_domain</span>
m2 <span class="token operator">=</span> MyModel<span class="token punctuation">(</span>url<span class="token operator">=</span><span class="token string">'https://www.аррӏе.com/'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>m2<span class="token punctuation">.</span>url<span class="token punctuation">)</span>
<span class="token comment">#&gt; https://www.xn--80ak6aa92e.com/</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>m2<span class="token punctuation">.</span>url<span class="token punctuation">.</span>host_type<span class="token punctuation">)</span>
<span class="token comment">#&gt; int_domain</span>
m3 <span class="token operator">=</span> MyModel<span class="token punctuation">(</span>url<span class="token operator">=</span><span class="token string">'https://www.example.珠宝/'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>m3<span class="token punctuation">.</span>url<span class="token punctuation">)</span>
<span class="token comment">#&gt; https://www.example.xn--pbt977c/</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>m3<span class="token punctuation">.</span>url<span class="token punctuation">.</span>host_type<span class="token punctuation">)</span>
<span class="token comment">#&gt; int_domain</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li></ul></pre> 
<h5><a id="32313__2779"></a>3.2.3.1.3 主机名中的下划线</h5> 
<blockquote> 
<p><mark>警告</mark></p> 
<p>在Pydantic中，除TLD之外，域的所有部分都允许使用下划线。 从技术上讲，这可能是错误的——理论上，主机名不能带有下划线，而子域可以。</p> 
<p>要解释这个，请考虑下面两种情况：</p> 
<ul><li><code style="user-select: auto;" onclick="mdcp.copyCode(event)">exam_ple.co.uk</code> 主机名是 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">exam_ple</code>，这是不被允许的，因为它包含一个下划线。</li><li><code style="user-select: auto;" onclick="mdcp.copyCode(event)">foo_bar.example.com</code> 主机名是 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">example</code>，这是被允许的，因为下划线在子域中。</li></ul> 
<p>如果没有详尽的TLD列表，就不可能在这两者之间进行区分。 因此，可以使用下划线，但是如果需要，您始终可以在验证器中进行进一步的验证。</p> 
<p>另外，Chrome，Firefox和Safari当前都接受 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">http://exam_ple.com</code> 作为URL，因此我们是一家优秀（至少是大型）公司。</p> 
</blockquote> 
<h4><a id="3232_Color__2794"></a>3.2.3.2 Color 类型</h4> 
<p>您可以根据<a href="http://www.w3.org/TR/css3-color/#svg-color" target="_blank">CSS3规范</a>使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Color</code> 数据类型存储颜色。 可以通过以下方式定义颜色：</p> 
<ul><li><a href="http://www.w3.org/TR/SVG11/types.html#ColorKeywords" target="_blank">名称</a> (例如 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">"Black"</code>、<code style="user-select: auto;" onclick="mdcp.copyCode(event)">"azure"</code> )</li><li><a href="https://en.wikipedia.org/wiki/Web_colors#Hex_triplet" target="_blank">十六进制值</a> (例如 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">"0x000"</code>，<code style="user-select: auto;" onclick="mdcp.copyCode(event)">"#FFFFFF"</code>，<code style="user-select: auto;" onclick="mdcp.copyCode(event)">"7fffd4"</code> )</li><li>RGB/RGBA 元组 (例如 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">(255, 255, 255)</code>，<code style="user-select: auto;" onclick="mdcp.copyCode(event)">(255, 255, 255, 0.5)</code> )</li><li><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/color_value#RGB_colors" target="_blank">RGB/RGBA 字符串</a> (例如 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">"rgb(255, 255, 255)"</code>，<code style="user-select: auto;" onclick="mdcp.copyCode(event)">"rgba(255, 255, 255, 0.5)"</code> )</li><li><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/color_value#HSL_colors" target="_blank">HSL 字符串</a> (例如 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">"hsl(270, 60%, 70%)"</code>，<code style="user-select: auto;" onclick="mdcp.copyCode(event)">"hsl(270, 60%, 70%, .5)"</code> )</li></ul> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel<span class="token punctuation">,</span> ValidationError
<span class="token keyword">from</span> pydantic<span class="token punctuation">.</span>color <span class="token keyword">import</span> Color

c <span class="token operator">=</span> Color<span class="token punctuation">(</span><span class="token string">'ff00ff'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>as_named<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; magenta</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>as_hex<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; #f0f</span>
c2 <span class="token operator">=</span> Color<span class="token punctuation">(</span><span class="token string">'green'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>c2<span class="token punctuation">.</span>as_rgb_tuple<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; (0, 128, 0)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>c2<span class="token punctuation">.</span>original<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; green</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">repr</span><span class="token punctuation">(</span>Color<span class="token punctuation">(</span><span class="token string">'hsl(180, 100%, 50%)'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; Color('cyan', rgb=(0, 255, 255))</span>


<span class="token keyword">class</span> <span class="token class-name">Model</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
color<span class="token punctuation">:</span> Color


<span class="token keyword">print</span><span class="token punctuation">(</span>Model<span class="token punctuation">(</span>color<span class="token operator">=</span><span class="token string">'purple'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; color=Color('purple', rgb=(128, 0, 128))</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
Model<span class="token punctuation">(</span>color<span class="token operator">=</span><span class="token string">'hello'</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> ValidationError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token string">""</span>"
<span class="token number">1</span> validation error <span class="token keyword">for</span> Model
color
  value <span class="token keyword">is</span> <span class="token operator">not</span> a valid color<span class="token punctuation">:</span> string <span class="token operator">not</span> recognised <span class="token keyword">as</span> a valid color
<span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span>value_error<span class="token punctuation">.</span>color<span class="token punctuation">;</span> reason<span class="token operator">=</span>string <span class="token operator">not</span> recognised <span class="token keyword">as</span> a 
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li></ul></pre> 
<p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">Color</code> 有下面一些方法：</p> 
<ul><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">original</code></p> <p>传递给 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Color</code> 的原始字符串或元组。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">as_named</code></p> <p>返回一个命名的CSS3的颜色；如果设置了Alpha通道或不存在这种颜色，则会失败。如果提供 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">fallback=True</code>，则回退到 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">as_hex</code>。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">as_hex</code></p> <p>返回格式为 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">#fff</code> 或 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">#ffffff</code> 的字符串； 如果设置了Alpha通道，则将包含4(或8)个十六进制值，例如 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">#7f33cc26</code> 。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">as_rgb</code></p> <p>如果设置了Alpha通道，则返回格式为 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">rgb(&lt;red&gt;, &lt;green&gt;, &lt;blue&gt;)</code> 或 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">rgba(&lt;red&gt;, &lt;green&gt;, &lt;blue&gt;, &lt;alpha&gt;)</code> 的字符串。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">as_rgb_tuple</code></p> <p>以RGB(a) 格式返回3元组或4元组。 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">alpha</code> 关键字参数可用于定义是否应包含alpha通道； 选项：<code style="user-select: auto;" onclick="mdcp.copyCode(event)">True</code>——始终包含，<code style="user-select: auto;" onclick="mdcp.copyCode(event)">False</code>——从不包含，<code style="user-select: auto;" onclick="mdcp.copyCode(event)">None</code>(默认值)——如果设置，则包含。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">as_hsl</code></p> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">hsl(&lt;hue deg&gt;, &lt;saturation %&gt;, &lt;lightness %&gt;)</code> 格式的字符串。如果设置了 alpha 通道，则为 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">hsl(&lt;hue deg&gt;, &lt;saturation %&gt;, &lt;lightness %&gt;, &lt;alpha&gt;)</code>。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">as_hsl_tuple</code></p> <p>以HSL(a)格式返回3元组或4元组。 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">alpha</code> 关键字参数可用于定义是否应包含alpha通道； 选项：<code style="user-select: auto;" onclick="mdcp.copyCode(event)">True</code>——始终包含，<code style="user-select: auto;" onclick="mdcp.copyCode(event)">False</code>——从不包含，<code style="user-select: auto;" onclick="mdcp.copyCode(event)">None</code>(默认值)——如果设置，则包含。</p> </li></ul> 
<p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">Color</code> 的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">__str__</code> 方法返回 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">self.as_named(fallback=True)</code>。</p> 
<blockquote> 
<p><mark>注意</mark></p> 
<p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">as_hsl*</code> 是指html和世界上大多数地方使用的色相，饱和度和亮度 “HSL”，而不是Python的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">colorsys</code> 中使用的 “HLS”。</p> 
</blockquote> 
<h4><a id="3233_Secret__2875"></a>3.2.3.3 Secret 类型</h4> 
<p>您可以使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">SecretStr</code> 和 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">SecretBytes</code> 数据类型来存储不想在日志记录或回溯中可见的敏感信息。<code style="user-select: auto;" onclick="mdcp.copyCode(event)">SecretStr</code> 和 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">SecretBytes</code> 可以幂等初始化，也可以分别使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">str</code> 或 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">bytes</code> 字面量初始化。 在转换为json时，<code style="user-select: auto;" onclick="mdcp.copyCode(event)">SecretStr</code> 和 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">SecretBytes</code> 的格式将为 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">'**********'</code> 或 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">''</code>。</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel<span class="token punctuation">,</span> SecretStr<span class="token punctuation">,</span> SecretBytes<span class="token punctuation">,</span> ValidationError


<span class="token keyword">class</span> <span class="token class-name">SimpleModel</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
password<span class="token punctuation">:</span> SecretStr
password_bytes<span class="token punctuation">:</span> SecretBytes


sm <span class="token operator">=</span> SimpleModel<span class="token punctuation">(</span>password<span class="token operator">=</span><span class="token string">'IAmSensitive'</span><span class="token punctuation">,</span> password_bytes<span class="token operator">=</span>b<span class="token string">'IAmSensitiveBytes'</span><span class="token punctuation">)</span>

<span class="token comment"># Standard access methods will not display the secret</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>sm<span class="token punctuation">)</span>
<span class="token comment">#&gt; password=SecretStr('**********') password_bytes=SecretBytes(b'**********')</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>sm<span class="token punctuation">.</span>password<span class="token punctuation">)</span>
<span class="token comment">#&gt; **********</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>sm<span class="token punctuation">.</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
{
'password': SecretStr('**********'),
'password_bytes': SecretBytes(b'**********'),
}
"""</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>sm<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; {"password": "**********", "password_bytes": "**********"}</span>

<span class="token comment"># Use get_secret_value method to see the secret's content.</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>sm<span class="token punctuation">.</span>password<span class="token punctuation">.</span>get_secret_value<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; IAmSensitive</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>sm<span class="token punctuation">.</span>password_bytes<span class="token punctuation">.</span>get_secret_value<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; b'IAmSensitiveBytes'</span>

<span class="token keyword">try</span><span class="token punctuation">:</span>
SimpleModel<span class="token punctuation">(</span>password<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> password_bytes<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> ValidationError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
2 validation errors for SimpleModel
password
  str type expected (type=type_error.str)
password_bytes
  byte type expected (type=type_error.bytes)
"""</span>


<span class="token comment"># If you want the secret to be dumped as plain-text using the json method,</span>
<span class="token comment"># you can use json_encoders in the Config class.</span>
<span class="token keyword">class</span> <span class="token class-name">SimpleModelDumpable</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
password<span class="token punctuation">:</span> SecretStr
password_bytes<span class="token punctuation">:</span> SecretBytes

<span class="token keyword">class</span> <span class="token class-name">Config</span><span class="token punctuation">:</span>
    json_encoders <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        SecretStr<span class="token punctuation">:</span> <span class="token keyword">lambda</span> v<span class="token punctuation">:</span> v<span class="token punctuation">.</span>get_secret_value<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">if</span> v <span class="token keyword">else</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
        SecretBytes<span class="token punctuation">:</span> <span class="token keyword">lambda</span> v<span class="token punctuation">:</span> v<span class="token punctuation">.</span>get_secret_value<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">if</span> v <span class="token keyword">else</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>


sm2 <span class="token operator">=</span> SimpleModelDumpable<span class="token punctuation">(</span>
password<span class="token operator">=</span><span class="token string">'IAmSensitive'</span><span class="token punctuation">,</span> password_bytes<span class="token operator">=</span>b<span class="token string">'IAmSensitiveBytes'</span>
<span class="token punctuation">)</span>

<span class="token comment"># Standard access methods will not display the secret</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>sm2<span class="token punctuation">)</span>
<span class="token comment">#&gt; password=SecretStr('**********') password_bytes=SecretBytes(b'**********')</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>sm2<span class="token punctuation">.</span>password<span class="token punctuation">)</span>
<span class="token comment">#&gt; **********</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>sm2<span class="token punctuation">.</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
{
'password': SecretStr('**********'),
'password_bytes': SecretBytes(b'**********'),
}
"""</span>

<span class="token comment"># But the json method will</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>sm2<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; {"password": "IAmSensitive", "password_bytes": "IAmSensitiveBytes"}</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li><li style="color: rgb(153, 153, 153);">33</li><li style="color: rgb(153, 153, 153);">34</li><li style="color: rgb(153, 153, 153);">35</li><li style="color: rgb(153, 153, 153);">36</li><li style="color: rgb(153, 153, 153);">37</li><li style="color: rgb(153, 153, 153);">38</li><li style="color: rgb(153, 153, 153);">39</li><li style="color: rgb(153, 153, 153);">40</li><li style="color: rgb(153, 153, 153);">41</li><li style="color: rgb(153, 153, 153);">42</li><li style="color: rgb(153, 153, 153);">43</li><li style="color: rgb(153, 153, 153);">44</li><li style="color: rgb(153, 153, 153);">45</li><li style="color: rgb(153, 153, 153);">46</li><li style="color: rgb(153, 153, 153);">47</li><li style="color: rgb(153, 153, 153);">48</li><li style="color: rgb(153, 153, 153);">49</li><li style="color: rgb(153, 153, 153);">50</li><li style="color: rgb(153, 153, 153);">51</li><li style="color: rgb(153, 153, 153);">52</li><li style="color: rgb(153, 153, 153);">53</li><li style="color: rgb(153, 153, 153);">54</li><li style="color: rgb(153, 153, 153);">55</li><li style="color: rgb(153, 153, 153);">56</li><li style="color: rgb(153, 153, 153);">57</li><li style="color: rgb(153, 153, 153);">58</li><li style="color: rgb(153, 153, 153);">59</li><li style="color: rgb(153, 153, 153);">60</li><li style="color: rgb(153, 153, 153);">61</li><li style="color: rgb(153, 153, 153);">62</li><li style="color: rgb(153, 153, 153);">63</li><li style="color: rgb(153, 153, 153);">64</li><li style="color: rgb(153, 153, 153);">65</li><li style="color: rgb(153, 153, 153);">66</li><li style="color: rgb(153, 153, 153);">67</li><li style="color: rgb(153, 153, 153);">68</li><li style="color: rgb(153, 153, 153);">69</li><li style="color: rgb(153, 153, 153);">70</li><li style="color: rgb(153, 153, 153);">71</li><li style="color: rgb(153, 153, 153);">72</li><li style="color: rgb(153, 153, 153);">73</li><li style="color: rgb(153, 153, 153);">74</li><li style="color: rgb(153, 153, 153);">75</li><li style="color: rgb(153, 153, 153);">76</li><li style="color: rgb(153, 153, 153);">77</li></ul></pre> 
<h4><a id="3234_Json__2959"></a>3.2.3.4 Json 类型</h4> 
<p>可以使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Json</code> 数据类型使pydantic加载原始JSON字符串。 还可以根据 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Json</code> 的参数化类型来选择将加载的对象解析为另一种类型：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> typing <span class="token keyword">import</span> List

<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel<span class="token punctuation">,</span> Json<span class="token punctuation">,</span> ValidationError


<span class="token keyword">class</span> <span class="token class-name">SimpleJsonModel</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
json_obj<span class="token punctuation">:</span> Json


<span class="token keyword">class</span> <span class="token class-name">ComplexJsonModel</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
json_obj<span class="token punctuation">:</span> Json<span class="token punctuation">[</span>List<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">]</span>


<span class="token keyword">print</span><span class="token punctuation">(</span>SimpleJsonModel<span class="token punctuation">(</span>json_obj<span class="token operator">=</span><span class="token string">'{"b": 1}'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; json_obj={'b': 1}</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ComplexJsonModel<span class="token punctuation">(</span>json_obj<span class="token operator">=</span><span class="token string">'[1, 2, 3]'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; json_obj=[1, 2, 3]</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
ComplexJsonModel<span class="token punctuation">(</span>json_obj<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> ValidationError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
1 validation error for ComplexJsonModel
json_obj
  JSON object must be str, bytes or bytearray (type=type_error.json)
"""</span>

<span class="token keyword">try</span><span class="token punctuation">:</span>
ComplexJsonModel<span class="token punctuation">(</span>json_obj<span class="token operator">=</span><span class="token string">'[a, b]'</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> ValidationError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
1 validation error for ComplexJsonModel
json_obj
  Invalid JSON (type=value_error.json)
"""</span>

<span class="token keyword">try</span><span class="token punctuation">:</span>
ComplexJsonModel<span class="token punctuation">(</span>json_obj<span class="token operator">=</span><span class="token string">'["a", "b"]'</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> ValidationError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
2 validation errors for ComplexJsonModel
json_obj -&gt; 0
  value is not a valid integer (type=type_error.integer)
json_obj -&gt; 1
  value is not a valid integer (type=type_error.integer)
"""</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li><li style="color: rgb(153, 153, 153);">33</li><li style="color: rgb(153, 153, 153);">34</li><li style="color: rgb(153, 153, 153);">35</li><li style="color: rgb(153, 153, 153);">36</li><li style="color: rgb(153, 153, 153);">37</li><li style="color: rgb(153, 153, 153);">38</li><li style="color: rgb(153, 153, 153);">39</li><li style="color: rgb(153, 153, 153);">40</li><li style="color: rgb(153, 153, 153);">41</li><li style="color: rgb(153, 153, 153);">42</li><li style="color: rgb(153, 153, 153);">43</li><li style="color: rgb(153, 153, 153);">44</li><li style="color: rgb(153, 153, 153);">45</li><li style="color: rgb(153, 153, 153);">46</li><li style="color: rgb(153, 153, 153);">47</li><li style="color: rgb(153, 153, 153);">48</li></ul></pre> 
<h4><a id="3235_PaymentCardNumber_3014"></a>3.2.3.5 PaymentCardNumber</h4> 
<p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">PaymentCardNumber</code> 类型用于验证 <a href="https://en.wikipedia.org/wiki/Payment_card" target="_blank">支付卡</a> (例如贷记卡或信用卡)。</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> datetime <span class="token keyword">import</span> date

<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel
<span class="token keyword">from</span> pydantic<span class="token punctuation">.</span>types <span class="token keyword">import</span> PaymentCardBrand<span class="token punctuation">,</span> PaymentCardNumber<span class="token punctuation">,</span> constr


<span class="token keyword">class</span> <span class="token class-name">Card</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
name<span class="token punctuation">:</span> constr<span class="token punctuation">(</span>strip_whitespace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> min_length<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
number<span class="token punctuation">:</span> PaymentCardNumber
exp<span class="token punctuation">:</span> date

@<span class="token builtin">property</span>
<span class="token keyword">def</span> <span class="token function">brand</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> PaymentCardBrand<span class="token punctuation">:</span>
    <span class="token keyword">return</span> self<span class="token punctuation">.</span>number<span class="token punctuation">.</span>brand

@<span class="token builtin">property</span>
<span class="token keyword">def</span> <span class="token function">expired</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bool</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> self<span class="token punctuation">.</span>exp <span class="token operator">&lt;</span> date<span class="token punctuation">.</span>today<span class="token punctuation">(</span><span class="token punctuation">)</span>


card <span class="token operator">=</span> Card<span class="token punctuation">(</span>
name<span class="token operator">=</span><span class="token string">'Georg Wilhelm Friedrich Hegel'</span><span class="token punctuation">,</span>
number<span class="token operator">=</span><span class="token string">'4000000000000002'</span><span class="token punctuation">,</span>
exp<span class="token operator">=</span>date<span class="token punctuation">(</span><span class="token number">2023</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>

<span class="token keyword">assert</span> card<span class="token punctuation">.</span>number<span class="token punctuation">.</span>brand <span class="token operator">==</span> PaymentCardBrand<span class="token punctuation">.</span>visa
<span class="token keyword">assert</span> card<span class="token punctuation">.</span>number<span class="token punctuation">.</span><span class="token builtin">bin</span> <span class="token operator">==</span> <span class="token string">'400000'</span>
<span class="token keyword">assert</span> card<span class="token punctuation">.</span>number<span class="token punctuation">.</span>last4 <span class="token operator">==</span> <span class="token string">'0002'</span>
<span class="token keyword">assert</span> card<span class="token punctuation">.</span>number<span class="token punctuation">.</span>masked <span class="token operator">==</span> <span class="token string">'400000******0002'</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li></ul></pre> 
<p>基于BIN，<code style="user-select: auto;" onclick="mdcp.copyCode(event)">PaymentCardBrand</code> 可以是以下之一：</p> 
<ul><li><code style="user-select: auto;" onclick="mdcp.copyCode(event)">PaymentCardBrand.amex</code></li><li><code style="user-select: auto;" onclick="mdcp.copyCode(event)">PaymentCardBrand.mastercard</code></li><li><code style="user-select: auto;" onclick="mdcp.copyCode(event)">PaymentCardBrand.visa</code></li><li><code style="user-select: auto;" onclick="mdcp.copyCode(event)">PaymentCardBrand.other</code></li></ul> 
<p>实际验证验证卡号为：</p> 
<ul><li>仅含数字的字符串</li><li><a href="https://en.wikipedia.org/wiki/Luhn_algorithm" target="_blank">luhn</a> 有效</li><li>如果是 Amex、Mastercard 或 Visa，基于 BIN 长度正确；对于所有其他品牌，则为12至19位数字。</li></ul> 
<h3><a name="t27"></a><a id="324__3064"></a>3.2.4 约束类型</h3> 
<p>可以使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">con*</code> 类型函数来约束许多常见类型的值：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> decimal <span class="token keyword">import</span> Decimal

<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> <span class="token punctuation">(</span>
BaseModel<span class="token punctuation">,</span>
NegativeFloat<span class="token punctuation">,</span>
NegativeInt<span class="token punctuation">,</span>
PositiveFloat<span class="token punctuation">,</span>
PositiveInt<span class="token punctuation">,</span>
conbytes<span class="token punctuation">,</span>
condecimal<span class="token punctuation">,</span>
confloat<span class="token punctuation">,</span>
conint<span class="token punctuation">,</span>
conlist<span class="token punctuation">,</span>
conset<span class="token punctuation">,</span>
constr<span class="token punctuation">,</span>
Field<span class="token punctuation">,</span>
<span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">Model</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
short_bytes<span class="token punctuation">:</span> conbytes<span class="token punctuation">(</span>min_length<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> max_length<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
strip_bytes<span class="token punctuation">:</span> conbytes<span class="token punctuation">(</span>strip_whitespace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

short_str<span class="token punctuation">:</span> constr<span class="token punctuation">(</span>min_length<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> max_length<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
regex_str<span class="token punctuation">:</span> constr<span class="token punctuation">(</span>regex<span class="token operator">=</span>r<span class="token string">'^apple (pie|tart|sandwich)$'</span><span class="token punctuation">)</span>
strip_str<span class="token punctuation">:</span> constr<span class="token punctuation">(</span>strip_whitespace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

big_int<span class="token punctuation">:</span> conint<span class="token punctuation">(</span>gt<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span> lt<span class="token operator">=</span><span class="token number">1024</span><span class="token punctuation">)</span>
mod_int<span class="token punctuation">:</span> conint<span class="token punctuation">(</span>multiple_of<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
pos_int<span class="token punctuation">:</span> PositiveInt
neg_int<span class="token punctuation">:</span> NegativeInt

big_float<span class="token punctuation">:</span> confloat<span class="token punctuation">(</span>gt<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span> lt<span class="token operator">=</span><span class="token number">1024</span><span class="token punctuation">)</span>
unit_interval<span class="token punctuation">:</span> confloat<span class="token punctuation">(</span>ge<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> le<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
mod_float<span class="token punctuation">:</span> confloat<span class="token punctuation">(</span>multiple_of<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
pos_float<span class="token punctuation">:</span> PositiveFloat
neg_float<span class="token punctuation">:</span> NegativeFloat

short_list<span class="token punctuation">:</span> conlist<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> min_items<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> max_items<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
short_set<span class="token punctuation">:</span> conset<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> min_items<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> max_items<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>

decimal_positive<span class="token punctuation">:</span> condecimal<span class="token punctuation">(</span>gt<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
decimal_negative<span class="token punctuation">:</span> condecimal<span class="token punctuation">(</span>lt<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
decimal_max_digits_and_places<span class="token punctuation">:</span> condecimal<span class="token punctuation">(</span>max_digits<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> decimal_places<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
mod_decimal<span class="token punctuation">:</span> condecimal<span class="token punctuation">(</span>multiple_of<span class="token operator">=</span>Decimal<span class="token punctuation">(</span><span class="token string">'0.25'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

bigger_int<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> Field<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> gt<span class="token operator">=</span><span class="token number">10000</span><span class="token punctuation">)</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li><li style="color: rgb(153, 153, 153);">33</li><li style="color: rgb(153, 153, 153);">34</li><li style="color: rgb(153, 153, 153);">35</li><li style="color: rgb(153, 153, 153);">36</li><li style="color: rgb(153, 153, 153);">37</li><li style="color: rgb(153, 153, 153);">38</li><li style="color: rgb(153, 153, 153);">39</li><li style="color: rgb(153, 153, 153);">40</li><li style="color: rgb(153, 153, 153);">41</li><li style="color: rgb(153, 153, 153);">42</li><li style="color: rgb(153, 153, 153);">43</li><li style="color: rgb(153, 153, 153);">44</li><li style="color: rgb(153, 153, 153);">45</li><li style="color: rgb(153, 153, 153);">46</li><li style="color: rgb(153, 153, 153);">47</li></ul></pre> 
<p>其中，<code style="user-select: auto;" onclick="mdcp.copyCode(event)">Field</code> 引用 [字段函数](# 3.5.1 字段定制)。</p> 
<h3><a name="t28"></a><a id="325_Strict_3120"></a>3.2.5 Strict类型</h3> 
<p>您可以使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">StrictStr</code>，<code style="user-select: auto;" onclick="mdcp.copyCode(event)">StrictInt</code>，<code style="user-select: auto;" onclick="mdcp.copyCode(event)">StrictFloat</code> 和 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">StrictBool</code> 类型来防止兼容类型强制转换。 仅当已验证的值属于相应类型或该类型的子类型时，这些类型才会通过验证。 此行为也通过 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">ConstrainedStr</code>，<code style="user-select: auto;" onclick="mdcp.copyCode(event)">ConstrainedFloat</code> 和 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">ConstrainedInt</code> 类的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">strict</code> 字段公开，并且可以与许多复杂的验证规则结合使用。</p> 
<p>以下警告适用：</p> 
<ul><li><code style="user-select: auto;" onclick="mdcp.copyCode(event)">StrictInt</code> (和 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">ConstrainedInt</code> 的<code style="user-select: auto;" onclick="mdcp.copyCode(event)">strict</code> 选项) 不会接受 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">bool</code> 类型，即使在 Python 中 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">bool</code> 是 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">int</code> 的子类。其他子类则会被接受。</li><li><code style="user-select: auto;" onclick="mdcp.copyCode(event)">StrictFloat</code> (和 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">ConstrainedFloat</code> 的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">strict</code> 选项) 不会接受 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">int</code>。</li></ul> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel<span class="token punctuation">,</span> StrictBool<span class="token punctuation">,</span> StrictInt<span class="token punctuation">,</span> ValidationError<span class="token punctuation">,</span> confloat


<span class="token keyword">class</span> <span class="token class-name">StrictIntModel</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
strict_int<span class="token punctuation">:</span> StrictInt


<span class="token keyword">try</span><span class="token punctuation">:</span>
StrictIntModel<span class="token punctuation">(</span>strict_int<span class="token operator">=</span><span class="token number">3.14159</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> ValidationError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
1 validation error for StrictIntModel
strict_int
  value is not a valid integer (type=type_error.integer)
"""</span>


<span class="token keyword">class</span> <span class="token class-name">ConstrainedFloatModel</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
constrained_float<span class="token punctuation">:</span> confloat<span class="token punctuation">(</span>strict<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> ge<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">)</span>


<span class="token keyword">try</span><span class="token punctuation">:</span>
ConstrainedFloatModel<span class="token punctuation">(</span>constrained_float<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> ValidationError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
1 validation error for ConstrainedFloatModel
constrained_float
  value is not a valid float (type=type_error.float)
"""</span>

<span class="token keyword">try</span><span class="token punctuation">:</span>
ConstrainedFloatModel<span class="token punctuation">(</span>constrained_float<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1.23</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> ValidationError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
1 validation error for ConstrainedFloatModel
constrained_float
  ensure this value is greater than or equal to 0.0
(type=value_error.number.not_ge; limit_value=0.0)
"""</span>


<span class="token keyword">class</span> <span class="token class-name">StrictBoolModel</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
strict_bool<span class="token punctuation">:</span> StrictBool


<span class="token keyword">try</span><span class="token punctuation">:</span>
StrictBoolModel<span class="token punctuation">(</span>strict_bool<span class="token operator">=</span><span class="token string">'False'</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> ValidationError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token string">""</span>"
<span class="token number">1</span> validation error <span class="token keyword">for</span> StrictBoolModel
strict_bool
  value <span class="token keyword">is</span> <span class="token operator">not</span> a valid boolean <span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span>value_error<span class="token punctuation">.</span>strictbool<span class="token punctuation">)</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li><li style="color: rgb(153, 153, 153);">33</li><li style="color: rgb(153, 153, 153);">34</li><li style="color: rgb(153, 153, 153);">35</li><li style="color: rgb(153, 153, 153);">36</li><li style="color: rgb(153, 153, 153);">37</li><li style="color: rgb(153, 153, 153);">38</li><li style="color: rgb(153, 153, 153);">39</li><li style="color: rgb(153, 153, 153);">40</li><li style="color: rgb(153, 153, 153);">41</li><li style="color: rgb(153, 153, 153);">42</li><li style="color: rgb(153, 153, 153);">43</li><li style="color: rgb(153, 153, 153);">44</li><li style="color: rgb(153, 153, 153);">45</li><li style="color: rgb(153, 153, 153);">46</li><li style="color: rgb(153, 153, 153);">47</li><li style="color: rgb(153, 153, 153);">48</li><li style="color: rgb(153, 153, 153);">49</li><li style="color: rgb(153, 153, 153);">50</li><li style="color: rgb(153, 153, 153);">51</li><li style="color: rgb(153, 153, 153);">52</li><li style="color: rgb(153, 153, 153);">53</li><li style="color: rgb(153, 153, 153);">54</li><li style="color: rgb(153, 153, 153);">55</li><li style="color: rgb(153, 153, 153);">56</li></ul></pre> 
<h3><a name="t29"></a><a id="326_ByteSize_3188"></a>3.2.6 ByteSize</h3> 
<p>您可以使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">ByteSize</code> 数据类型将字节字符串表示形式转换为原始字节，并打印出人类可读的字节版本。</p> 
<blockquote> 
<p><mark>注意</mark></p> 
<p>注意，<code style="user-select: auto;" onclick="mdcp.copyCode(event)">1b</code> 将会被解析为 “1 bytes”，而不是 “1 bit”。</p> 
</blockquote> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel<span class="token punctuation">,</span> ByteSize


<span class="token keyword">class</span> <span class="token class-name">MyModel</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
size<span class="token punctuation">:</span> ByteSize


<span class="token keyword">print</span><span class="token punctuation">(</span>MyModel<span class="token punctuation">(</span>size<span class="token operator">=</span><span class="token number">52000</span><span class="token punctuation">)</span><span class="token punctuation">.</span>size<span class="token punctuation">)</span>
<span class="token comment">#&gt; 52000</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>MyModel<span class="token punctuation">(</span>size<span class="token operator">=</span><span class="token string">'3000 KiB'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>size<span class="token punctuation">)</span>
<span class="token comment">#&gt; 3072000</span>

m <span class="token operator">=</span> MyModel<span class="token punctuation">(</span>size<span class="token operator">=</span><span class="token string">'50 PB'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>size<span class="token punctuation">.</span>human_readable<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; 44.4PiB</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>size<span class="token punctuation">.</span>human_readable<span class="token punctuation">(</span>decimal<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; 50.0PB</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>size<span class="token punctuation">.</span>to<span class="token punctuation">(</span><span class="token string">'TiB'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; 45474.73508864641</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li></ul></pre> 
<h3><a name="t30"></a><a id="327__3219"></a>3.2.7 自定义数据类型</h3> 
<p>你也可以定义你自己的自定义数据类型。有多种方法可以达到这个目的。</p> 
<h4><a id="3271____get_validators____3223"></a>3.2.7.1 带有 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">__get_validators__</code> 的类</h4> 
<p>使用带有 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">__get_validators__</code> 类方法的自定义类。它将被调用来使验证器解析和验证输入数据。</p> 
<blockquote> 
<p><mark>提示</mark></p> 
<p>这些验证器与[验证器](# 3.3 验证器) 中的验证器具有相同的语义，因此，你可以声明参数 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">config</code>、<code style="user-select: auto;" onclick="mdcp.copyCode(event)">field</code> 等。</p> 
</blockquote> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">import</span> re
<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel

<span class="token comment"># https://en.wikipedia.org/wiki/Postcodes_in_the_United_Kingdom#Validation</span>
post_code_regex <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span>
r<span class="token string">'(?:'</span>
r<span class="token string">'([A-Z]{1,2}[0-9][A-Z0-9]?|ASCN|STHL|TDCU|BBND|[BFS]IQQ|PCRN|TKCA) ?'</span>
r<span class="token string">'([0-9][A-Z]{2})|'</span>
r<span class="token string">'(BFPO) ?([0-9]{1,4})|'</span>
r<span class="token string">'(KY[0-9]|MSR|VG|AI)[ -]?[0-9]{4}|'</span>
r<span class="token string">'([A-Z]{2}) ?([0-9]{2})|'</span>
r<span class="token string">'(GE) ?(CX)|'</span>
r<span class="token string">'(GIR) ?(0A{2})|'</span>
r<span class="token string">'(SAN) ?(TA1)'</span>
r<span class="token string">')'</span>
<span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">PostCode</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token triple-quoted-string string">"""
Partial UK postcode validation. Note: this is just an example, and is not
intended for use in production; in particular this does NOT guarantee
a postcode exists, just that it has a valid format.
"""</span>

@<span class="token builtin">classmethod</span>
<span class="token keyword">def</span> <span class="token function">__get_validators__</span><span class="token punctuation">(</span>cls<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># one or more validators may be yielded which will be called in the</span>
    <span class="token comment"># order to validate the input, each validator will receive as an input</span>
    <span class="token comment"># the value returned from the previous validator</span>
    <span class="token keyword">yield</span> cls<span class="token punctuation">.</span>validate

@<span class="token builtin">classmethod</span>
<span class="token keyword">def</span> <span class="token function">__modify_schema__</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> field_schema<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># __modify_schema__ should mutate the dict it receives in place,</span>
    <span class="token comment"># the returned value will be ignored</span>
    field_schema<span class="token punctuation">.</span>update<span class="token punctuation">(</span>
        <span class="token comment"># simplified regex here for brevity, see the wikipedia link above</span>
        pattern<span class="token operator">=</span><span class="token string">'^[A-Z]{1,2}[0-9][A-Z0-9]? ?[0-9][A-Z]{2}$'</span><span class="token punctuation">,</span>
        <span class="token comment"># some example postcodes</span>
        examples<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'SP11 9DG'</span><span class="token punctuation">,</span> <span class="token string">'w1j7bu'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>

@<span class="token builtin">classmethod</span>
<span class="token keyword">def</span> <span class="token function">validate</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token operator">not</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> TypeError<span class="token punctuation">(</span><span class="token string">'string required'</span><span class="token punctuation">)</span>
    m <span class="token operator">=</span> post_code_regex<span class="token punctuation">.</span>fullmatch<span class="token punctuation">(</span>v<span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token operator">not</span> m<span class="token punctuation">:</span>
        <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">'invalid postcode format'</span><span class="token punctuation">)</span>
    <span class="token comment"># you could also return a string here which would mean model.post_code</span>
    <span class="token comment"># would be a string, pydantic won't care but you could end up with some</span>
    <span class="token comment"># confusion since the value's type won't match the type annotation</span>
    <span class="token comment"># exactly</span>
    <span class="token keyword">return</span> cls<span class="token punctuation">(</span>f<span class="token string">'{m.group(1)} {m.group(2)}'</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">__repr__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> f<span class="token string">'PostCode({super().__repr__()})'</span>


<span class="token keyword">class</span> <span class="token class-name">Model</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
post_code<span class="token punctuation">:</span> PostCode


model <span class="token operator">=</span> Model<span class="token punctuation">(</span>post_code<span class="token operator">=</span><span class="token string">'sw8 5el'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span>
<span class="token comment">#&gt; post_code=PostCode('SW8 5EL')</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span>post_code<span class="token punctuation">)</span>
<span class="token comment">#&gt; SW8 5EL</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>Model<span class="token punctuation">.</span>schema<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
{
'title': 'Model',
'type': 'object',
'properties': {
    'post_code': {
        'title': 'Post Code',
        'pattern': '^[A-Z]{1,2}[0-9][A-Z0-9]? ?[0-9][A-Z]{2}$',
        'examples': ['SP11 9DG', 'w1j7bu'],
        'type': 'string',
    },
},
'required': ['post_code'],
}
"""</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li><li style="color: rgb(153, 153, 153);">33</li><li style="color: rgb(153, 153, 153);">34</li><li style="color: rgb(153, 153, 153);">35</li><li style="color: rgb(153, 153, 153);">36</li><li style="color: rgb(153, 153, 153);">37</li><li style="color: rgb(153, 153, 153);">38</li><li style="color: rgb(153, 153, 153);">39</li><li style="color: rgb(153, 153, 153);">40</li><li style="color: rgb(153, 153, 153);">41</li><li style="color: rgb(153, 153, 153);">42</li><li style="color: rgb(153, 153, 153);">43</li><li style="color: rgb(153, 153, 153);">44</li><li style="color: rgb(153, 153, 153);">45</li><li style="color: rgb(153, 153, 153);">46</li><li style="color: rgb(153, 153, 153);">47</li><li style="color: rgb(153, 153, 153);">48</li><li style="color: rgb(153, 153, 153);">49</li><li style="color: rgb(153, 153, 153);">50</li><li style="color: rgb(153, 153, 153);">51</li><li style="color: rgb(153, 153, 153);">52</li><li style="color: rgb(153, 153, 153);">53</li><li style="color: rgb(153, 153, 153);">54</li><li style="color: rgb(153, 153, 153);">55</li><li style="color: rgb(153, 153, 153);">56</li><li style="color: rgb(153, 153, 153);">57</li><li style="color: rgb(153, 153, 153);">58</li><li style="color: rgb(153, 153, 153);">59</li><li style="color: rgb(153, 153, 153);">60</li><li style="color: rgb(153, 153, 153);">61</li><li style="color: rgb(153, 153, 153);">62</li><li style="color: rgb(153, 153, 153);">63</li><li style="color: rgb(153, 153, 153);">64</li><li style="color: rgb(153, 153, 153);">65</li><li style="color: rgb(153, 153, 153);">66</li><li style="color: rgb(153, 153, 153);">67</li><li style="color: rgb(153, 153, 153);">68</li><li style="color: rgb(153, 153, 153);">69</li><li style="color: rgb(153, 153, 153);">70</li><li style="color: rgb(153, 153, 153);">71</li><li style="color: rgb(153, 153, 153);">72</li><li style="color: rgb(153, 153, 153);">73</li><li style="color: rgb(153, 153, 153);">74</li><li style="color: rgb(153, 153, 153);">75</li><li style="color: rgb(153, 153, 153);">76</li><li style="color: rgb(153, 153, 153);">77</li><li style="color: rgb(153, 153, 153);">78</li><li style="color: rgb(153, 153, 153);">79</li><li style="color: rgb(153, 153, 153);">80</li><li style="color: rgb(153, 153, 153);">81</li><li style="color: rgb(153, 153, 153);">82</li><li style="color: rgb(153, 153, 153);">83</li><li style="color: rgb(153, 153, 153);">84</li><li style="color: rgb(153, 153, 153);">85</li></ul></pre> 
<p>使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">constr(regex=...)</code> 可以实现类似的验证，只是该值不会用空格格式化，该模式(schema)将仅包括完整模式(pattern)，并且返回的值将是一个普通字符串。</p> 
<p>有关如何生成模型的模式的更多详细信息，请参见 [模式](# 3.5 模式)。</p> 
<h4><a id="3272__3323"></a>3.2.7.2 允许任意类型</h4> 
<p>您可以使用模型配置中的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">arbitrary_types_allowed</code> 配置来允许任意类型。</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel<span class="token punctuation">,</span> ValidationError


<span class="token comment"># This is not a pydantic model, it's an arbitrary class</span>
<span class="token keyword">class</span> <span class="token class-name">Pet</span><span class="token punctuation">:</span>
<span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    self<span class="token punctuation">.</span>name <span class="token operator">=</span> name


<span class="token keyword">class</span> <span class="token class-name">Model</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
pet<span class="token punctuation">:</span> Pet
owner<span class="token punctuation">:</span> <span class="token builtin">str</span>

<span class="token keyword">class</span> <span class="token class-name">Config</span><span class="token punctuation">:</span>
    arbitrary_types_allowed <span class="token operator">=</span> <span class="token boolean">True</span>


pet <span class="token operator">=</span> Pet<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'Hedwig'</span><span class="token punctuation">)</span>
<span class="token comment"># A simple check of instance type is used to validate the data</span>
model <span class="token operator">=</span> Model<span class="token punctuation">(</span>owner<span class="token operator">=</span><span class="token string">'Harry'</span><span class="token punctuation">,</span> pet<span class="token operator">=</span>pet<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span>
<span class="token comment">#&gt; pet=&lt;types_arbitrary_allowed.Pet object at 0x7fcb902cee50&gt; owner='Harry'</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span>pet<span class="token punctuation">)</span>
<span class="token comment">#&gt; &lt;types_arbitrary_allowed.Pet object at 0x7fcb902cee50&gt;</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span>pet<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
<span class="token comment">#&gt; Hedwig</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span>pet<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; &lt;class 'types_arbitrary_allowed.Pet'&gt;</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
<span class="token comment"># If the value is not an instance of the type, it's invalid</span>
Model<span class="token punctuation">(</span>owner<span class="token operator">=</span><span class="token string">'Harry'</span><span class="token punctuation">,</span> pet<span class="token operator">=</span><span class="token string">'Hedwig'</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> ValidationError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
1 validation error for Model
pet
  instance of Pet expected (type=type_error.arbitrary_type;
expected_arbitrary_type=Pet)
"""</span>
<span class="token comment"># Nothing in the instance of the arbitrary type is checked</span>
<span class="token comment"># Here name probably should have been a str, but it's not validated</span>
pet2 <span class="token operator">=</span> Pet<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span>
model2 <span class="token operator">=</span> Model<span class="token punctuation">(</span>owner<span class="token operator">=</span><span class="token string">'Harry'</span><span class="token punctuation">,</span> pet<span class="token operator">=</span>pet2<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>model2<span class="token punctuation">)</span>
<span class="token comment">#&gt; pet=&lt;types_arbitrary_allowed.Pet object at 0x7fcb902ce4f0&gt; owner='Harry'</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>model2<span class="token punctuation">.</span>pet<span class="token punctuation">)</span>
<span class="token comment">#&gt; &lt;types_arbitrary_allowed.Pet object at 0x7fcb902ce4f0&gt;</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>model2<span class="token punctuation">.</span>pet<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
<span class="token comment">#&gt; 42</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>model2<span class="token punctuation">.</span>pet<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; &lt;class 'types_arbitrary_allowed.Pet'&gt;</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li><li style="color: rgb(153, 153, 153);">33</li><li style="color: rgb(153, 153, 153);">34</li><li style="color: rgb(153, 153, 153);">35</li><li style="color: rgb(153, 153, 153);">36</li><li style="color: rgb(153, 153, 153);">37</li><li style="color: rgb(153, 153, 153);">38</li><li style="color: rgb(153, 153, 153);">39</li><li style="color: rgb(153, 153, 153);">40</li><li style="color: rgb(153, 153, 153);">41</li><li style="color: rgb(153, 153, 153);">42</li><li style="color: rgb(153, 153, 153);">43</li><li style="color: rgb(153, 153, 153);">44</li><li style="color: rgb(153, 153, 153);">45</li><li style="color: rgb(153, 153, 153);">46</li><li style="color: rgb(153, 153, 153);">47</li><li style="color: rgb(153, 153, 153);">48</li><li style="color: rgb(153, 153, 153);">49</li><li style="color: rgb(153, 153, 153);">50</li><li style="color: rgb(153, 153, 153);">51</li></ul></pre> 
<h4><a id="3223__3381"></a>3.2.2.3 泛型类作为类型</h4> 
<blockquote> 
<p>这是一开始可能不需要的高级技术。 在大多数情况下，使用标准的pytantic模型可能会很好。</p> 
</blockquote> 
<p>可以使用<a href="https://docs.python.org/3/library/typing.html#typing.Generic" target="_blank">泛型类</a>作为字段类型并使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">__get_validators__</code> 基于"类型参数" (或子类型)执行自定义验证。</p> 
<p>如果您要用作子类型的泛型类具有类方法(classmethod) <code style="user-select: auto;" onclick="mdcp.copyCode(event)">__get_validators__</code>，则无需使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">arbitrary_types_allowed</code> 即可工作。</p> 
<p>因为可以声明接收当前 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">field</code> 的验证器，所以可以提取 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">sub_fields</code> (从泛型类类型参数中) 并使用它们验证数据。</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel<span class="token punctuation">,</span> ValidationError
<span class="token keyword">from</span> pydantic<span class="token punctuation">.</span>fields <span class="token keyword">import</span> ModelField
<span class="token keyword">from</span> typing <span class="token keyword">import</span> TypeVar<span class="token punctuation">,</span> Generic

AgedType <span class="token operator">=</span> TypeVar<span class="token punctuation">(</span><span class="token string">'AgedType'</span><span class="token punctuation">)</span>
QualityType <span class="token operator">=</span> TypeVar<span class="token punctuation">(</span><span class="token string">'QualityType'</span><span class="token punctuation">)</span>


<span class="token comment"># This is not a pydantic model, it's an arbitrary generic class</span>
<span class="token keyword">class</span> <span class="token class-name">TastingModel</span><span class="token punctuation">(</span>Generic<span class="token punctuation">[</span>AgedType<span class="token punctuation">,</span> QualityType<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> aged<span class="token punctuation">:</span> AgedType<span class="token punctuation">,</span> quality<span class="token punctuation">:</span> QualityType<span class="token punctuation">)</span><span class="token punctuation">:</span>
    self<span class="token punctuation">.</span>name <span class="token operator">=</span> name
    self<span class="token punctuation">.</span>aged <span class="token operator">=</span> aged
    self<span class="token punctuation">.</span>quality <span class="token operator">=</span> quality

@<span class="token builtin">classmethod</span>
<span class="token keyword">def</span> <span class="token function">__get_validators__</span><span class="token punctuation">(</span>cls<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">yield</span> cls<span class="token punctuation">.</span>validate

@<span class="token builtin">classmethod</span>
<span class="token comment"># You don't need to add the "ModelField", but it will help your</span>
<span class="token comment"># editor give you completion and catch errors</span>
<span class="token keyword">def</span> <span class="token function">validate</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> v<span class="token punctuation">,</span> field<span class="token punctuation">:</span> ModelField<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token operator">not</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> cls<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># The value is not even a TastingModel</span>
        <span class="token keyword">raise</span> TypeError<span class="token punctuation">(</span><span class="token string">'Invalid value'</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token operator">not</span> field<span class="token punctuation">.</span>sub_fields<span class="token punctuation">:</span>
        <span class="token comment"># Generic parameters were not provided so we don't try to validate</span>
        <span class="token comment"># them and just return the value as is</span>
        <span class="token keyword">return</span> v
    aged_f <span class="token operator">=</span> field<span class="token punctuation">.</span>sub_fields<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    quality_f <span class="token operator">=</span> field<span class="token punctuation">.</span>sub_fields<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    errors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token comment"># Here we don't need the validated value, but we want the errors</span>
    valid_value<span class="token punctuation">,</span> error <span class="token operator">=</span> aged_f<span class="token punctuation">.</span>validate<span class="token punctuation">(</span>v<span class="token punctuation">.</span>aged<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span> loc<span class="token operator">=</span><span class="token string">'aged'</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> error<span class="token punctuation">:</span>
        errors<span class="token punctuation">.</span>append<span class="token punctuation">(</span>error<span class="token punctuation">)</span>
    <span class="token comment"># Here we don't need the validated value, but we want the errors</span>
    valid_value<span class="token punctuation">,</span> error <span class="token operator">=</span> quality_f<span class="token punctuation">.</span>validate<span class="token punctuation">(</span>v<span class="token punctuation">.</span>quality<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span> loc<span class="token operator">=</span><span class="token string">'quality'</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> error<span class="token punctuation">:</span>
        errors<span class="token punctuation">.</span>append<span class="token punctuation">(</span>error<span class="token punctuation">)</span>
    <span class="token keyword">if</span> errors<span class="token punctuation">:</span>
        <span class="token keyword">raise</span> ValidationError<span class="token punctuation">(</span>errors<span class="token punctuation">,</span> cls<span class="token punctuation">)</span>
    <span class="token comment"># Validation passed without errors, return the same instance received</span>
    <span class="token keyword">return</span> v


<span class="token keyword">class</span> <span class="token class-name">Model</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token comment"># for wine, "aged" is an int with years, "quality" is a float</span>
wine<span class="token punctuation">:</span> TastingModel<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">float</span><span class="token punctuation">]</span>
<span class="token comment"># for cheese, "aged" is a bool, "quality" is a str</span>
cheese<span class="token punctuation">:</span> TastingModel<span class="token punctuation">[</span><span class="token builtin">bool</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">]</span>
<span class="token comment"># for thing, "aged" is a Any, "quality" is Any</span>
thing<span class="token punctuation">:</span> TastingModel


model <span class="token operator">=</span> Model<span class="token punctuation">(</span>
<span class="token comment"># This wine was aged for 20 years and has a quality of 85.6</span>
wine<span class="token operator">=</span>TastingModel<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'Cabernet Sauvignon'</span><span class="token punctuation">,</span> aged<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span> quality<span class="token operator">=</span><span class="token number">85.6</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token comment"># This cheese is aged (is mature) and has "Good" quality</span>
cheese<span class="token operator">=</span>TastingModel<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'Gouda'</span><span class="token punctuation">,</span> aged<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> quality<span class="token operator">=</span><span class="token string">'Good'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token comment"># This Python thing has aged "Not much" and has a quality "Awesome"</span>
thing<span class="token operator">=</span>TastingModel<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'Python'</span><span class="token punctuation">,</span> aged<span class="token operator">=</span><span class="token string">'Not much'</span><span class="token punctuation">,</span> quality<span class="token operator">=</span><span class="token string">'Awesome'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
wine=&lt;types_generics.TastingModel object at 0x7fcb903271f0&gt;
cheese=&lt;types_generics.TastingModel object at 0x7fcb903272e0&gt;
thing=&lt;types_generics.TastingModel object at 0x7fcb903276a0&gt;
"""</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span>wine<span class="token punctuation">.</span>aged<span class="token punctuation">)</span>
<span class="token comment">#&gt; 20</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span>wine<span class="token punctuation">.</span>quality<span class="token punctuation">)</span>
<span class="token comment">#&gt; 85.6</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span>cheese<span class="token punctuation">.</span>aged<span class="token punctuation">)</span>
<span class="token comment">#&gt; True</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span>cheese<span class="token punctuation">.</span>quality<span class="token punctuation">)</span>
<span class="token comment">#&gt; Good</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span>thing<span class="token punctuation">.</span>aged<span class="token punctuation">)</span>
<span class="token comment">#&gt; Not much</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
<span class="token comment"># If the values of the sub-types are invalid, we get an error</span>
Model<span class="token punctuation">(</span>
    <span class="token comment"># For wine, aged should be an int with the years, and quality a float</span>
    wine<span class="token operator">=</span>TastingModel<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'Merlot'</span><span class="token punctuation">,</span> aged<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> quality<span class="token operator">=</span><span class="token string">'Kinda good'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment"># For cheese, aged should be a bool, and quality a str</span>
    cheese<span class="token operator">=</span>TastingModel<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'Gouda'</span><span class="token punctuation">,</span> aged<span class="token operator">=</span><span class="token string">'yeah'</span><span class="token punctuation">,</span> quality<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment"># For thing, no type parameters are declared, and we skipped validation</span>
    <span class="token comment"># in those cases in the Assessment.validate() function</span>
    thing<span class="token operator">=</span>TastingModel<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'Python'</span><span class="token punctuation">,</span> aged<span class="token operator">=</span><span class="token string">'Not much'</span><span class="token punctuation">,</span> quality<span class="token operator">=</span><span class="token string">'Awesome'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
<span class="token keyword">except</span> ValidationError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
2 validation errors for Model
wine -&gt; quality
  value is not a valid float (type=type_error.float)
cheese -&gt; aged
  value could not be parsed to a boolean (type=type_error.bool)
"""</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li><li style="color: rgb(153, 153, 153);">33</li><li style="color: rgb(153, 153, 153);">34</li><li style="color: rgb(153, 153, 153);">35</li><li style="color: rgb(153, 153, 153);">36</li><li style="color: rgb(153, 153, 153);">37</li><li style="color: rgb(153, 153, 153);">38</li><li style="color: rgb(153, 153, 153);">39</li><li style="color: rgb(153, 153, 153);">40</li><li style="color: rgb(153, 153, 153);">41</li><li style="color: rgb(153, 153, 153);">42</li><li style="color: rgb(153, 153, 153);">43</li><li style="color: rgb(153, 153, 153);">44</li><li style="color: rgb(153, 153, 153);">45</li><li style="color: rgb(153, 153, 153);">46</li><li style="color: rgb(153, 153, 153);">47</li><li style="color: rgb(153, 153, 153);">48</li><li style="color: rgb(153, 153, 153);">49</li><li style="color: rgb(153, 153, 153);">50</li><li style="color: rgb(153, 153, 153);">51</li><li style="color: rgb(153, 153, 153);">52</li><li style="color: rgb(153, 153, 153);">53</li><li style="color: rgb(153, 153, 153);">54</li><li style="color: rgb(153, 153, 153);">55</li><li style="color: rgb(153, 153, 153);">56</li><li style="color: rgb(153, 153, 153);">57</li><li style="color: rgb(153, 153, 153);">58</li><li style="color: rgb(153, 153, 153);">59</li><li style="color: rgb(153, 153, 153);">60</li><li style="color: rgb(153, 153, 153);">61</li><li style="color: rgb(153, 153, 153);">62</li><li style="color: rgb(153, 153, 153);">63</li><li style="color: rgb(153, 153, 153);">64</li><li style="color: rgb(153, 153, 153);">65</li><li style="color: rgb(153, 153, 153);">66</li><li style="color: rgb(153, 153, 153);">67</li><li style="color: rgb(153, 153, 153);">68</li><li style="color: rgb(153, 153, 153);">69</li><li style="color: rgb(153, 153, 153);">70</li><li style="color: rgb(153, 153, 153);">71</li><li style="color: rgb(153, 153, 153);">72</li><li style="color: rgb(153, 153, 153);">73</li><li style="color: rgb(153, 153, 153);">74</li><li style="color: rgb(153, 153, 153);">75</li><li style="color: rgb(153, 153, 153);">76</li><li style="color: rgb(153, 153, 153);">77</li><li style="color: rgb(153, 153, 153);">78</li><li style="color: rgb(153, 153, 153);">79</li><li style="color: rgb(153, 153, 153);">80</li><li style="color: rgb(153, 153, 153);">81</li><li style="color: rgb(153, 153, 153);">82</li><li style="color: rgb(153, 153, 153);">83</li><li style="color: rgb(153, 153, 153);">84</li><li style="color: rgb(153, 153, 153);">85</li><li style="color: rgb(153, 153, 153);">86</li><li style="color: rgb(153, 153, 153);">87</li><li style="color: rgb(153, 153, 153);">88</li><li style="color: rgb(153, 153, 153);">89</li><li style="color: rgb(153, 153, 153);">90</li><li style="color: rgb(153, 153, 153);">91</li><li style="color: rgb(153, 153, 153);">92</li><li style="color: rgb(153, 153, 153);">93</li><li style="color: rgb(153, 153, 153);">94</li><li style="color: rgb(153, 153, 153);">95</li><li style="color: rgb(153, 153, 153);">96</li><li style="color: rgb(153, 153, 153);">97</li><li style="color: rgb(153, 153, 153);">98</li><li style="color: rgb(153, 153, 153);">99</li><li style="color: rgb(153, 153, 153);">100</li></ul></pre> 
<h2><a name="t31"></a><a id="33__3494"></a>3.3 验证器</h2> 
<p>可以使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">validator</code> 装饰器实现对象之间的自定义验证和复杂关系。</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel<span class="token punctuation">,</span> ValidationError<span class="token punctuation">,</span> validator


<span class="token keyword">class</span> <span class="token class-name">UserModel</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
name<span class="token punctuation">:</span> <span class="token builtin">str</span>
username<span class="token punctuation">:</span> <span class="token builtin">str</span>
password1<span class="token punctuation">:</span> <span class="token builtin">str</span>
password2<span class="token punctuation">:</span> <span class="token builtin">str</span>

@validator<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">name_must_contain_space</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token string">' '</span> <span class="token operator">not</span> <span class="token keyword">in</span> v<span class="token punctuation">:</span>
        <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">'must contain a space'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> v<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token punctuation">)</span>

@validator<span class="token punctuation">(</span><span class="token string">'password2'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">passwords_match</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> v<span class="token punctuation">,</span> values<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token string">'password1'</span> <span class="token keyword">in</span> values <span class="token operator">and</span> v <span class="token operator">!=</span> values<span class="token punctuation">[</span><span class="token string">'password1'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">'passwords do not match'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> v

@validator<span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">username_alphanumeric</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">assert</span> v<span class="token punctuation">.</span>isalnum<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'must be alphanumeric'</span>
    <span class="token keyword">return</span> v


user <span class="token operator">=</span> UserModel<span class="token punctuation">(</span>
name<span class="token operator">=</span><span class="token string">'samuel colvin'</span><span class="token punctuation">,</span>
username<span class="token operator">=</span><span class="token string">'scolvin'</span><span class="token punctuation">,</span>
password1<span class="token operator">=</span><span class="token string">'zxcvbn'</span><span class="token punctuation">,</span>
password2<span class="token operator">=</span><span class="token string">'zxcvbn'</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>
<span class="token comment">#&gt; name='Samuel Colvin' username='scolvin' password1='zxcvbn' password2='zxcvbn'</span>

<span class="token keyword">try</span><span class="token punctuation">:</span>
UserModel<span class="token punctuation">(</span>
    name<span class="token operator">=</span><span class="token string">'samuel'</span><span class="token punctuation">,</span>
    username<span class="token operator">=</span><span class="token string">'scolvin'</span><span class="token punctuation">,</span>
    password1<span class="token operator">=</span><span class="token string">'zxcvbn'</span><span class="token punctuation">,</span>
    password2<span class="token operator">=</span><span class="token string">'zxcvbn2'</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
<span class="token keyword">except</span> ValidationError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
2 validation errors for UserModel
name
  must contain a space (type=value_error)
password2
  passwords do not match (type=value_error)
"""</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li><li style="color: rgb(153, 153, 153);">33</li><li style="color: rgb(153, 153, 153);">34</li><li style="color: rgb(153, 153, 153);">35</li><li style="color: rgb(153, 153, 153);">36</li><li style="color: rgb(153, 153, 153);">37</li><li style="color: rgb(153, 153, 153);">38</li><li style="color: rgb(153, 153, 153);">39</li><li style="color: rgb(153, 153, 153);">40</li><li style="color: rgb(153, 153, 153);">41</li><li style="color: rgb(153, 153, 153);">42</li><li style="color: rgb(153, 153, 153);">43</li><li style="color: rgb(153, 153, 153);">44</li><li style="color: rgb(153, 153, 153);">45</li><li style="color: rgb(153, 153, 153);">46</li><li style="color: rgb(153, 153, 153);">47</li><li style="color: rgb(153, 153, 153);">48</li><li style="color: rgb(153, 153, 153);">49</li><li style="color: rgb(153, 153, 153);">50</li><li style="color: rgb(153, 153, 153);">51</li><li style="color: rgb(153, 153, 153);">52</li></ul></pre> 
<p>验证器上应该注意的几件事：</p> 
<ul><li> <p>验证器是类方法(class method)，所以其接收到的第一个参数值是 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">UserModel</code> 类，而不是 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">UserModel</code> 类的实例。</p> </li><li> <p>第二个参数总是要验证的字段值。</p> </li><li> <p>可以将下面参数的任意子集添加到签名中(<strong>参数名必须匹配</strong>)</p> 
<ul><li><code style="user-select: auto;" onclick="mdcp.copyCode(event)">values</code> 之前已验证字段的字段名到字段值的映射。</li><li><code style="user-select: auto;" onclick="mdcp.copyCode(event)">config</code> 模型配置。</li><li><code style="user-select: auto;" onclick="mdcp.copyCode(event)">field</code> 要验证的字段。</li><li><code style="user-select: auto;" onclick="mdcp.copyCode(event)">**kwargs</code> 如果提供，则包含上面这些参数中未在签名中显式列出的参数。</li></ul> </li><li> <p>验证器应该返回解析的值或者引发 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">ValueError</code>、<code style="user-select: auto;" onclick="mdcp.copyCode(event)">TypeError</code> 或 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">AssertionError</code> (可以使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">assert</code> 语句)。</p> 
<blockquote> 
<p><mark>警告</mark></p> 
<p>如果你使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">assert</code> 语句，那么请注意， 带有 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">-O</code> <a href="https://docs.python.org/3/using/cmdline.html#cmdoption-o" target="_blank">优化标志</a> 的 Python 将会禁用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">assert</code> 语句，导致验证器停止工作。</p> 
</blockquote> </li><li> <p>当验证器依赖于其他值时，你应该知道：</p> 
<ul><li>验证按照字段被定义的顺序完成。例如，在上面的示例中，<code style="user-select: auto;" onclick="mdcp.copyCode(event)">password2</code> 可以访问 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">password1</code> (和 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">name</code>)，但 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">password1</code> 不能访问 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">password2</code>。关于字段如何排序的详细信息，请参考 [字段排序](# 3.1.11 字段排序)。</li><li>如果在其他字段上验证失败 (或那个字段缺失)，则它不会被包含在 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">values</code> 中，因此，在示例中使用了 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">if 'password1' in values and ...</code> 来进行判断。</li></ul> </li></ul> 
<h3><a name="t32"></a><a id="331_Pre__peritem__3577"></a>3.3.1 Pre 和 per-item 验证器</h3> 
<p>验证器可以做更复杂的事情：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> typing <span class="token keyword">import</span> List
<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel<span class="token punctuation">,</span> ValidationError<span class="token punctuation">,</span> validator


<span class="token keyword">class</span> <span class="token class-name">DemoModel</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
square_numbers<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
cube_numbers<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token comment"># '*' is the same as 'cube_numbers', 'square_numbers' here:</span>
@validator<span class="token punctuation">(</span><span class="token string">'*'</span><span class="token punctuation">,</span> pre<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">split_str</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> v<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> v

@validator<span class="token punctuation">(</span><span class="token string">'cube_numbers'</span><span class="token punctuation">,</span> <span class="token string">'square_numbers'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">check_sum</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">42</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">'sum of numbers greater than 42'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> v

@validator<span class="token punctuation">(</span><span class="token string">'square_numbers'</span><span class="token punctuation">,</span> each_item<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">check_squares</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">assert</span> v <span class="token operator">**</span> <span class="token number">0.5</span> <span class="token operator">%</span> <span class="token number">1</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">,</span> f<span class="token string">'{v} is not a square number'</span>
    <span class="token keyword">return</span> v

@validator<span class="token punctuation">(</span><span class="token string">'cube_numbers'</span><span class="token punctuation">,</span> each_item<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">check_cubes</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 64 ** (1 / 3) == 3.9999999999999996 (!)</span>
    <span class="token comment"># this is not a good way of checking cubes</span>
    <span class="token keyword">assert</span> v <span class="token operator">**</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">1</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">,</span> f<span class="token string">'{v} is not a cubed number'</span>
    <span class="token keyword">return</span> v


<span class="token keyword">print</span><span class="token punctuation">(</span>DemoModel<span class="token punctuation">(</span>square_numbers<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; square_numbers=[1, 4, 9] cube_numbers=[]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>DemoModel<span class="token punctuation">(</span>square_numbers<span class="token operator">=</span><span class="token string">'1|4|16'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; square_numbers=[1, 4, 16] cube_numbers=[]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>DemoModel<span class="token punctuation">(</span>square_numbers<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">,</span> cube_numbers<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; square_numbers=[16] cube_numbers=[8, 27]</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
DemoModel<span class="token punctuation">(</span>square_numbers<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> ValidationError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
1 validation error for DemoModel
square_numbers -&gt; 2
  2 is not a square number (type=assertion_error)
"""</span>

<span class="token keyword">try</span><span class="token punctuation">:</span>
DemoModel<span class="token punctuation">(</span>cube_numbers<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> ValidationError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
1 validation error for DemoModel
cube_numbers
  sum of numbers greater than 42 (type=value_error)
"""</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li><li style="color: rgb(153, 153, 153);">33</li><li style="color: rgb(153, 153, 153);">34</li><li style="color: rgb(153, 153, 153);">35</li><li style="color: rgb(153, 153, 153);">36</li><li style="color: rgb(153, 153, 153);">37</li><li style="color: rgb(153, 153, 153);">38</li><li style="color: rgb(153, 153, 153);">39</li><li style="color: rgb(153, 153, 153);">40</li><li style="color: rgb(153, 153, 153);">41</li><li style="color: rgb(153, 153, 153);">42</li><li style="color: rgb(153, 153, 153);">43</li><li style="color: rgb(153, 153, 153);">44</li><li style="color: rgb(153, 153, 153);">45</li><li style="color: rgb(153, 153, 153);">46</li><li style="color: rgb(153, 153, 153);">47</li><li style="color: rgb(153, 153, 153);">48</li><li style="color: rgb(153, 153, 153);">49</li><li style="color: rgb(153, 153, 153);">50</li><li style="color: rgb(153, 153, 153);">51</li><li style="color: rgb(153, 153, 153);">52</li><li style="color: rgb(153, 153, 153);">53</li><li style="color: rgb(153, 153, 153);">54</li><li style="color: rgb(153, 153, 153);">55</li><li style="color: rgb(153, 153, 153);">56</li><li style="color: rgb(153, 153, 153);">57</li><li style="color: rgb(153, 153, 153);">58</li><li style="color: rgb(153, 153, 153);">59</li></ul></pre> 
<p>需要注意的事情：</p> 
<ul><li>可以通过给单个验证器传递多个字段名称将其应用于多个字段。</li><li>可以通过给单个验证器传递特殊的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">*</code> 值将其应用于<strong>所有</strong>字段。</li><li>关键字参数 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">pre</code> 将会导致该验证器的调用优先于其他验证器。</li><li>传递 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">each_item=True</code> 将会导致验证器应用于可迭代对象中的每个值(例如，<code style="user-select: auto;" onclick="mdcp.copyCode(event)">List</code>、<code style="user-select: auto;" onclick="mdcp.copyCode(event)">Dict</code> 和 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Set</code> 等)，而不是整个对象。</li></ul> 
<h3><a name="t33"></a><a id="332__each_item_3650"></a>3.3.2 子类验证器和 each_item</h3> 
<p>如果将验证器与引用父类上 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">List</code> 类型字段的子类一起使用，那么 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">each_item=True</code> 将导致验证器无法运行；相反，必须以编程方式遍历该列表。</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> typing <span class="token keyword">import</span> List
<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel<span class="token punctuation">,</span> ValidationError<span class="token punctuation">,</span> validator


<span class="token keyword">class</span> <span class="token class-name">ParentModel</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
names<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span>


<span class="token keyword">class</span> <span class="token class-name">ChildModel</span><span class="token punctuation">(</span>ParentModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
@validator<span class="token punctuation">(</span><span class="token string">'names'</span><span class="token punctuation">,</span> each_item<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">check_names_not_empty</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">assert</span> v <span class="token operator">!=</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'Empty strings are not allowed.'</span>
    <span class="token keyword">return</span> v


<span class="token comment"># This will NOT raise a ValidationError because the validator was not called</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
child <span class="token operator">=</span> ChildModel<span class="token punctuation">(</span>names<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'Alice'</span><span class="token punctuation">,</span> <span class="token string">'Bob'</span><span class="token punctuation">,</span> <span class="token string">'Eve'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> ValidationError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'No ValidationError caught.'</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; No ValidationError caught.</span>


<span class="token keyword">class</span> <span class="token class-name">ChildModel2</span><span class="token punctuation">(</span>ParentModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
@validator<span class="token punctuation">(</span><span class="token string">'names'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">check_names_not_empty</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> name <span class="token keyword">in</span> v<span class="token punctuation">:</span>
        <span class="token keyword">assert</span> name <span class="token operator">!=</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'Empty strings are not allowed.'</span>
    <span class="token keyword">return</span> v


<span class="token keyword">try</span><span class="token punctuation">:</span>
child <span class="token operator">=</span> ChildModel2<span class="token punctuation">(</span>names<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'Alice'</span><span class="token punctuation">,</span> <span class="token string">'Bob'</span><span class="token punctuation">,</span> <span class="token string">'Eve'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> ValidationError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
1 validation error for ChildModel2
names
  Empty strings are not allowed. (type=assertion_error)
"""</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li><li style="color: rgb(153, 153, 153);">33</li><li style="color: rgb(153, 153, 153);">34</li><li style="color: rgb(153, 153, 153);">35</li><li style="color: rgb(153, 153, 153);">36</li><li style="color: rgb(153, 153, 153);">37</li><li style="color: rgb(153, 153, 153);">38</li><li style="color: rgb(153, 153, 153);">39</li><li style="color: rgb(153, 153, 153);">40</li><li style="color: rgb(153, 153, 153);">41</li><li style="color: rgb(153, 153, 153);">42</li></ul></pre> 
<h3><a name="t34"></a><a id="333_Always_3699"></a>3.3.3 Always验证</h3> 
<p>出于性能原因，在没有提供值时，默认情况下不会为字段调用验证器。然而，在某些情况下，调用验证器可能是有用的或必需的，例如，设置一个动态默认值。</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime

<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel<span class="token punctuation">,</span> validator


<span class="token keyword">class</span> <span class="token class-name">DemoModel</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
ts<span class="token punctuation">:</span> datetime <span class="token operator">=</span> <span class="token boolean">None</span>

@validator<span class="token punctuation">(</span><span class="token string">'ts'</span><span class="token punctuation">,</span> pre<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> always<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">set_ts_now</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> v <span class="token operator">or</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">print</span><span class="token punctuation">(</span>DemoModel<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; ts=datetime.datetime(2020, 10, 28, 20, 3, 33, 424317)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>DemoModel<span class="token punctuation">(</span>ts<span class="token operator">=</span><span class="token string">'2017-11-08T14:00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; ts=datetime.datetime(2017, 11, 8, 14, 0)</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li></ul></pre> 
<p>注意，最好将 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">always=True</code> 和 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">pre=True</code> 一起使用，否则，当 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">always=True</code> 时，pydantic会尝试对默认值 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">None</code> 进行验证，从而导致错误。</p> 
<h3><a name="t35"></a><a id="334__3725"></a>3.3.4 复用验证器</h3> 
<p>有时，你会想要在多个 字段/模型 上使用相同的验证器(例如，规范化一些输入数据)。最容易想到的方法就是编写一个单独的函数，然后从多个装饰器进行调用。显然，这需要大量的重复和样板代码。为了避免这种情况，已经在 <strong>v1.2</strong> 中为 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">pydantic.validator</code> 添加了 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">allow_reuse</code> 参数(默认值为 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">False</code>)：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel<span class="token punctuation">,</span> validator


<span class="token keyword">def</span> <span class="token function">normalize</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">str</span><span class="token punctuation">:</span>
<span class="token keyword">return</span> <span class="token string">' '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">(</span>word<span class="token punctuation">.</span>capitalize<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> word <span class="token keyword">in</span> name<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">Producer</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
name<span class="token punctuation">:</span> <span class="token builtin">str</span>

<span class="token comment"># validators</span>
_normalize_name <span class="token operator">=</span> validator<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> allow_reuse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">(</span>normalize<span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">Consumer</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
name<span class="token punctuation">:</span> <span class="token builtin">str</span>

<span class="token comment"># validators</span>
_normalize_name <span class="token operator">=</span> validator<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> allow_reuse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">(</span>normalize<span class="token punctuation">)</span>


jane_doe <span class="token operator">=</span> Producer<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'JaNe DOE'</span><span class="token punctuation">)</span>
john_doe <span class="token operator">=</span> Consumer<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'joHN dOe'</span><span class="token punctuation">)</span>
<span class="token keyword">assert</span> jane_doe<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">'Jane Doe'</span>
<span class="token keyword">assert</span> john_doe<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">'John Doe'</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li></ul></pre> 
<p>很明显，重复减少了，模型再次变得几乎是声明性的。</p> 
<blockquote> 
<p><mark>提示</mark></p> 
<p>如果您有很多字段需要验证，那么通常有必要定义一个帮助函数，使用该函数可以避免一次又一次地设置 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">allow_reuse=True</code>。</p> 
<p>例如，对于上面的例子，可以将代码改写为：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> pydantic <span class="token keyword">import</span> validator<span class="token punctuation">,</span> BaseModel


@validator<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> allow_reuse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">normalize</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">str</span><span class="token punctuation">:</span>
<span class="token keyword">return</span> <span class="token string">' '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">(</span>word<span class="token punctuation">.</span>capitalize<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> word <span class="token keyword">in</span> name<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">Producer</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
name<span class="token punctuation">:</span> <span class="token builtin">str</span>

<span class="token comment"># validators</span>
_normalize_name <span class="token operator">=</span> normalize


<span class="token keyword">class</span> <span class="token class-name">Consumer</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
name<span class="token punctuation">:</span> <span class="token builtin">str</span>

<span class="token comment"># validators</span>
_normalize_name <span class="token operator">=</span> normalize


jane_doe <span class="token operator">=</span> Producer<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'JaNe DOE'</span><span class="token punctuation">)</span>
john_doe <span class="token operator">=</span> Consumer<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'joHN dOe'</span><span class="token punctuation">)</span>
<span class="token keyword">assert</span> jane_doe<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">'Jane Doe'</span>
<span class="token keyword">assert</span> john_doe<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">'John Doe'</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li></ul></pre> 
</blockquote> 
<h3><a name="t36"></a><a id="335__3794"></a>3.3.5 根验证器</h3> 
<p>验证也可以在整个模型的数据上执行。</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel<span class="token punctuation">,</span> ValidationError<span class="token punctuation">,</span> root_validator


<span class="token keyword">class</span> <span class="token class-name">UserModel</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
username<span class="token punctuation">:</span> <span class="token builtin">str</span>
password1<span class="token punctuation">:</span> <span class="token builtin">str</span>
password2<span class="token punctuation">:</span> <span class="token builtin">str</span>

@root_validator<span class="token punctuation">(</span>pre<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">check_card_number_omitted</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> values<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">assert</span> <span class="token string">'card_number'</span> <span class="token operator">not</span> <span class="token keyword">in</span> values<span class="token punctuation">,</span> <span class="token string">'card_number should not be included'</span>
    <span class="token keyword">return</span> values

@root_validator
<span class="token keyword">def</span> <span class="token function">check_passwords_match</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> values<span class="token punctuation">)</span><span class="token punctuation">:</span>
    pw1<span class="token punctuation">,</span> pw2 <span class="token operator">=</span> values<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'password1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> values<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'password2'</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> pw1 <span class="token keyword">is</span> <span class="token operator">not</span> <span class="token boolean">None</span> <span class="token operator">and</span> pw2 <span class="token keyword">is</span> <span class="token operator">not</span> <span class="token boolean">None</span> <span class="token operator">and</span> pw1 <span class="token operator">!=</span> pw2<span class="token punctuation">:</span>
        <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">'passwords do not match'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> values


<span class="token keyword">print</span><span class="token punctuation">(</span>UserModel<span class="token punctuation">(</span>username<span class="token operator">=</span><span class="token string">'scolvin'</span><span class="token punctuation">,</span> password1<span class="token operator">=</span><span class="token string">'zxcvbn'</span><span class="token punctuation">,</span> password2<span class="token operator">=</span><span class="token string">'zxcvbn'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; username='scolvin' password1='zxcvbn' password2='zxcvbn'</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
UserModel<span class="token punctuation">(</span>username<span class="token operator">=</span><span class="token string">'scolvin'</span><span class="token punctuation">,</span> password1<span class="token operator">=</span><span class="token string">'zxcvbn'</span><span class="token punctuation">,</span> password2<span class="token operator">=</span><span class="token string">'zxcvbn2'</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> ValidationError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
1 validation error for UserModel
__root__
  passwords do not match (type=value_error)
"""</span>

<span class="token keyword">try</span><span class="token punctuation">:</span>
UserModel<span class="token punctuation">(</span>
    username<span class="token operator">=</span><span class="token string">'scolvin'</span><span class="token punctuation">,</span>
    password1<span class="token operator">=</span><span class="token string">'zxcvbn'</span><span class="token punctuation">,</span>
    password2<span class="token operator">=</span><span class="token string">'zxcvbn'</span><span class="token punctuation">,</span>
    card_number<span class="token operator">=</span><span class="token string">'1234'</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
<span class="token keyword">except</span> ValidationError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
1 validation error for UserModel
__root__
  card_number should not be included (type=assertion_error)
"""</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li><li style="color: rgb(153, 153, 153);">33</li><li style="color: rgb(153, 153, 153);">34</li><li style="color: rgb(153, 153, 153);">35</li><li style="color: rgb(153, 153, 153);">36</li><li style="color: rgb(153, 153, 153);">37</li><li style="color: rgb(153, 153, 153);">38</li><li style="color: rgb(153, 153, 153);">39</li><li style="color: rgb(153, 153, 153);">40</li><li style="color: rgb(153, 153, 153);">41</li><li style="color: rgb(153, 153, 153);">42</li><li style="color: rgb(153, 153, 153);">43</li><li style="color: rgb(153, 153, 153);">44</li><li style="color: rgb(153, 153, 153);">45</li><li style="color: rgb(153, 153, 153);">46</li><li style="color: rgb(153, 153, 153);">47</li></ul></pre> 
<p>与字段验证器一样，根验证器可以具有 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">pre=True</code>，在这种情况下，它们会在字段验证发生之前被调用(并与原始输入数据一起提供)，或者 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">pre=False</code> (默认情况下)，在这种情况下，它们会在字段验证之后被调用。</p> 
<p>如果 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">pre=True</code> 时根验证器引发错误，则不会进行字段验证。与字段验证器一样，当 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">pre=False</code> 时，即使之前的验证器失败，默认情况下也会调用根验证器；可以通过为验证器设置 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">skip_on_failure=True</code> 关键字参数来改变这种行为。<code style="user-select: auto;" onclick="mdcp.copyCode(event)">values</code> 参数将是一个字典，其中包含已通过字段验证的值和适用的字段默认值。</p> 
<h3><a name="t37"></a><a id="336__3852"></a>3.3.6 字段检查</h3> 
<p>在创建类时，将检查验证器，以确认它们指定的字段在模型中实际存在。</p> 
<p>但有时这是不希望看到的：例如，如果您定义了一个验证器来验证继承模型上的字段。在这种情况下，应该在验证器上设置 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">check_fields=False</code>。</p> 
<h3><a name="t38"></a><a id="337_Dataclass__3858"></a>3.3.7 Dataclass 验证器</h3> 
<p>验证器也可以与pydantic 的 dataclasses 一起工作：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime

<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> validator
<span class="token keyword">from</span> pydantic<span class="token punctuation">.</span>dataclasses <span class="token keyword">import</span> dataclass


@dataclass
<span class="token keyword">class</span> <span class="token class-name">DemoDataclass</span><span class="token punctuation">:</span>
ts<span class="token punctuation">:</span> datetime <span class="token operator">=</span> <span class="token boolean">None</span>

@validator<span class="token punctuation">(</span><span class="token string">'ts'</span><span class="token punctuation">,</span> pre<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> always<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">set_ts_now</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> v <span class="token operator">or</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">print</span><span class="token punctuation">(</span>DemoDataclass<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; DemoDataclass(ts=datetime.datetime(2020, 11, 1, 15, 49, 0, 182639))</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>DemoDataclass<span class="token punctuation">(</span>ts<span class="token operator">=</span><span class="token string">'2017-11-08T14:00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; DemoDataclass(ts=datetime.datetime(2017, 11, 8, 14, 0))</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li></ul></pre> 
<h2><a name="t39"></a><a id="34__3884"></a>3.4 模型配置</h2> 
<p>Pydantic 的行为可以通过模型上的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Config</code> 类控制。</p> 
<p>选项：</p> 
<ul><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">title</code></p> <p>声成的 JSON 模式的标题。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">anystr_strip_whitespace</code></p> <p>是否移除 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">str</code> 和 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">bytes</code> 类型中前导和尾随的空白字符(默认值为 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">False</code>)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">min_anystr_length</code></p> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">str</code> 和 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">bytes</code> 类型的最小长度 (默认为 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">0</code>)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">max_anystr_length</code></p> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">str</code> 和 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">bytes</code> 类型的最小长度 (默认为 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">2 ** 16</code>)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">validate_all</code></p> <p>是否验证字段的默认值 (默认为 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">False</code>)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">extra</code></p> <p>在模型初始化时是否忽略、允许或禁止额外的属性。可接受字符串值 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">ignore</code>、<code style="user-select: auto;" onclick="mdcp.copyCode(event)">allow</code> 或 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">forbid</code> 以及 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Extra</code> 枚举 (例如， <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Extra.ignore</code>)。如果模型包含了额外的属性，则 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">forbid</code> 将会导致验证失败。<code style="user-select: auto;" onclick="mdcp.copyCode(event)">ignore</code> 将静默忽略任何额外属性。<code style="user-select: auto;" onclick="mdcp.copyCode(event)">allow</code> 将属性分配给模型。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">allow_mutation</code></p> <p>模型是否是伪不可变的。例如，是否允许 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">__setattr__</code> (默认为 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">True</code>)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">use_enum_values</code></p> <p>是否使用枚举的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">value</code> 属性而不是原始枚举填充模型。如果之后想要序列化 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">model.dict()</code> ，这可能会很有用 (默认值为 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">False</code>)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">fields</code></p> <p>包含每个字段的模式信息的字典； 这等效于使用 [<code style="user-select: auto;" onclick="mdcp.copyCode(event)">Field</code> 类](# 3.5 模式) (默认为 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">None</code>)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">validate_assignment</code></p> <p>是否对属性的赋值执行验证 (默认为 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">False</code>)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">allow_population_by_field_name</code></p> <p>是否可以用模型属性给出的名称填充别名字段，以及别名 (默认为 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">False</code> )。</p> 
<blockquote> 
<p><mark>注意</mark></p> 
<p>这个配置设置的名称在<strong>v1.0</strong>中从 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">allow_population_by_alias</code> 更改为 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">allow_population_by_field_name</code>。</p> 
</blockquote> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">error_msg_templates</code></p> <p>用于覆盖默认错误消息模板的字典。传入一个字典，其中的键与您想要覆盖的错误消息相匹配 (默认为 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">{}</code>)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">arbitrary_types_allowed</code></p> <p>是否允许字段使用任意用户类型(只需检查值是否为该类型的实例即可对它们进行验证)。 如果为 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">False</code>，则会在模型声明时引发<code style="user-select: auto;" onclick="mdcp.copyCode(event)">RuntimeError</code>(默认为 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">False</code>)。 请参阅[字段类型](# 3.2 字段类型)中的示例。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">orm_mode</code></p> <p>是否允许使用 [ORM 模式](# 3.1.3 ORM 模式)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">getter_dict</code></p> <p>一个自定义类 (应该继承自 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">GetterDict</code>)，用于分解ORM类进行验证，并与 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">orm_mode</code> 一起使用</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">alias_generator</code></p> <p>接受字段名并返回其别名的可调用对象。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">keep_untouched</code></p> <p>模型的默认值的类型元组 (例如，描述符)，该默认值在模型创建期间不应更改，也不会包含在模型模式中。 注意：这意味着模型上具有此<em>类型的默认值</em>的属性 (而不是此类型的注释) 将被保留。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">schema_extra</code></p> <p>用于 拓展/更新 生成的 JSON 模式的字典，或用于对其进行后处理(post-process)的可调用对象。参见 [模式定制](# 3.5.5 模式定制)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">json_loads</code></p> <p>用于解码 JSON 的自定义函数。参见 [自定义 JSON反序列化](# 3.6.4.3 自定义 JSON反序列化)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">json_dumps</code></p> <p>用于编码 JSON的自定义函数。参见 [自定义 JSON反序列化](# 3.6.4.3 自定义 JSON反序列化)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">json_encoders</code></p> <p>用于自定义类型被编码成JSON的方式的字典。参见 [JSON 序列化](# 3.6.4 model.json(…))。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">underscore_attrs_are_private</code></p> <p>是否将任何下划线非类 (non-class) 变量属性当做私有属性，或让它们保持原样。参见 [私有模型属性](# 3.1.14 私有模型属性)。</p> </li></ul> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel<span class="token punctuation">,</span> ValidationError


<span class="token keyword">class</span> <span class="token class-name">Model</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
v<span class="token punctuation">:</span> <span class="token builtin">str</span>

<span class="token keyword">class</span> <span class="token class-name">Config</span><span class="token punctuation">:</span>
    max_anystr_length <span class="token operator">=</span> <span class="token number">10</span>
    error_msg_templates <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">'value_error.any_str.max_length'</span><span class="token punctuation">:</span> <span class="token string">'max_length:{limit_value}'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>


<span class="token keyword">try</span><span class="token punctuation">:</span>
Model<span class="token punctuation">(</span>v<span class="token operator">=</span><span class="token string">'x'</span> <span class="token operator">*</span> <span class="token number">20</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> ValidationError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
1 validation error for Model
v
  max_length:10 (type=value_error.any_str.max_length; limit_value=10)
"""</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li></ul></pre> 
<p>类似的，如果使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">@dataclass</code> 装饰器：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime

<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> ValidationError
<span class="token keyword">from</span> pydantic<span class="token punctuation">.</span>dataclasses <span class="token keyword">import</span> dataclass


<span class="token keyword">class</span> <span class="token class-name">MyConfig</span><span class="token punctuation">:</span>
max_anystr_length <span class="token operator">=</span> <span class="token number">10</span>
validate_assignment <span class="token operator">=</span> <span class="token boolean">True</span>
error_msg_templates <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'value_error.any_str.max_length'</span><span class="token punctuation">:</span> <span class="token string">'max_length:{limit_value}'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>


@dataclass<span class="token punctuation">(</span>config<span class="token operator">=</span>MyConfig<span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">:</span>
<span class="token builtin">id</span><span class="token punctuation">:</span> <span class="token builtin">int</span>
name<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">'John Doe'</span>
signup_ts<span class="token punctuation">:</span> datetime <span class="token operator">=</span> <span class="token boolean">None</span>


user <span class="token operator">=</span> User<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token string">'42'</span><span class="token punctuation">,</span> signup_ts<span class="token operator">=</span><span class="token string">'2032-06-21T12:00'</span><span class="token punctuation">)</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
user<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'x'</span> <span class="token operator">*</span> <span class="token number">20</span>
<span class="token keyword">except</span> ValidationError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
1 validation error for User
name
  max_length:10 (type=value_error.any_str.max_length; limit_value=10)
"""</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li></ul></pre> 
<h3><a name="t40"></a><a id="341__4043"></a>3.4.1 别名生成器</h3> 
<p>如果数据源字段名称与您的代码样式不匹配 (例如CamelCase字段)，则可以使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">alias_generator</code> 自动生成别名：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel


<span class="token keyword">def</span> <span class="token function">to_camel</span><span class="token punctuation">(</span>string<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">str</span><span class="token punctuation">:</span>
<span class="token keyword">return</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>word<span class="token punctuation">.</span>capitalize<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> word <span class="token keyword">in</span> string<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'_'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">Voice</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
name<span class="token punctuation">:</span> <span class="token builtin">str</span>
language_code<span class="token punctuation">:</span> <span class="token builtin">str</span>

<span class="token keyword">class</span> <span class="token class-name">Config</span><span class="token punctuation">:</span>
    alias_generator <span class="token operator">=</span> to_camel


voice <span class="token operator">=</span> Voice<span class="token punctuation">(</span>Name<span class="token operator">=</span><span class="token string">'Filiz'</span><span class="token punctuation">,</span> LanguageCode<span class="token operator">=</span><span class="token string">'tr-TR'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>voice<span class="token punctuation">.</span>language_code<span class="token punctuation">)</span>
<span class="token comment">#&gt; tr-TR</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>voice<span class="token punctuation">.</span><span class="token builtin">dict</span><span class="token punctuation">(</span>by_alias<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; {'Name': 'Filiz', 'LanguageCode': 'tr-TR'}</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li></ul></pre> 
<p>这里，“camel case” 指的是 <a href="https://en.wikipedia.org/wiki/Camel_case" target="_blank">“upper camel case”</a>，又称 “pascal case”，例如 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">CamelCase</code>。如果您希望使用 “lower camel case”，例如 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">camelCase</code>，那么修改上面的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">to_camel</code> 函数应该很简单。</p> 
<h3><a name="t41"></a><a id="342__4072"></a>3.4.2 别名优先</h3> 
<blockquote> 
<p><mark>警告</mark></p> 
<p>别名优先级逻辑在<strong>v1.4</strong>中更改，以解决以前版本中的错误和意外行为。在某些情况下，这可能表示一个<strong>中断的更改</strong>，详细信息请参阅<a href="https://github.com/samuelcolvin/pydantic/issues/1178" target="_blank">#1178</a>和下面的优先顺序。</p> 
</blockquote> 
<p>在一个字段的别名可能被定义在多个地方的情况下，选择的值按如下规则确定(按优先级降序)：</p> 
<ul><li>在模型上直接通过 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Field(..., alias=&lt;alias&gt;)</code> 设置。</li><li>在模型上的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Config.fields</code> 中定义。</li><li>在父模型上通过 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Field(..., alias=&lt;alias&gt;)</code>。</li><li>在父模型上的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Config.fields</code> 中定义。</li><li>由 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">alias_generator</code> 生成，无论它是在模型上还是在父模型上。</li></ul> 
<blockquote> 
<p><mark>注意</mark></p> 
<p>这意味着在子模型上定义的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">alias_generator</code> <strong>不优先于</strong>在父模型的字段上定义的别名。</p> 
</blockquote> 
<p>示例：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel<span class="token punctuation">,</span> Field


<span class="token keyword">class</span> <span class="token class-name">Voice</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
name<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> Field<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> alias<span class="token operator">=</span><span class="token string">'ActorName'</span><span class="token punctuation">)</span>
language_code<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token boolean">None</span>
mood<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token boolean">None</span>


<span class="token keyword">class</span> <span class="token class-name">Character</span><span class="token punctuation">(</span>Voice<span class="token punctuation">)</span><span class="token punctuation">:</span>
act<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">1</span>

<span class="token keyword">class</span> <span class="token class-name">Config</span><span class="token punctuation">:</span>
    fields <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'language_code'</span><span class="token punctuation">:</span> <span class="token string">'lang'</span><span class="token punctuation">}</span>

    @<span class="token builtin">classmethod</span>
    <span class="token keyword">def</span> <span class="token function">alias_generator</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> string<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">str</span><span class="token punctuation">:</span>
        <span class="token comment"># this is the same as `alias_generator = to_camel` above</span>
        <span class="token keyword">return</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>word<span class="token punctuation">.</span>capitalize<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> word <span class="token keyword">in</span> string<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'_'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token keyword">print</span><span class="token punctuation">(</span>Character<span class="token punctuation">.</span>schema<span class="token punctuation">(</span>by_alias<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
{
'title': 'Character',
'type': 'object',
'properties': {
    'ActorName': {'title': 'Actorname', 'type': 'string'},
    'lang': {'title': 'Lang', 'type': 'string'},
    'Mood': {'title': 'Mood', 'type': 'string'},
    'Act': {'title': 'Act', 'default': 1, 'type': 'integer'},
},
}
"""</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li><li style="color: rgb(153, 153, 153);">33</li><li style="color: rgb(153, 153, 153);">34</li></ul></pre> 
<h2><a name="t42"></a><a id="35__4129"></a>3.5 模式</h2> 
<p>Pydantic 允许从模型自动创建 JSON 模式：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> enum <span class="token keyword">import</span> Enum
<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel<span class="token punctuation">,</span> Field


<span class="token keyword">class</span> <span class="token class-name">FooBar</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
count<span class="token punctuation">:</span> <span class="token builtin">int</span>
size<span class="token punctuation">:</span> <span class="token builtin">float</span> <span class="token operator">=</span> <span class="token boolean">None</span>


<span class="token keyword">class</span> <span class="token class-name">Gender</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">,</span> Enum<span class="token punctuation">)</span><span class="token punctuation">:</span>
male <span class="token operator">=</span> <span class="token string">'male'</span>
female <span class="token operator">=</span> <span class="token string">'female'</span>
other <span class="token operator">=</span> <span class="token string">'other'</span>
not_given <span class="token operator">=</span> <span class="token string">'not_given'</span>


<span class="token keyword">class</span> <span class="token class-name">MainModel</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token triple-quoted-string string">"""
This is the description of the main model
"""</span>

foo_bar<span class="token punctuation">:</span> FooBar <span class="token operator">=</span> Field<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
gender<span class="token punctuation">:</span> Gender <span class="token operator">=</span> Field<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> alias<span class="token operator">=</span><span class="token string">'Gender'</span><span class="token punctuation">)</span>
snap<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> Field<span class="token punctuation">(</span>
    <span class="token number">42</span><span class="token punctuation">,</span>
    title<span class="token operator">=</span><span class="token string">'The Snap'</span><span class="token punctuation">,</span>
    description<span class="token operator">=</span><span class="token string">'this is the value of snap'</span><span class="token punctuation">,</span>
    gt<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">,</span>
    lt<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Config</span><span class="token punctuation">:</span>
    title <span class="token operator">=</span> <span class="token string">'Main'</span>


<span class="token comment"># this is equivalent to json.dumps(MainModel.schema(), indent=2):</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>MainModel<span class="token punctuation">.</span>schema_json<span class="token punctuation">(</span>indent<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li><li style="color: rgb(153, 153, 153);">33</li><li style="color: rgb(153, 153, 153);">34</li><li style="color: rgb(153, 153, 153);">35</li><li style="color: rgb(153, 153, 153);">36</li><li style="color: rgb(153, 153, 153);">37</li></ul></pre> 
<p>输出如下：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-json has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token punctuation">{<!-- --></span>
<span class="token string">"title"</span><span class="token punctuation">:</span> <span class="token string">"Main"</span><span class="token punctuation">,</span>
<span class="token string">"description"</span><span class="token punctuation">:</span> <span class="token string">"This is the description of the main model"</span><span class="token punctuation">,</span>
<span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"object"</span><span class="token punctuation">,</span>
<span class="token string">"properties"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
<span class="token string">"foo_bar"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
  <span class="token string">"$ref"</span><span class="token punctuation">:</span> <span class="token string">"#/definitions/FooBar"</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token string">"Gender"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
  <span class="token string">"$ref"</span><span class="token punctuation">:</span> <span class="token string">"#/definitions/Gender"</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token string">"snap"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
  <span class="token string">"title"</span><span class="token punctuation">:</span> <span class="token string">"The Snap"</span><span class="token punctuation">,</span>
  <span class="token string">"description"</span><span class="token punctuation">:</span> <span class="token string">"this is the value of snap"</span><span class="token punctuation">,</span>
  <span class="token string">"default"</span><span class="token punctuation">:</span> <span class="token number">42</span><span class="token punctuation">,</span>
  <span class="token string">"exclusiveMinimum"</span><span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
  <span class="token string">"exclusiveMaximum"</span><span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">,</span>
  <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"integer"</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token string">"required"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
<span class="token string">"foo_bar"</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token string">"definitions"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
<span class="token string">"FooBar"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
  <span class="token string">"title"</span><span class="token punctuation">:</span> <span class="token string">"FooBar"</span><span class="token punctuation">,</span>
  <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"object"</span><span class="token punctuation">,</span>
  <span class="token string">"properties"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"count"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"title"</span><span class="token punctuation">:</span> <span class="token string">"Count"</span><span class="token punctuation">,</span>
      <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"integer"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">"size"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"title"</span><span class="token punctuation">:</span> <span class="token string">"Size"</span><span class="token punctuation">,</span>
      <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"number"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">"required"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token string">"count"</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token string">"Gender"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
  <span class="token string">"title"</span><span class="token punctuation">:</span> <span class="token string">"Gender"</span><span class="token punctuation">,</span>
  <span class="token string">"description"</span><span class="token punctuation">:</span> <span class="token string">"An enumeration."</span><span class="token punctuation">,</span>
  <span class="token string">"enum"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token string">"male"</span><span class="token punctuation">,</span>
    <span class="token string">"female"</span><span class="token punctuation">,</span>
    <span class="token string">"other"</span><span class="token punctuation">,</span>
    <span class="token string">"not_given"</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"string"</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li><li style="color: rgb(153, 153, 153);">33</li><li style="color: rgb(153, 153, 153);">34</li><li style="color: rgb(153, 153, 153);">35</li><li style="color: rgb(153, 153, 153);">36</li><li style="color: rgb(153, 153, 153);">37</li><li style="color: rgb(153, 153, 153);">38</li><li style="color: rgb(153, 153, 153);">39</li><li style="color: rgb(153, 153, 153);">40</li><li style="color: rgb(153, 153, 153);">41</li><li style="color: rgb(153, 153, 153);">42</li><li style="color: rgb(153, 153, 153);">43</li><li style="color: rgb(153, 153, 153);">44</li><li style="color: rgb(153, 153, 153);">45</li><li style="color: rgb(153, 153, 153);">46</li><li style="color: rgb(153, 153, 153);">47</li><li style="color: rgb(153, 153, 153);">48</li><li style="color: rgb(153, 153, 153);">49</li><li style="color: rgb(153, 153, 153);">50</li><li style="color: rgb(153, 153, 153);">51</li><li style="color: rgb(153, 153, 153);">52</li><li style="color: rgb(153, 153, 153);">53</li><li style="color: rgb(153, 153, 153);">54</li></ul></pre> 
<p>生成的模式符合以下规范：</p> 
<ul><li><a href="https://json-schema.org/latest/json-schema-core.html" target="_blank">JSON Schema Core</a></li><li><a href="https://json-schema.org/latest/json-schema-validation.html" target="_blank">JSON Schema Validation</a></li><li><a href="https://github.com/OAI/OpenAPI-Specification" target="_blank">OpenAPI</a></li></ul> 
<p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">BaseModel.schema</code> 将会返回模式字典，而 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">BaseModel.schema_json</code> 将会返回那个字典的 JSON 字符串表示。</p> 
<p>根据规范，使用的子模型被添加到 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">definitions</code> JSON属性并被引用。</p> 
<p>所有子模型(及其子模型)的模式都直接放在一个顶级 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">definitions</code> JSON键中，以便于重用和引用。</p> 
<p>经过修改 (通过 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Field</code> 类) 的 “子模型”，如自定义标题、描述或默认值，被递归地包括而不是引用。</p> 
<p>模型的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">description</code> 取自类的文档字符串或 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Field</code> 类的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">description</code> 参数。</p> 
<p>默认情况下使用别名作为键来生成模式，但是可以使用模型属性名而不是调用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">MainModel.schema/schema_json(by_alias=False)</code> 来生成模式。</p> 
<p>使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">ref_template</code> 关键字参数调用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">schema()</code> 或 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">schema_json()</code> 可以改变 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">$ref</code> (上面的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">#/definitions/FooBar</code> ) 的格式。</p> 
<p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">ApplePie.schema(ref_template='/schemas/{model}.json#/')</code> ，这里，将会使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">str.format</code> 将 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">{model}</code> 替换为模型名称。</p> 
<h3><a name="t43"></a><a id="351__4254"></a>3.5.1 字段定制</h3> 
<p>此外，还可以使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Field</code> 函数提供关于字段和验证的额外信息。它有下面一些参数：</p> 
<ul><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">default</code></p> <p>该参数为位置参数。表示字段的默认值。因为 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Field</code> 替换字段的默认值，所以可以使用第一个参数设置默认值。使用省略号表示字段是必需的。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">default_factory</code></p> <p>一个零参数的可调用对象，当需要该字段的默认值时将调用它。除了其他用途外，它还可用于设置动态默认值。禁止同时设置<code style="user-select: auto;" onclick="mdcp.copyCode(event)">default</code> 和 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">default_factory</code>。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">alias</code></p> <p>字段的公开名称。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">title</code></p> <p>如果忽略，则使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">filed_name.title()</code>。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">description</code></p> <p>如果忽略并且注解是子模型，将会使用子模型的文档字符串。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">const</code></p> <p>如果该参数出现，则必须与字段的默认值相同。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">gt</code></p> <p>对于数值值 (<code style="user-select: auto;" onclick="mdcp.copyCode(event)">int</code>，<code style="user-select: auto;" onclick="mdcp.copyCode(event)">float</code>，<code style="user-select: auto;" onclick="mdcp.copyCode(event)">Decimal</code>)，将向 JSON 模式添加一个 “大于” 验证和一个 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">exclusiveMinimum</code> 注解。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">ge</code></p> <p>对于数值值 ，将向 JSON 模式添加一个 “大于等于” 验证和一个 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">minimum</code> 注解。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">lt</code></p> <p>对于数值值 ，将向 JSON 模式添加一个"小于" 验证和一个 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">exclusiveMaximum</code> 注解。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">le</code></p> <p>对于数值值 ，将向 JSON 模式添加一个 “小于等于” 验证和一个 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">maximum</code> 注解。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">multiple_of</code></p> <p>对于数值值，将向 JSON 模式添加一个 “倍数” 验证和一个 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">multipleOf</code> 注解。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">min_items</code></p> <p>对于列表值，将向 JSON 模式添加相应的验证和 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">minItems</code> 注解。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">max_items</code></p> <p>对于列表值，将向 JSON 模式添加相应的验证和 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">maxItems</code> 注解。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">min_length</code></p> <p>对于字符串值，将向 JSON 模式添加相应的验证和 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">minLength</code> 注解。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">max_length</code></p> <p>对于字符串值，将向 JSON 模式添加相应的验证和 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">maxLength</code> 注解。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">regex</code></p> <p>对于字符串值，将向 JSON 模式添加一个从传递的字符串生成的正则表达式验证和一个 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">pattern</code> 注解。</p> 
<blockquote> 
<p><mark>注意</mark></p> 
<p>pydantic使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">re.match</code> 验证字符串，该方法将正则表达式视为隐式锚定在开始处。相反，JSON模式验证器将模式关键字视为隐式非锚定的，这更像 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">re.search</code> 所做的。</p> 
<p>为了互操作性，根据你想要的行为，要么显式地用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">^</code> 锚定你的正则表达式 (例如使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">^foo</code> 来匹配任何以 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">foo</code> 开头的字符串)，要么使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">.*?</code> 显式地允许任意的前缀用 (例如 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">.*?foo</code> 匹配任何包含子字符串 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">foo</code> 的字符串)。</p> 
<p>有关在<strong>v2</strong>中对pydantic行为可能进行的更改的讨论，请参阅<a href="https://github.com/samuelcolvin/pydantic/issues/1631" target="_blank">#1631</a>。</p> 
</blockquote> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">**</code></p> <p>任何其他关键字参数 (例如 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">example</code>) 都将逐字添加到字段的模式中。</p> </li></ul> 
<p>[配置类](# 3.4 模型配置) 的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">fields</code> 属性可以用来设置上面除 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">default</code> 之外的所有参数，而不是使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Field</code>。</p> 
<h4><a id="3511__4336"></a>3.5.1.1 未强制执行的字段约束</h4> 
<p>如果 pydantic 找到未强制执行的约束，将引发错误。如果要强制约束出现在模式中，即使解析时没有检查该约束，可以将 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Field()</code> 的可变参数与原始模式属性名称一起使用：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel<span class="token punctuation">,</span> Field<span class="token punctuation">,</span> PositiveInt

<span class="token keyword">try</span><span class="token punctuation">:</span>
<span class="token comment"># this won't work since PositiveInt takes precedence over the</span>
<span class="token comment"># constraints defined in Field meaning they're ignored</span>
<span class="token keyword">class</span> <span class="token class-name">Model</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
    foo<span class="token punctuation">:</span> PositiveInt <span class="token operator">=</span> Field<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> lt<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> ValueError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
On field "foo" the following field constraints are set but not enforced:
lt.
For more details see https://pydantic-
docs.helpmanual.io/usage/schema/#unenforced-field-constraints
"""</span>


<span class="token comment"># but you can set the schema attribute directly:</span>
<span class="token comment"># (Note: here exclusiveMaximum will not be enforce)</span>
<span class="token keyword">class</span> <span class="token class-name">Model</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
foo<span class="token punctuation">:</span> PositiveInt <span class="token operator">=</span> Field<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> exclusiveMaximum<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>


<span class="token keyword">print</span><span class="token punctuation">(</span>Model<span class="token punctuation">.</span>schema<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
{
'title': 'Model',
'type': 'object',
'properties': {
    'foo': {
        'title': 'Foo',
        'exclusiveMaximum': 10,
        'exclusiveMinimum': 0,
        'type': 'integer',
    },
},
'required': ['foo'],
}
"""</span>


<span class="token comment"># if you find yourself needing this, an alternative is to declare</span>
<span class="token comment"># the constraints in Field (or you could use conint())</span>
<span class="token comment"># here both constraints will be enforced:</span>
<span class="token keyword">class</span> <span class="token class-name">Model</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token comment"># Here both constraints will be applied and the schema</span>
<span class="token comment"># will be generated correctly</span>
foo<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> Field<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> gt<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> lt<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>


<span class="token keyword">print</span><span class="token punctuation">(</span>Model<span class="token punctuation">.</span>schema<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
{
'title': 'Model',
'type': 'object',
'properties': {
    'foo': {
        'title': 'Foo',
        'exclusiveMinimum': 0,
        'exclusiveMaximum': 10,
        'type': 'integer',
    },
},
'required': ['foo'],
}
"""</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li><li style="color: rgb(153, 153, 153);">33</li><li style="color: rgb(153, 153, 153);">34</li><li style="color: rgb(153, 153, 153);">35</li><li style="color: rgb(153, 153, 153);">36</li><li style="color: rgb(153, 153, 153);">37</li><li style="color: rgb(153, 153, 153);">38</li><li style="color: rgb(153, 153, 153);">39</li><li style="color: rgb(153, 153, 153);">40</li><li style="color: rgb(153, 153, 153);">41</li><li style="color: rgb(153, 153, 153);">42</li><li style="color: rgb(153, 153, 153);">43</li><li style="color: rgb(153, 153, 153);">44</li><li style="color: rgb(153, 153, 153);">45</li><li style="color: rgb(153, 153, 153);">46</li><li style="color: rgb(153, 153, 153);">47</li><li style="color: rgb(153, 153, 153);">48</li><li style="color: rgb(153, 153, 153);">49</li><li style="color: rgb(153, 153, 153);">50</li><li style="color: rgb(153, 153, 153);">51</li><li style="color: rgb(153, 153, 153);">52</li><li style="color: rgb(153, 153, 153);">53</li><li style="color: rgb(153, 153, 153);">54</li><li style="color: rgb(153, 153, 153);">55</li><li style="color: rgb(153, 153, 153);">56</li><li style="color: rgb(153, 153, 153);">57</li><li style="color: rgb(153, 153, 153);">58</li><li style="color: rgb(153, 153, 153);">59</li><li style="color: rgb(153, 153, 153);">60</li><li style="color: rgb(153, 153, 153);">61</li><li style="color: rgb(153, 153, 153);">62</li><li style="color: rgb(153, 153, 153);">63</li><li style="color: rgb(153, 153, 153);">64</li><li style="color: rgb(153, 153, 153);">65</li><li style="color: rgb(153, 153, 153);">66</li></ul></pre> 
<h3><a name="t44"></a><a id="352__4409"></a>3.5.2 修改自定义字段中的模式</h3> 
<p>自定义字段类型可以使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">__modify_schema__</code> 类方法自定义为它们生成的模式；有关更多细节，请参见[自定义数据类型](# 3.2.7 自定义数据类型)。</p> 
<h3><a name="t45"></a><a id="353_JSON_4413"></a>3.5.3 JSON模式类型</h3> 
<p>类型，自定义字段类型和约束 (像 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">max_length</code>) 按照以下优先级顺序映射到相应的规范格式 (当有等效的可用格式时)：</p> 
<ol><li><a href="http://json-schema.org/latest/json-schema-core.html#rfc.section.4.3.1" target="_blank">JSON Schema Core</a></li><li><a href="http://json-schema.org/latest/json-schema-validation.html" target="_blank">JSON Schema Validation</a></li><li><a href="https://github.com/OAI/OpenAPI-Specification/blob/master/versions/3.0.2.md#data-types" target="_blank">OpenAPI Data Types</a></li><li>标准的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">format</code> JSON字段用于为更复杂的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">string</code> 子类型定义pydantic扩展。</li></ol> 
<p>从Python/pydantic到JSON模式的字段模式映射请参考原始<a href="https://pydantic-docs.helpmanual.io/usage/schema/#json-schema-types" target="_blank">英文文档</a>。</p> 
<h3><a name="t46"></a><a id="354__4424"></a>3.5.4 顶层模式生成</h3> 
<p>您还可以生成一个顶层JSON模式，它的定义中只包含一列模型和相关的子模型：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">import</span> json
<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel
<span class="token keyword">from</span> pydantic<span class="token punctuation">.</span>schema <span class="token keyword">import</span> schema


<span class="token keyword">class</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
a<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token boolean">None</span>


<span class="token keyword">class</span> <span class="token class-name">Model</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
b<span class="token punctuation">:</span> Foo


<span class="token keyword">class</span> <span class="token class-name">Bar</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
c<span class="token punctuation">:</span> <span class="token builtin">int</span>


top_level_schema <span class="token operator">=</span> schema<span class="token punctuation">(</span><span class="token punctuation">[</span>Model<span class="token punctuation">,</span> Bar<span class="token punctuation">]</span><span class="token punctuation">,</span> title<span class="token operator">=</span><span class="token string">'My Schema'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>top_level_schema<span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li></ul></pre> 
<p>输出如下：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-json has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token punctuation">{<!-- --></span>
<span class="token string">"title"</span><span class="token punctuation">:</span> <span class="token string">"My Schema"</span><span class="token punctuation">,</span>
<span class="token string">"definitions"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
<span class="token string">"Foo"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
  <span class="token string">"title"</span><span class="token punctuation">:</span> <span class="token string">"Foo"</span><span class="token punctuation">,</span>
  <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"object"</span><span class="token punctuation">,</span>
  <span class="token string">"properties"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"a"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"title"</span><span class="token punctuation">:</span> <span class="token string">"A"</span><span class="token punctuation">,</span>
      <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"string"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token string">"Model"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
  <span class="token string">"title"</span><span class="token punctuation">:</span> <span class="token string">"Model"</span><span class="token punctuation">,</span>
  <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"object"</span><span class="token punctuation">,</span>
  <span class="token string">"properties"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"b"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"$ref"</span><span class="token punctuation">:</span> <span class="token string">"#/definitions/Foo"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">"required"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token string">"b"</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token string">"Bar"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
  <span class="token string">"title"</span><span class="token punctuation">:</span> <span class="token string">"Bar"</span><span class="token punctuation">,</span>
  <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"object"</span><span class="token punctuation">,</span>
  <span class="token string">"properties"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"c"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"title"</span><span class="token punctuation">:</span> <span class="token string">"C"</span><span class="token punctuation">,</span>
      <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"integer"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">"required"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token string">"c"</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li><li style="color: rgb(153, 153, 153);">33</li><li style="color: rgb(153, 153, 153);">34</li><li style="color: rgb(153, 153, 153);">35</li><li style="color: rgb(153, 153, 153);">36</li><li style="color: rgb(153, 153, 153);">37</li><li style="color: rgb(153, 153, 153);">38</li><li style="color: rgb(153, 153, 153);">39</li><li style="color: rgb(153, 153, 153);">40</li></ul></pre> 
<h3><a name="t47"></a><a id="355__4495"></a>3.5.5 模式定制</h3> 
<p>可以定制生成的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">$ref</code> JSON位置：定义总是存储在键 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">definitions</code> 下，但是可以为引用使用指定的前缀。</p> 
<p>如果需要扩展或修改JSON模式默认定义位置，这将非常有用。例如对于 OpenAPI：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">import</span> json
<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel
<span class="token keyword">from</span> pydantic<span class="token punctuation">.</span>schema <span class="token keyword">import</span> schema


<span class="token keyword">class</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
a<span class="token punctuation">:</span> <span class="token builtin">int</span>


<span class="token keyword">class</span> <span class="token class-name">Model</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
a<span class="token punctuation">:</span> Foo


<span class="token comment"># Default location for OpenAPI</span>
top_level_schema <span class="token operator">=</span> schema<span class="token punctuation">(</span><span class="token punctuation">[</span>Model<span class="token punctuation">]</span><span class="token punctuation">,</span> ref_prefix<span class="token operator">=</span><span class="token string">'#/components/schemas/'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>top_level_schema<span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li></ul></pre> 
<p>输出如下：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-json has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token punctuation">{<!-- --></span>
<span class="token string">"definitions"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
<span class="token string">"Foo"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
  <span class="token string">"title"</span><span class="token punctuation">:</span> <span class="token string">"Foo"</span><span class="token punctuation">,</span>
  <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"object"</span><span class="token punctuation">,</span>
  <span class="token string">"properties"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"a"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"title"</span><span class="token punctuation">:</span> <span class="token string">"A"</span><span class="token punctuation">,</span>
      <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"integer"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">"required"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token string">"a"</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token string">"Model"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
  <span class="token string">"title"</span><span class="token punctuation">:</span> <span class="token string">"Model"</span><span class="token punctuation">,</span>
  <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"object"</span><span class="token punctuation">,</span>
  <span class="token string">"properties"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"a"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"$ref"</span><span class="token punctuation">:</span> <span class="token string">"#/components/schemas/Foo"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">"required"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token string">"a"</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li></ul></pre> 
<p>还可以 扩展/覆盖 模型中生成的JSON模式。</p> 
<p>为此，使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Config</code> 子类属性 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">schema_extra</code>。</p> 
<p>例如，你可以在JSON模式中添加 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">example</code>：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel


<span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
name<span class="token punctuation">:</span> <span class="token builtin">str</span>
age<span class="token punctuation">:</span> <span class="token builtin">int</span>

<span class="token keyword">class</span> <span class="token class-name">Config</span><span class="token punctuation">:</span>
    schema_extra <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">'examples'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'John Doe'</span><span class="token punctuation">,</span>
                <span class="token string">'age'</span><span class="token punctuation">:</span> <span class="token number">25</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>


<span class="token keyword">print</span><span class="token punctuation">(</span>Person<span class="token punctuation">.</span>schema_json<span class="token punctuation">(</span>indent<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li></ul></pre> 
<p>输出如下：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-json has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token punctuation">{<!-- --></span>
<span class="token string">"title"</span><span class="token punctuation">:</span> <span class="token string">"Person"</span><span class="token punctuation">,</span>
<span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"object"</span><span class="token punctuation">,</span>
<span class="token string">"properties"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
<span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
  <span class="token string">"title"</span><span class="token punctuation">:</span> <span class="token string">"Name"</span><span class="token punctuation">,</span>
  <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"string"</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token string">"age"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
  <span class="token string">"title"</span><span class="token punctuation">:</span> <span class="token string">"Age"</span><span class="token punctuation">,</span>
  <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"integer"</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token string">"required"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
<span class="token string">"name"</span><span class="token punctuation">,</span>
<span class="token string">"age"</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token string">"examples"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"John Doe"</span><span class="token punctuation">,</span>
  <span class="token string">"age"</span><span class="token punctuation">:</span> <span class="token number">25</span>
<span class="token punctuation">}</span>
<span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li></ul></pre> 
<p>对于更细粒度的控制，您可以选择将 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">schema_extra</code> 设置为可调用对象，并对生成的模式进行后期处理。可调用对象可以有一个或两个位置参数。第一个参数是模式字典。如果有第二个参数，将是模型类。可调用对象期望原地更改模式字典；可调用对象的返回值暂时未被使用。</p> 
<p>例如，<code style="user-select: auto;" onclick="mdcp.copyCode(event)">title</code> 键可以从模型的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">properties</code> 中删除：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> typing <span class="token keyword">import</span> Dict<span class="token punctuation">,</span> Any<span class="token punctuation">,</span> Type
<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel


<span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
name<span class="token punctuation">:</span> <span class="token builtin">str</span>
age<span class="token punctuation">:</span> <span class="token builtin">int</span>

<span class="token keyword">class</span> <span class="token class-name">Config</span><span class="token punctuation">:</span>
    @<span class="token builtin">staticmethod</span>
    <span class="token keyword">def</span> <span class="token function">schema_extra</span><span class="token punctuation">(</span>schema<span class="token punctuation">:</span> Dict<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> Any<span class="token punctuation">]</span><span class="token punctuation">,</span> model<span class="token punctuation">:</span> Type<span class="token punctuation">[</span><span class="token string">'Person'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> prop <span class="token keyword">in</span> schema<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'properties'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            prop<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>


<span class="token keyword">print</span><span class="token punctuation">(</span>Person<span class="token punctuation">.</span>schema_json<span class="token punctuation">(</span>indent<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li></ul></pre> 
<p>输出如下：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-json has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token punctuation">{<!-- --></span>
<span class="token string">"title"</span><span class="token punctuation">:</span> <span class="token string">"Person"</span><span class="token punctuation">,</span>
<span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"object"</span><span class="token punctuation">,</span>
<span class="token string">"properties"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
<span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
  <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"string"</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token string">"age"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
  <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"integer"</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token string">"required"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
<span class="token string">"name"</span><span class="token punctuation">,</span>
<span class="token string">"age"</span>
<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li></ul></pre> 
<h2><a name="t48"></a><a id="36__4656"></a>3.6 导出模型</h2> 
<p>除了通过名称 (例如 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">model.foobar</code> ) 直接访问模型属性外，模型还可以通过多种方式转换和导出：</p> 
<h3><a name="t49"></a><a id="361_modeldict_4660"></a>3.6.1 model.dict(…)</h3> 
<p>这是将模型转换为字典的主要方法。子模型会被递归的转换成字典。</p> 
<p>参数：</p> 
<ul><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">include</code></p> <p>包含在返回的字典中的字段。参见 [包含和排序的高级用法](# 3.6.6 包含和排序的高级用法)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">exclude</code></p> <p>从返回的字典中排除的字段。参见 [包含和排序的高级用法](# 3.6.6 包含和排序的高级用法)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">by_alias</code></p> <p>字段别名是否应该在返回的字典中作为键；默认为 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">False</code>。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">exclude_unset</code></p> <p>创建模型时未显式设置的字段是否应从返回的字典中排除；默认为 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">False</code>。<strong>在v1.0</strong>之前，<code style="user-select: auto;" onclick="mdcp.copyCode(event)">exclude_unset</code> 被称为 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">skip_defaults</code>；现在不赞成使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">skip_defaults</code>。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">exclude_defaults</code></p> <p>是否应从返回的字典中排除等于其默认值的字段 (无论是否设置)；默认为 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">False</code>。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">exclude_none</code></p> <p>是否应从返回的字典中排除等于 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">None</code> 的字段；默认为 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">False</code>。</p> </li></ul> 
<p>示例：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel


<span class="token keyword">class</span> <span class="token class-name">BarModel</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
whatever<span class="token punctuation">:</span> <span class="token builtin">int</span>


<span class="token keyword">class</span> <span class="token class-name">FooBarModel</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
banana<span class="token punctuation">:</span> <span class="token builtin">float</span>
foo<span class="token punctuation">:</span> <span class="token builtin">str</span>
bar<span class="token punctuation">:</span> BarModel


m <span class="token operator">=</span> FooBarModel<span class="token punctuation">(</span>banana<span class="token operator">=</span><span class="token number">3.14</span><span class="token punctuation">,</span> foo<span class="token operator">=</span><span class="token string">'hello'</span><span class="token punctuation">,</span> bar<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'whatever'</span><span class="token punctuation">:</span> <span class="token number">123</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment"># returns a dictionary:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
{
'banana': 3.14,
'foo': 'hello',
'bar': {'whatever': 123},
}
"""</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token builtin">dict</span><span class="token punctuation">(</span>include<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; {'foo': 'hello', 'bar': {'whatever': 123}}</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token builtin">dict</span><span class="token punctuation">(</span>exclude<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; {'banana': 3.14}</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li></ul></pre> 
<h3><a name="t50"></a><a id="362_dictmodel__4723"></a>3.6.2 dict(model) 和迭代</h3> 
<p>Pydantic 模型也可以使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">dict(model)</code> 转换成字典，并且也可以使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">for field_name, value in model:</code> 迭代模型上的字段。</p> 
<p>使用这种方法，将返回原始字段值，因此子模型不会被转换为字典。</p> 
<p>示例：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel


<span class="token keyword">class</span> <span class="token class-name">BarModel</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
whatever<span class="token punctuation">:</span> <span class="token builtin">int</span>


<span class="token keyword">class</span> <span class="token class-name">FooBarModel</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
banana<span class="token punctuation">:</span> <span class="token builtin">float</span>
foo<span class="token punctuation">:</span> <span class="token builtin">str</span>
bar<span class="token punctuation">:</span> BarModel


m <span class="token operator">=</span> FooBarModel<span class="token punctuation">(</span>banana<span class="token operator">=</span><span class="token number">3.14</span><span class="token punctuation">,</span> foo<span class="token operator">=</span><span class="token string">'hello'</span><span class="token punctuation">,</span> bar<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'whatever'</span><span class="token punctuation">:</span> <span class="token number">123</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">dict</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
{
'banana': 3.14,
'foo': 'hello',
'bar': BarModel(
    whatever=123,
),
}
"""</span>
<span class="token keyword">for</span> name<span class="token punctuation">,</span> value <span class="token keyword">in</span> m<span class="token punctuation">:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'{name}: {value}'</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; banana: 3.14</span>
<span class="token comment">#&gt; foo: hello</span>
<span class="token comment">#&gt; bar: whatever=123</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li></ul></pre> 
<h3><a name="t51"></a><a id="363_modelcopy_4764"></a>3.6.3 model.copy(…)</h3> 
<p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">copy()</code> 允许复制模型，这对不可变模型尤其有用。</p> 
<p>参数：</p> 
<ul><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">include</code></p> <p>要包含在返回的字典中的字段。参见 [包含和排序的高级用法](# 3.6.6 包含和排序的高级用法)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">exclude</code></p> <p>要从返回的字典中排序的字典。参见 [包含和排序的高级用法](# 3.6.6 包含和排序的高级用法)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">update</code></p> <p>创建复制的模型时要更改的值的字典。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">deep</code></p> <p>是否对新模型进行深复制；默认为 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">False</code>。</p> </li></ul> 
<p>示例：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel


<span class="token keyword">class</span> <span class="token class-name">BarModel</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
whatever<span class="token punctuation">:</span> <span class="token builtin">int</span>


<span class="token keyword">class</span> <span class="token class-name">FooBarModel</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
banana<span class="token punctuation">:</span> <span class="token builtin">float</span>
foo<span class="token punctuation">:</span> <span class="token builtin">str</span>
bar<span class="token punctuation">:</span> BarModel


m <span class="token operator">=</span> FooBarModel<span class="token punctuation">(</span>banana<span class="token operator">=</span><span class="token number">3.14</span><span class="token punctuation">,</span> foo<span class="token operator">=</span><span class="token string">'hello'</span><span class="token punctuation">,</span> bar<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'whatever'</span><span class="token punctuation">:</span> <span class="token number">123</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>copy<span class="token punctuation">(</span>include<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; foo='hello' bar=BarModel(whatever=123)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>copy<span class="token punctuation">(</span>exclude<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; banana=3.14</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>copy<span class="token punctuation">(</span>update<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'banana'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; banana=0 foo='hello' bar=BarModel(whatever=123)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>bar<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">id</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>bar<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; 140512307789344 140512307789344</span>
<span class="token comment"># normal copy gives the same object reference for `bar`</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>bar<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">id</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>copy<span class="token punctuation">(</span>deep<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">.</span>bar<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; 140512307789344 140512307819952</span>
<span class="token comment"># deep copy gives a new object reference for `bar`</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li></ul></pre> 
<h3><a name="t52"></a><a id="364_modeljson_4818"></a>3.6.4 model.json(…)</h3> 
<p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">.json()</code> 方法会将模型序列化为 JSON。通常，<code style="user-select: auto;" onclick="mdcp.copyCode(event)">.json()</code> 依次调用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">.dict()</code> 并序列化其结果。(对于具有自定义根类型的模型，在调用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">.dict()</code> 之后，仅序列化 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">__root__</code> 键的值)。</p> 
<p>参数：</p> 
<ul><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">include</code></p> <p>要包含在返回的字典中的字段。参见 [包含和排序的高级用法](# 3.6.6 包含和排序的高级用法)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">exclude</code></p> <p>要从返回的字典中排序的字典。参见 [包含和排序的高级用法](# 3.6.6 包含和排序的高级用法)。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">by_alias</code></p> <p>字段别名是否应该在返回的字典中作为键；默认为 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">False</code>。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">exclude_unset</code></p> <p>创建模型时未显式设置的字段是否应从返回的字典中排除；默认为 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">False</code>。<strong>在v1.0</strong>之前，<code style="user-select: auto;" onclick="mdcp.copyCode(event)">exclude_unset</code> 被称为 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">skip_defaults</code>；现在不赞成使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">skip_defaults</code>。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">exclude_defaults</code></p> <p>是否应从返回的字典中排除等于其默认值的字段 (无论是否设置)；默认为 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">False</code>。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">exclude_none</code></p> <p>是否应从返回的字典中排除等于 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">None</code> 的字段；默认为 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">False</code>。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">encoder</code></p> <p>传递给 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">json.dumps()</code> 的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">default</code> 参数的自义编码器函数，默认为设计用于所有常见类型的自定义编码器。</p> </li><li> <p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">**dumps_kwargs</code></p> <p>传递给 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">json.dumps()</code> 的其他关键字参数。例如，<code style="user-select: auto;" onclick="mdcp.copyCode(event)">indent</code>。</p> </li></ul> 
<p>Pydantic可以将许多常用的类型序列化为JSON(例如 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">datetime</code>，<code style="user-select: auto;" onclick="mdcp.copyCode(event)">date</code> 或 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">UUID</code>)，这通常会失败于一个简单的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">json.dumps(foobar)</code>。</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime
<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel


<span class="token keyword">class</span> <span class="token class-name">BarModel</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
whatever<span class="token punctuation">:</span> <span class="token builtin">int</span>


<span class="token keyword">class</span> <span class="token class-name">FooBarModel</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
foo<span class="token punctuation">:</span> datetime
bar<span class="token punctuation">:</span> BarModel


m <span class="token operator">=</span> FooBarModel<span class="token punctuation">(</span>foo<span class="token operator">=</span>datetime<span class="token punctuation">(</span><span class="token number">2032</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">,</span> bar<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'whatever'</span><span class="token punctuation">:</span> <span class="token number">123</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; {"foo": "2032-06-01T12:13:14", "bar": {"whatever": 123}}</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li></ul></pre> 
<h4><a id="3641_json_encoders_4877"></a>3.6.4.1 json_encoders</h4> 
<p>序列化可以使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">json_encoders</code> 配置属性在模型上定制；键应该是类型，值应该是序列化该类型的函数(见下面的例子)：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime<span class="token punctuation">,</span> timedelta
<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel
<span class="token keyword">from</span> pydantic<span class="token punctuation">.</span>json <span class="token keyword">import</span> timedelta_isoformat


<span class="token keyword">class</span> <span class="token class-name">WithCustomEncoders</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
dt<span class="token punctuation">:</span> datetime
diff<span class="token punctuation">:</span> timedelta

<span class="token keyword">class</span> <span class="token class-name">Config</span><span class="token punctuation">:</span>
    json_encoders <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        datetime<span class="token punctuation">:</span> <span class="token keyword">lambda</span> v<span class="token punctuation">:</span> v<span class="token punctuation">.</span>timestamp<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        timedelta<span class="token punctuation">:</span> timedelta_isoformat<span class="token punctuation">,</span>
    <span class="token punctuation">}</span>


m <span class="token operator">=</span> WithCustomEncoders<span class="token punctuation">(</span>dt<span class="token operator">=</span>datetime<span class="token punctuation">(</span><span class="token number">2032</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> diff<span class="token operator">=</span>timedelta<span class="token punctuation">(</span>hours<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; {"dt": 1969660800.0, "diff": "P4DT4H0M0.000000S"}</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li></ul></pre> 
<p>默认情况下，<code style="user-select: auto;" onclick="mdcp.copyCode(event)">timedelta</code> 被编码为总秒数的简单浮点数。<code style="user-select: auto;" onclick="mdcp.copyCode(event)">timedelta_isoformat</code> 是一个可选的替代方案，它实现了ISO 8601时间差异编码。</p> 
<h4><a id="3642__4905"></a>3.6.4.2 序列化子类</h4> 
<blockquote> 
<p><mark>注意</mark></p> 
<p>在<strong>v1.5</strong>之前，常见类型的子类不会自动序列化为JSON。</p> 
</blockquote> 
<p>通用类型的子类会像它们的超类一样被自动编码：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> datetime <span class="token keyword">import</span> date<span class="token punctuation">,</span> timedelta
<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel
<span class="token keyword">from</span> pydantic<span class="token punctuation">.</span>validators <span class="token keyword">import</span> int_validator


<span class="token keyword">class</span> <span class="token class-name">DayThisYear</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token triple-quoted-string string">"""
Contrived example of a special type of date that
takes an int and interprets it as a day in the current year
"""</span>

@<span class="token builtin">classmethod</span>
<span class="token keyword">def</span> <span class="token function">__get_validators__</span><span class="token punctuation">(</span>cls<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">yield</span> int_validator
    <span class="token keyword">yield</span> cls<span class="token punctuation">.</span>validate

@<span class="token builtin">classmethod</span>
<span class="token keyword">def</span> <span class="token function">validate</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> v<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> date<span class="token punctuation">.</span>today<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span>month<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> day<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> timedelta<span class="token punctuation">(</span>days<span class="token operator">=</span>v<span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">FooModel</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
date<span class="token punctuation">:</span> DayThisYear


m <span class="token operator">=</span> FooModel<span class="token punctuation">(</span>date<span class="token operator">=</span><span class="token number">300</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; {"date": "2020-10-27"}</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li></ul></pre> 
<h4><a id="3643__JSON_4944"></a>3.6.4.3 自定义 JSON反序列化</h4> 
<p>为了提高JSON编码和解码的性能，可以通过配置中的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">json_load</code> 和 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">json_dumps</code> 属性来使用其他JSON实现(例如<a href="https://pypi.python.org/pypi/ujson" target="_blank">ujson</a>)。</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime
<span class="token keyword">import</span> ujson
<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel


<span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token builtin">id</span><span class="token punctuation">:</span> <span class="token builtin">int</span>
name <span class="token operator">=</span> <span class="token string">'John Doe'</span>
signup_ts<span class="token punctuation">:</span> datetime <span class="token operator">=</span> <span class="token boolean">None</span>

<span class="token keyword">class</span> <span class="token class-name">Config</span><span class="token punctuation">:</span>
    json_loads <span class="token operator">=</span> ujson<span class="token punctuation">.</span>loads


user <span class="token operator">=</span> User<span class="token punctuation">.</span>parse_raw<span class="token punctuation">(</span><span class="token string">'{"id": 123,"signup_ts":1234567890,"name":"John Doe"}'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>
<span class="token comment">#&gt; id=123 signup_ts=datetime.datetime(2009, 2, 13, 23, 31, 30,</span>
<span class="token comment">#&gt; tzinfo=datetime.timezone.utc) name='John Doe'</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li></ul></pre> 
<p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">ujson</code> 通常不能用于转储JSON，因为它不支持对像 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">datetime</code> 这样的对象进行编码，也不接受 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">default</code> 回退函数参数。为此，您可以使用另一个库，如 <a href="https://github.com/ijl/orjson" target="_blank">orjson</a>。</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime
<span class="token keyword">import</span> orjson
<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel


<span class="token keyword">def</span> <span class="token function">orjson_dumps</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">,</span> default<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token comment"># orjson.dumps returns bytes, to match standard json.dumps we need to decode</span>
<span class="token keyword">return</span> orjson<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>v<span class="token punctuation">,</span> default<span class="token operator">=</span>default<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token builtin">id</span><span class="token punctuation">:</span> <span class="token builtin">int</span>
name <span class="token operator">=</span> <span class="token string">'John Doe'</span>
signup_ts<span class="token punctuation">:</span> datetime <span class="token operator">=</span> <span class="token boolean">None</span>

<span class="token keyword">class</span> <span class="token class-name">Config</span><span class="token punctuation">:</span>
    json_loads <span class="token operator">=</span> orjson<span class="token punctuation">.</span>loads
    json_dumps <span class="token operator">=</span> orjson_dumps


user <span class="token operator">=</span> User<span class="token punctuation">.</span>parse_raw<span class="token punctuation">(</span><span class="token string">'{"id":123,"signup_ts":1234567890,"name":"John Doe"}'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; {"id":123,"signup_ts":"2009-02-13T23:31:30+00:00","name":"John Doe"}</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li></ul></pre> 
<p>请注意，<code style="user-select: auto;" onclick="mdcp.copyCode(event)">orjson</code> 本身就考虑了 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">datetime</code> 编码，这使得它比 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">json.dumps</code> 更快。但这意味着您不能总是使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Config.json_encoders</code> 自定义编码。</p> 
<h3><a name="t53"></a><a id="365_pickledumpsmodel_4999"></a>3.6.5 pickle.dumps(model)</h3> 
<p>使用与 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">copy()</code> 相同的管道，pydantic模型支持高效的pickle和unpickle。</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">import</span> pickle
<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel


<span class="token keyword">class</span> <span class="token class-name">FooBarModel</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
a<span class="token punctuation">:</span> <span class="token builtin">str</span>
b<span class="token punctuation">:</span> <span class="token builtin">int</span>


m <span class="token operator">=</span> FooBarModel<span class="token punctuation">(</span>a<span class="token operator">=</span><span class="token string">'hello'</span><span class="token punctuation">,</span> b<span class="token operator">=</span><span class="token number">123</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span>
<span class="token comment">#&gt; a='hello' b=123</span>
data <span class="token operator">=</span> pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>m<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
b'\x80\x04\x95\x8e\x00\x00\x00\x00\x00\x00\x00\x8c\x17exporting_models_pickle
\x94\x8c\x0bFooBarModel\x94\x93\x94)\x81\x94}\x94(\x8c\x08__dict__\x94}\x94(\
x8c\x01a\x94\x8c\x05hello\x94\x8c\x01b\x94K{u\x8c\x0e__fields_set__\x94\x8f\x
94(h\x07h\t\x90\x8c\x1c__private_attribute_values__\x94}\x94ub.'
"""</span>
m2 <span class="token operator">=</span> pickle<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>m2<span class="token punctuation">)</span>
<span class="token comment">#&gt; a='hello' b=123</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li></ul></pre> 
<h3><a name="t54"></a><a id="366__5029"></a>3.6.6 包含和排序的高级用法</h3> 
<p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">dict</code>、<code style="user-select: auto;" onclick="mdcp.copyCode(event)">json</code> 和 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">copy</code> 方法支持 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">include</code> 和 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">exclude</code> 参数，这些参数可以是集合或字典。这允许嵌套选择导出哪些字段：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel<span class="token punctuation">,</span> SecretStr


<span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token builtin">id</span><span class="token punctuation">:</span> <span class="token builtin">int</span>
username<span class="token punctuation">:</span> <span class="token builtin">str</span>
password<span class="token punctuation">:</span> SecretStr


<span class="token keyword">class</span> <span class="token class-name">Transaction</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token builtin">id</span><span class="token punctuation">:</span> <span class="token builtin">str</span>
user<span class="token punctuation">:</span> User
value<span class="token punctuation">:</span> <span class="token builtin">int</span>


t <span class="token operator">=</span> Transaction<span class="token punctuation">(</span>
<span class="token builtin">id</span><span class="token operator">=</span><span class="token string">'1234567890'</span><span class="token punctuation">,</span>
user<span class="token operator">=</span>User<span class="token punctuation">(</span>
    <span class="token builtin">id</span><span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">,</span>
    username<span class="token operator">=</span><span class="token string">'JohnDoe'</span><span class="token punctuation">,</span>
    password<span class="token operator">=</span><span class="token string">'hashedpassword'</span>
<span class="token punctuation">)</span><span class="token punctuation">,</span>
value<span class="token operator">=</span><span class="token number">9876543210</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>

<span class="token comment"># using a set:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token builtin">dict</span><span class="token punctuation">(</span>exclude<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token string">'value'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; {'id': '1234567890'}</span>

<span class="token comment"># using a dict:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token builtin">dict</span><span class="token punctuation">(</span>exclude<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'user'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">'username'</span><span class="token punctuation">,</span> <span class="token string">'password'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'value'</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; {'id': '1234567890', 'user': {'id': 42}}</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token builtin">dict</span><span class="token punctuation">(</span>include<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token string">'user'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">'id'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; {'id': '1234567890', 'user': {'id': 42}}</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li><li style="color: rgb(153, 153, 153);">33</li><li style="color: rgb(153, 153, 153);">34</li><li style="color: rgb(153, 153, 153);">35</li></ul></pre> 
<p>省略号 (<code style="user-select: auto;" onclick="mdcp.copyCode(event)">...</code>) 表示我们要排除或包括整个键，就像我们将其包括在集合中一样。 当然，可以在任何深度级别进行相同的操作。</p> 
<p>从子模型或字典的列表或元组中包括或排除字段时，必须格外小心。 在这种情况下，字典和相关方法期望使用整数键按元素进行逐项包含或排除。 要从列表或元组的每个成员中排除字段，可以按以下方式使用字典键 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">'__all__'</code>：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">import</span> datetime
<span class="token keyword">from</span> typing <span class="token keyword">import</span> List

<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel<span class="token punctuation">,</span> SecretStr


<span class="token keyword">class</span> <span class="token class-name">Country</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
name<span class="token punctuation">:</span> <span class="token builtin">str</span>
phone_code<span class="token punctuation">:</span> <span class="token builtin">int</span>


<span class="token keyword">class</span> <span class="token class-name">Address</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
post_code<span class="token punctuation">:</span> <span class="token builtin">int</span>
country<span class="token punctuation">:</span> Country


<span class="token keyword">class</span> <span class="token class-name">CardDetails</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
number<span class="token punctuation">:</span> SecretStr
expires<span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>date


<span class="token keyword">class</span> <span class="token class-name">Hobby</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
name<span class="token punctuation">:</span> <span class="token builtin">str</span>
info<span class="token punctuation">:</span> <span class="token builtin">str</span>


<span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
first_name<span class="token punctuation">:</span> <span class="token builtin">str</span>
second_name<span class="token punctuation">:</span> <span class="token builtin">str</span>
address<span class="token punctuation">:</span> Address
card_details<span class="token punctuation">:</span> CardDetails
hobbies<span class="token punctuation">:</span> List<span class="token punctuation">[</span>Hobby<span class="token punctuation">]</span>


user <span class="token operator">=</span> User<span class="token punctuation">(</span>
first_name<span class="token operator">=</span><span class="token string">'John'</span><span class="token punctuation">,</span>
second_name<span class="token operator">=</span><span class="token string">'Doe'</span><span class="token punctuation">,</span>
address<span class="token operator">=</span>Address<span class="token punctuation">(</span>
    post_code<span class="token operator">=</span><span class="token number">123456</span><span class="token punctuation">,</span>
    country<span class="token operator">=</span>Country<span class="token punctuation">(</span>
        name<span class="token operator">=</span><span class="token string">'USA'</span><span class="token punctuation">,</span>
        phone_code<span class="token operator">=</span><span class="token number">1</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">,</span>
card_details<span class="token operator">=</span>CardDetails<span class="token punctuation">(</span>
    number<span class="token operator">=</span><span class="token number">4212934504460000</span><span class="token punctuation">,</span>
    expires<span class="token operator">=</span>datetime<span class="token punctuation">.</span>date<span class="token punctuation">(</span><span class="token number">2020</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">,</span>
hobbies<span class="token operator">=</span><span class="token punctuation">[</span>
    Hobby<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'Programming'</span><span class="token punctuation">,</span> info<span class="token operator">=</span><span class="token string">'Writing code and stuff'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    Hobby<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'Gaming'</span><span class="token punctuation">,</span> info<span class="token operator">=</span><span class="token string">'Hell Yeah!!!'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>

exclude_keys <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
<span class="token string">'second_name'</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span>
<span class="token string">'address'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">'post_code'</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token string">'country'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">'phone_code'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token string">'card_details'</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span>
<span class="token comment"># You can exclude fields from specific members of a tuple/list by index:</span>
<span class="token string">'hobbies'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">'info'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

include_keys <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
<span class="token string">'first_name'</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span>
<span class="token string">'address'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">'country'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">'name'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token string">'hobbies'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">'name'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment"># would be the same as user.dict(exclude=exclude_keys) in this case:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token builtin">dict</span><span class="token punctuation">(</span>include<span class="token operator">=</span>include_keys<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
{
'first_name': 'John',
'address': {'country': {'name': 'USA'}},
'hobbies': [
    {
        'name': 'Programming',
        'info': 'Writing code and stuff',
    },
    {'name': 'Gaming'},
],
}
"""</span>

<span class="token comment"># To exclude a field from all members of a nested list or tuple, use "__all__":</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token builtin">dict</span><span class="token punctuation">(</span>exclude<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'hobbies'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">'__all__'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">'info'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
{
'first_name': 'John',
'second_name': 'Doe',
'address': {
    'post_code': 123456,
    'country': {'name': 'USA', 'phone_code': 1},
},
'card_details': {
    'number': SecretStr('**********'),
    'expires': datetime.date(2020, 5, 1),
},
'hobbies': [{'name': 'Programming'}, {'name': 'Gaming'}],
}
"""</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li><li style="color: rgb(153, 153, 153);">33</li><li style="color: rgb(153, 153, 153);">34</li><li style="color: rgb(153, 153, 153);">35</li><li style="color: rgb(153, 153, 153);">36</li><li style="color: rgb(153, 153, 153);">37</li><li style="color: rgb(153, 153, 153);">38</li><li style="color: rgb(153, 153, 153);">39</li><li style="color: rgb(153, 153, 153);">40</li><li style="color: rgb(153, 153, 153);">41</li><li style="color: rgb(153, 153, 153);">42</li><li style="color: rgb(153, 153, 153);">43</li><li style="color: rgb(153, 153, 153);">44</li><li style="color: rgb(153, 153, 153);">45</li><li style="color: rgb(153, 153, 153);">46</li><li style="color: rgb(153, 153, 153);">47</li><li style="color: rgb(153, 153, 153);">48</li><li style="color: rgb(153, 153, 153);">49</li><li style="color: rgb(153, 153, 153);">50</li><li style="color: rgb(153, 153, 153);">51</li><li style="color: rgb(153, 153, 153);">52</li><li style="color: rgb(153, 153, 153);">53</li><li style="color: rgb(153, 153, 153);">54</li><li style="color: rgb(153, 153, 153);">55</li><li style="color: rgb(153, 153, 153);">56</li><li style="color: rgb(153, 153, 153);">57</li><li style="color: rgb(153, 153, 153);">58</li><li style="color: rgb(153, 153, 153);">59</li><li style="color: rgb(153, 153, 153);">60</li><li style="color: rgb(153, 153, 153);">61</li><li style="color: rgb(153, 153, 153);">62</li><li style="color: rgb(153, 153, 153);">63</li><li style="color: rgb(153, 153, 153);">64</li><li style="color: rgb(153, 153, 153);">65</li><li style="color: rgb(153, 153, 153);">66</li><li style="color: rgb(153, 153, 153);">67</li><li style="color: rgb(153, 153, 153);">68</li><li style="color: rgb(153, 153, 153);">69</li><li style="color: rgb(153, 153, 153);">70</li><li style="color: rgb(153, 153, 153);">71</li><li style="color: rgb(153, 153, 153);">72</li><li style="color: rgb(153, 153, 153);">73</li><li style="color: rgb(153, 153, 153);">74</li><li style="color: rgb(153, 153, 153);">75</li><li style="color: rgb(153, 153, 153);">76</li><li style="color: rgb(153, 153, 153);">77</li><li style="color: rgb(153, 153, 153);">78</li><li style="color: rgb(153, 153, 153);">79</li><li style="color: rgb(153, 153, 153);">80</li><li style="color: rgb(153, 153, 153);">81</li><li style="color: rgb(153, 153, 153);">82</li><li style="color: rgb(153, 153, 153);">83</li><li style="color: rgb(153, 153, 153);">84</li><li style="color: rgb(153, 153, 153);">85</li><li style="color: rgb(153, 153, 153);">86</li><li style="color: rgb(153, 153, 153);">87</li><li style="color: rgb(153, 153, 153);">88</li><li style="color: rgb(153, 153, 153);">89</li><li style="color: rgb(153, 153, 153);">90</li><li style="color: rgb(153, 153, 153);">91</li><li style="color: rgb(153, 153, 153);">92</li><li style="color: rgb(153, 153, 153);">93</li><li style="color: rgb(153, 153, 153);">94</li><li style="color: rgb(153, 153, 153);">95</li><li style="color: rgb(153, 153, 153);">96</li><li style="color: rgb(153, 153, 153);">97</li><li style="color: rgb(153, 153, 153);">98</li><li style="color: rgb(153, 153, 153);">99</li><li style="color: rgb(153, 153, 153);">100</li><li style="color: rgb(153, 153, 153);">101</li></ul></pre> 
<p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">json</code> 和 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">copy</code> 方法也是如此。</p> 
<h2><a name="t55"></a><a id="37_Dataclasses_5181"></a>3.7 Dataclasses</h2> 
<p>如果您不想使用pydantic的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">BaseModel</code> ，您可以在标准 <a href="https://docs.python.org/3/library/dataclasses.html" target="_blank">dataclasses</a> (在python 3.7中引入)上获得相同的数据验证。</p> 
<p>数据类在Python 3.6中使用 <a href="https://github.com/ericvsmith/dataclasses" target="_blank">dataclasses的backport包</a> 工作。</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime
<span class="token keyword">from</span> pydantic<span class="token punctuation">.</span>dataclasses <span class="token keyword">import</span> dataclass


@dataclass
<span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">:</span>
<span class="token builtin">id</span><span class="token punctuation">:</span> <span class="token builtin">int</span>
name<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">'John Doe'</span>
signup_ts<span class="token punctuation">:</span> datetime <span class="token operator">=</span> <span class="token boolean">None</span>


user <span class="token operator">=</span> User<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token string">'42'</span><span class="token punctuation">,</span> signup_ts<span class="token operator">=</span><span class="token string">'2032-06-21T12:00'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>
<span class="token comment">#&gt; User(id=42, name='John Doe', signup_ts=datetime.datetime(2032, 6, 21, 12, 0))</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li></ul></pre> 
<blockquote> 
<p><mark>注意</mark></p> 
<p>请记住 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">pydantic.dataclasses.dataclass</code> 是具有验证的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">dataclasses.dataclass</code> 的直接替代。而不是 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">pydantic.BaseModel</code> (在初始化钩子的工作方式上略有不同) 的替代。在某些情况下，子类化 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">BaseModel</code> 是更好的选择。</p> 
<p>有关更多信息和讨论，请参阅 <a href="https://github.com/samuelcolvin/pydantic/issues/710" target="_blank">samuelcolvin/pydantic#710</a>。</p> 
</blockquote> 
<p>您可以使用所有标准的pydantic字段类型，并且结果数据类将与标准库 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">dataclass</code> 装饰器创建的数据类相同。</p> 
<p>可以通过 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">__pydantic_model__</code> 访问底层模型及其模式。 另外，可以通过 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">dataclasses.field</code> 指定需要 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">default_factory</code> 的字段。</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">import</span> dataclasses
<span class="token keyword">from</span> typing <span class="token keyword">import</span> List
<span class="token keyword">from</span> pydantic<span class="token punctuation">.</span>dataclasses <span class="token keyword">import</span> dataclass


@dataclass
<span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">:</span>
<span class="token builtin">id</span><span class="token punctuation">:</span> <span class="token builtin">int</span>
name<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">'John Doe'</span>
friends<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span> <span class="token operator">=</span> dataclasses<span class="token punctuation">.</span>field<span class="token punctuation">(</span>default_factory<span class="token operator">=</span><span class="token keyword">lambda</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>


user <span class="token operator">=</span> User<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token string">'42'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>__pydantic_model__<span class="token punctuation">.</span>schema<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
{
'title': 'User',
'type': 'object',
'properties': {
    'id': {'title': 'Id', 'type': 'integer'},
    'name': {
        'title': 'Name',
        'default': 'John Doe',
        'type': 'string',
    },
    'friends': {
        'title': 'Friends',
        'default': [0],
        'type': 'array',
        'items': {'type': 'integer'},
    },
},
'required': ['id'],
}
"""</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li><li style="color: rgb(153, 153, 153);">33</li><li style="color: rgb(153, 153, 153);">34</li><li style="color: rgb(153, 153, 153);">35</li></ul></pre> 
<p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">pydantic.dataclasses.dataclass</code> 的参数与标准装饰器相同，除了一个额外的关键字参数 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">config</code>，它与 <a href="https://pydantic-docs.helpmanual.io/usage/model_config/" target="_blank"><code style="user-select: auto;" onclick="mdcp.copyCode(event)">Config</code></a> 的含义相同。</p> 
<blockquote> 
<p><mark>警告</mark></p> 
<p><strong>v1.2</strong>之后，必须安装 <a href="https://pydantic-docs.helpmanual.io/mypy_plugin.md" target="_blank">Mypy 插件</a> 来对 Pydantic 数据类进行类型检查。</p> 
</blockquote> 
<p>有关结合验证器与数据类的更多信息，请参见 [dataclass验证器](# 3.3.7 Dataclass 验证器)。</p> 
<h3><a name="t56"></a><a id="371__5260"></a>3.7.1 嵌套的数据类</h3> 
<p>在数据类和普通模型中都支持嵌套数据类。</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> pydantic <span class="token keyword">import</span> AnyUrl
<span class="token keyword">from</span> pydantic<span class="token punctuation">.</span>dataclasses <span class="token keyword">import</span> dataclass


@dataclass
<span class="token keyword">class</span> <span class="token class-name">NavbarButton</span><span class="token punctuation">:</span>
href<span class="token punctuation">:</span> AnyUrl


@dataclass
<span class="token keyword">class</span> <span class="token class-name">Navbar</span><span class="token punctuation">:</span>
button<span class="token punctuation">:</span> NavbarButton


navbar <span class="token operator">=</span> Navbar<span class="token punctuation">(</span>button<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'https://example.com'</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>navbar<span class="token punctuation">)</span>
<span class="token comment">#&gt; Navbar(button=NavbarButton(href=AnyUrl('https://example.com', scheme='https',</span>
<span class="token comment">#&gt; host='example.com', tld='com', host_type='domain')))</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li></ul></pre> 
<p>数据类属性可以由元组、字典或数据类本身的实例填充。</p> 
<h3><a name="t57"></a><a id="372_pydantic_5287"></a>3.7.2 标准库的数据类型和pydantic的数据类型</h3> 
<h4><a id="3721_pydantic_5289"></a>3.7.2.1 将标准库的数据类型转换成pydantic的数据类型</h4> 
<p>可以使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">pydantic.dataclasses.dataclass</code> 来装饰标准库的数据类(嵌套或非嵌套)，从而使其可以很容易地转换成 pydantic 数据类。</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">import</span> dataclasses
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime
<span class="token keyword">from</span> typing <span class="token keyword">import</span> Optional

<span class="token keyword">import</span> pydantic


@dataclasses<span class="token punctuation">.</span>dataclass
<span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
modified_date<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>datetime<span class="token punctuation">]</span>
seen_count<span class="token punctuation">:</span> <span class="token builtin">int</span>


@dataclasses<span class="token punctuation">.</span>dataclass
<span class="token keyword">class</span> <span class="token class-name">File</span><span class="token punctuation">(</span>Meta<span class="token punctuation">)</span><span class="token punctuation">:</span>
filename<span class="token punctuation">:</span> <span class="token builtin">str</span>


File <span class="token operator">=</span> pydantic<span class="token punctuation">.</span>dataclasses<span class="token punctuation">.</span>dataclass<span class="token punctuation">(</span>File<span class="token punctuation">)</span>

<span class="token builtin">file</span> <span class="token operator">=</span> File<span class="token punctuation">(</span>
filename<span class="token operator">=</span>b<span class="token string">'thefilename'</span><span class="token punctuation">,</span>
modified_date<span class="token operator">=</span><span class="token string">'2020-01-01T00:00'</span><span class="token punctuation">,</span>
seen_count<span class="token operator">=</span><span class="token string">'7'</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; File(modified_date=datetime.datetime(2020, 1, 1, 0, 0), seen_count=7,</span>
<span class="token comment">#&gt; filename='thefilename')</span>

<span class="token keyword">try</span><span class="token punctuation">:</span>
File<span class="token punctuation">(</span>
    filename<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'not'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'string'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    modified_date<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
    seen_count<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
<span class="token keyword">except</span> pydantic<span class="token punctuation">.</span>ValidationError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
1 validation error for File
filename
  str type expected (type=type_error.str)
"""</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li><li style="color: rgb(153, 153, 153);">33</li><li style="color: rgb(153, 153, 153);">34</li><li style="color: rgb(153, 153, 153);">35</li><li style="color: rgb(153, 153, 153);">36</li><li style="color: rgb(153, 153, 153);">37</li><li style="color: rgb(153, 153, 153);">38</li><li style="color: rgb(153, 153, 153);">39</li><li style="color: rgb(153, 153, 153);">40</li><li style="color: rgb(153, 153, 153);">41</li><li style="color: rgb(153, 153, 153);">42</li></ul></pre> 
<h4><a id="3722__dataclasses__5338"></a>3.7.2.2 从标准库的 dataclasses 继承</h4> 
<p>标准库数据类(嵌套或非嵌套)也可以继承，pydantic将自动验证所有继承的字段。</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">import</span> dataclasses

<span class="token keyword">import</span> pydantic


@dataclasses<span class="token punctuation">.</span>dataclass
<span class="token keyword">class</span> <span class="token class-name">Z</span><span class="token punctuation">:</span>
z<span class="token punctuation">:</span> <span class="token builtin">int</span>


@dataclasses<span class="token punctuation">.</span>dataclass
<span class="token keyword">class</span> <span class="token class-name">Y</span><span class="token punctuation">(</span>Z<span class="token punctuation">)</span><span class="token punctuation">:</span>
y<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">0</span>


@pydantic<span class="token punctuation">.</span>dataclasses<span class="token punctuation">.</span>dataclass
<span class="token keyword">class</span> <span class="token class-name">X</span><span class="token punctuation">(</span>Y<span class="token punctuation">)</span><span class="token punctuation">:</span>
x<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">0</span>


foo <span class="token operator">=</span> X<span class="token punctuation">(</span>x<span class="token operator">=</span>b<span class="token string">'1'</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token string">'2'</span><span class="token punctuation">,</span> z<span class="token operator">=</span><span class="token string">'3'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span>
<span class="token comment">#&gt; X(z=3, y=2, x=1)</span>

<span class="token keyword">try</span><span class="token punctuation">:</span>
X<span class="token punctuation">(</span>z<span class="token operator">=</span><span class="token string">'pika'</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> pydantic<span class="token punctuation">.</span>ValidationError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
1 validation error for X
z
  value is not a valid integer (type=type_error.integer)
"""</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li><li style="color: rgb(153, 153, 153);">33</li></ul></pre> 
<h4><a id="3723__BaseModel__5378"></a>3.7.2.3 将 BaseModel 与标准库的数据类型一起使用</h4> 
<p>请记住，与 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">BaseModel</code> 混合使用时，标准库数据类(嵌套或非嵌套)会<strong>自动转换</strong>为pydantic数据类！此外，生成的pydantic数据类将具有与原始配置<strong>完全相同的配置</strong> (<code style="user-select: auto;" onclick="mdcp.copyCode(event)">order</code>，<code style="user-select: auto;" onclick="mdcp.copyCode(event)">frozen</code> 等)。</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">import</span> dataclasses
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime
<span class="token keyword">from</span> typing <span class="token keyword">import</span> Optional

<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel<span class="token punctuation">,</span> ValidationError


@dataclasses<span class="token punctuation">.</span>dataclass<span class="token punctuation">(</span>frozen<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">:</span>
name<span class="token punctuation">:</span> <span class="token builtin">str</span>


@dataclasses<span class="token punctuation">.</span>dataclass
<span class="token keyword">class</span> <span class="token class-name">File</span><span class="token punctuation">:</span>
filename<span class="token punctuation">:</span> <span class="token builtin">str</span>
last_modification_time<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>datetime<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span>


<span class="token keyword">class</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token builtin">file</span><span class="token punctuation">:</span> File
user<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>User<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span>


<span class="token builtin">file</span> <span class="token operator">=</span> File<span class="token punctuation">(</span>
filename<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'not'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'string'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
last_modification_time<span class="token operator">=</span><span class="token string">'2020-01-01T00:00'</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>  <span class="token comment"># nothing is validated as expected</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; File(filename=['not', 'a', 'string'],</span>
<span class="token comment">#&gt; last_modification_time='2020-01-01T00:00')</span>

<span class="token keyword">try</span><span class="token punctuation">:</span>
Foo<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token operator">=</span><span class="token builtin">file</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> ValidationError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
1 validation error for Foo
file -&gt; filename
  str type expected (type=type_error.str)
"""</span>

foo <span class="token operator">=</span> Foo<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token operator">=</span>File<span class="token punctuation">(</span>filename<span class="token operator">=</span><span class="token string">'myfile'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> user<span class="token operator">=</span>User<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'pika'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
foo<span class="token punctuation">.</span>user<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'bulbi'</span>
<span class="token keyword">except</span> dataclasses<span class="token punctuation">.</span>FrozenInstanceError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token comment">#&gt; cannot assign to field 'name'</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li><li style="color: rgb(153, 153, 153);">33</li><li style="color: rgb(153, 153, 153);">34</li><li style="color: rgb(153, 153, 153);">35</li><li style="color: rgb(153, 153, 153);">36</li><li style="color: rgb(153, 153, 153);">37</li><li style="color: rgb(153, 153, 153);">38</li><li style="color: rgb(153, 153, 153);">39</li><li style="color: rgb(153, 153, 153);">40</li><li style="color: rgb(153, 153, 153);">41</li><li style="color: rgb(153, 153, 153);">42</li><li style="color: rgb(153, 153, 153);">43</li><li style="color: rgb(153, 153, 153);">44</li><li style="color: rgb(153, 153, 153);">45</li><li style="color: rgb(153, 153, 153);">46</li><li style="color: rgb(153, 153, 153);">47</li></ul></pre> 
<h4><a id="3724__5432"></a>3.7.2.4 使用自定义类型</h4> 
<p>由于标准库数据类被自动转换为使用自定义类型添加验证，因此可能会导致一些意外行为。在这种情况下，您可以简单地在配置中添加 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">arbitrary_types_allowed</code> ！</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">import</span> dataclasses

<span class="token keyword">import</span> pydantic


<span class="token keyword">class</span> <span class="token class-name">ArbitraryType</span><span class="token punctuation">:</span>
<span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
    self<span class="token punctuation">.</span>value <span class="token operator">=</span> value

<span class="token keyword">def</span> <span class="token function">__repr__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> f<span class="token string">'ArbitraryType(value={self.value!r})'</span>


@dataclasses<span class="token punctuation">.</span>dataclass
<span class="token keyword">class</span> <span class="token class-name">DC</span><span class="token punctuation">:</span>
a<span class="token punctuation">:</span> ArbitraryType
b<span class="token punctuation">:</span> <span class="token builtin">str</span>


<span class="token comment"># valid as it is a builtin dataclass without validation</span>
my_dc <span class="token operator">=</span> DC<span class="token punctuation">(</span>a<span class="token operator">=</span>ArbitraryType<span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> b<span class="token operator">=</span><span class="token string">'qwe'</span><span class="token punctuation">)</span>

<span class="token keyword">try</span><span class="token punctuation">:</span>
<span class="token keyword">class</span> <span class="token class-name">Model</span><span class="token punctuation">(</span>pydantic<span class="token punctuation">.</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
    dc<span class="token punctuation">:</span> DC
    other<span class="token punctuation">:</span> <span class="token builtin">str</span>

Model<span class="token punctuation">(</span>dc<span class="token operator">=</span>my_dc<span class="token punctuation">,</span> other<span class="token operator">=</span><span class="token string">'other'</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> RuntimeError <span class="token keyword">as</span> e<span class="token punctuation">:</span>  <span class="token comment"># invalid as it is now a pydantic dataclass</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
no validator found for &lt;class
'dataclasses_arbitrary_types_allowed.ArbitraryType'&gt;, see
`arbitrary_types_allowed` in Config
"""</span>


<span class="token keyword">class</span> <span class="token class-name">Model</span><span class="token punctuation">(</span>pydantic<span class="token punctuation">.</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
dc<span class="token punctuation">:</span> DC
other<span class="token punctuation">:</span> <span class="token builtin">str</span>

<span class="token keyword">class</span> <span class="token class-name">Config</span><span class="token punctuation">:</span>
    arbitrary_types_allowed <span class="token operator">=</span> <span class="token boolean">True</span>


m <span class="token operator">=</span> Model<span class="token punctuation">(</span>dc<span class="token operator">=</span>my_dc<span class="token punctuation">,</span> other<span class="token operator">=</span><span class="token string">'other'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">repr</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; Model(dc=DC(a=ArbitraryType(value=3), b='qwe'), other='other')</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li><li style="color: rgb(153, 153, 153);">33</li><li style="color: rgb(153, 153, 153);">34</li><li style="color: rgb(153, 153, 153);">35</li><li style="color: rgb(153, 153, 153);">36</li><li style="color: rgb(153, 153, 153);">37</li><li style="color: rgb(153, 153, 153);">38</li><li style="color: rgb(153, 153, 153);">39</li><li style="color: rgb(153, 153, 153);">40</li><li style="color: rgb(153, 153, 153);">41</li><li style="color: rgb(153, 153, 153);">42</li><li style="color: rgb(153, 153, 153);">43</li><li style="color: rgb(153, 153, 153);">44</li><li style="color: rgb(153, 153, 153);">45</li><li style="color: rgb(153, 153, 153);">46</li><li style="color: rgb(153, 153, 153);">47</li><li style="color: rgb(153, 153, 153);">48</li></ul></pre> 
<h3><a name="t58"></a><a id="373__5487"></a>3.7.3 初始化钩子</h3> 
<p>初始化数据类时，可以在 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">__post_init_post_parse__</code> 的帮助下在验证后执行代码。 该方法与 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">__post_init__</code> 不同，后者在验证之前执行代码。</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> pydantic<span class="token punctuation">.</span>dataclasses <span class="token keyword">import</span> dataclass


@dataclass
<span class="token keyword">class</span> <span class="token class-name">Birth</span><span class="token punctuation">:</span>
year<span class="token punctuation">:</span> <span class="token builtin">int</span>
month<span class="token punctuation">:</span> <span class="token builtin">int</span>
day<span class="token punctuation">:</span> <span class="token builtin">int</span>


@dataclass
<span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">:</span>
birth<span class="token punctuation">:</span> Birth

<span class="token keyword">def</span> <span class="token function">__post_init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>birth<span class="token punctuation">)</span>
    <span class="token comment">#&gt; {'year': 1995, 'month': 3, 'day': 2}</span>

<span class="token keyword">def</span> <span class="token function">__post_init_post_parse__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>birth<span class="token punctuation">)</span>
    <span class="token comment">#&gt; Birth(year=1995, month=3, day=2)</span>


user <span class="token operator">=</span> User<span class="token punctuation">(</span><span class="token operator">**</span><span class="token punctuation">{<!-- --></span><span class="token string">'birth'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">'year'</span><span class="token punctuation">:</span> <span class="token number">1995</span><span class="token punctuation">,</span> <span class="token string">'month'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'day'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; {'year': 1995, 'month': 3, 'day': 2}</span>
<span class="token comment">#&gt; Birth(year=1995, month=3, day=2)</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li></ul></pre> 
<p>从<strong>v1.0</strong>版本开始，任何使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">dataclasses.InitVar</code> 注解的字段都将会传递给 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">__post_init__</code> 和 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">__post_init_post_parse__</code>。</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> dataclasses <span class="token keyword">import</span> InitVar
<span class="token keyword">from</span> pathlib <span class="token keyword">import</span> Path
<span class="token keyword">from</span> typing <span class="token keyword">import</span> Optional

<span class="token keyword">from</span> pydantic<span class="token punctuation">.</span>dataclasses <span class="token keyword">import</span> dataclass


@dataclass
<span class="token keyword">class</span> <span class="token class-name">PathData</span><span class="token punctuation">:</span>
path<span class="token punctuation">:</span> Path
base_path<span class="token punctuation">:</span> InitVar<span class="token punctuation">[</span>Optional<span class="token punctuation">[</span>Path<span class="token punctuation">]</span><span class="token punctuation">]</span>

<span class="token keyword">def</span> <span class="token function">__post_init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> base_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'Received path={self.path!r}, base_path={base_path!r}'</span><span class="token punctuation">)</span>
    <span class="token comment">#&gt; Received path='world', base_path='/hello'</span>

<span class="token keyword">def</span> <span class="token function">__post_init_post_parse__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> base_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> base_path <span class="token keyword">is</span> <span class="token operator">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>path <span class="token operator">=</span> base_path <span class="token operator">/</span> self<span class="token punctuation">.</span>path


path_data <span class="token operator">=</span> PathData<span class="token punctuation">(</span><span class="token string">'world'</span><span class="token punctuation">,</span> base_path<span class="token operator">=</span><span class="token string">'/hello'</span><span class="token punctuation">)</span>
<span class="token comment"># Received path='world', base_path='/hello'</span>
<span class="token keyword">assert</span> path_data<span class="token punctuation">.</span>path <span class="token operator">==</span> Path<span class="token punctuation">(</span><span class="token string">'/hello/world'</span><span class="token punctuation">)</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li></ul></pre> 
<h4><a id="3731__5549"></a>3.7.3.1 与标准库数据类的区别</h4> 
<p>请注意，来自Python 标准库的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">dataclasses.dataclass</code> 仅实现 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">__post_init__</code> 方法，因为它不运行验证步骤。</p> 
<p>当用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">pydantic.dataclasses.dataclass</code> 代替 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">dataclasses.dataclass</code> 的使用时，建议将 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">__post_init__</code> 方法中执行的代码移到 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">__post_init_post_parse__</code> 方法中，并且只保留需要在验证之前执行的部分代码。</p> 
<h3><a name="t59"></a><a id="374_JSON__5555"></a>3.7.4 JSON 转储</h3> 
<p>Pydantic数据类不具有 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">.json()</code> 函数。 要将它们转储为JSON，您将需要使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">pydantic_encoder</code>，如下所示：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">import</span> dataclasses
<span class="token keyword">import</span> json
<span class="token keyword">from</span> typing <span class="token keyword">import</span> List

<span class="token keyword">from</span> pydantic<span class="token punctuation">.</span>dataclasses <span class="token keyword">import</span> dataclass
<span class="token keyword">from</span> pydantic<span class="token punctuation">.</span>json <span class="token keyword">import</span> pydantic_encoder


@dataclass
<span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">:</span>
<span class="token builtin">id</span><span class="token punctuation">:</span> <span class="token builtin">int</span>
name<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">'John Doe'</span>
friends<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span> <span class="token operator">=</span> dataclasses<span class="token punctuation">.</span>field<span class="token punctuation">(</span>default_factory<span class="token operator">=</span><span class="token keyword">lambda</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>


user <span class="token operator">=</span> User<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token string">'42'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>user<span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> default<span class="token operator">=</span>pydantic_encoder<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
{
"id": 42,
"name": "John Doe",
"friends": [
    0
]
}
"""</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li></ul></pre> 
<h2><a name="t60"></a><a id="38__5588"></a>3.8 验证装饰器</h2> 
<p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">validate_arguments</code> 装饰器允许在调用函数之前使用函数的注解来解析和验证传递给函数的参数。 虽然在后台使用了相同的模型创建和初始化方法，但它提供了一种非常简单的方法，以最少的样板将验证应用于代码。</p> 
<blockquote> 
<p><mark>Beta 测试中</mark></p> 
<p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">validate_arguments</code> 装饰器仍处于测试中，它是在<strong>v1.5</strong>中临时添加到pydantic的。在未来的版本中，它可能会有很大的变化，它的接口直到<strong>v2</strong>才会稳定。在它还处于临时阶段时，来自社区的反馈将非常有用；请在<a href="https://github.com/samuelcolvin/pydantic/issues/1205" target="_blank">#1205</a>进行评论或者创建一个新问题。</p> 
</blockquote> 
<p>用法示例：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> pydantic <span class="token keyword">import</span> validate_arguments<span class="token punctuation">,</span> ValidationError


@validate_arguments
<span class="token keyword">def</span> <span class="token function">repeat</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> count<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">,</span> separator<span class="token punctuation">:</span> <span class="token builtin">bytes</span> <span class="token operator">=</span> b<span class="token string">''</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bytes</span><span class="token punctuation">:</span>
b <span class="token operator">=</span> s<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">return</span> separator<span class="token punctuation">.</span>join<span class="token punctuation">(</span>b <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">)</span>


a <span class="token operator">=</span> repeat<span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
<span class="token comment">#&gt; b'hellohellohello'</span>

b <span class="token operator">=</span> repeat<span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token string">'4'</span><span class="token punctuation">,</span> separator<span class="token operator">=</span><span class="token string">' '</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>
<span class="token comment">#&gt; b'x x x x'</span>

<span class="token keyword">try</span><span class="token punctuation">:</span>
c <span class="token operator">=</span> repeat<span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">,</span> <span class="token string">'wrong'</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> ValidationError <span class="token keyword">as</span> exc<span class="token punctuation">:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>exc<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
1 validation error for Repeat
count
  value is not a valid integer (type=type_error.integer)
"""</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li></ul></pre> 
<h3><a name="t61"></a><a id="381__5627"></a>3.8.1 参数类型</h3> 
<p>参数类型是从函数的类型注解进行推断的，没有类型注解的参数被认为是 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Any</code> 类型的。因为 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">validate_arguments</code> 内部使用标准的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">BaseModel</code>，因此，[字段类型](# 3.2 字段类型) 中列出的所有类型都可以被验证，包括 pydantic 模型和[自定义数据类型](# 3.2.7 自定义数据类型)。与pydantic的其余部分一样，类型可以在传递给实际函数之前由装饰器强制执行转换：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> pathlib <span class="token keyword">import</span> Path
<span class="token keyword">from</span> typing <span class="token keyword">import</span> Pattern<span class="token punctuation">,</span> Optional

<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> validate_arguments<span class="token punctuation">,</span> DirectoryPath


@validate_arguments
<span class="token keyword">def</span> <span class="token function">find_file</span><span class="token punctuation">(</span>path<span class="token punctuation">:</span> DirectoryPath<span class="token punctuation">,</span> regex<span class="token punctuation">:</span> Pattern<span class="token punctuation">,</span> <span class="token builtin">max</span><span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Optional<span class="token punctuation">[</span>Path<span class="token punctuation">]</span><span class="token punctuation">:</span>
<span class="token keyword">for</span> i<span class="token punctuation">,</span> f <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span>glob<span class="token punctuation">(</span><span class="token string">'**/*'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token builtin">max</span> <span class="token operator">and</span> i <span class="token operator">&gt;</span> <span class="token builtin">max</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span>
    <span class="token keyword">if</span> f<span class="token punctuation">.</span>is_file<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">and</span> regex<span class="token punctuation">.</span>fullmatch<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>relative_to<span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> f


<span class="token keyword">print</span><span class="token punctuation">(</span>find_file<span class="token punctuation">(</span><span class="token string">'/etc/'</span><span class="token punctuation">,</span> <span class="token string">'^sys.*'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; /etc/sysctl.conf</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>find_file<span class="token punctuation">(</span><span class="token string">'/etc/'</span><span class="token punctuation">,</span> <span class="token string">'^foobar.*'</span><span class="token punctuation">,</span> <span class="token builtin">max</span><span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; None</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li></ul></pre> 
<p>需要注意的是，<em>通过将它们作为字符串传递，<code style="user-select: auto;" onclick="mdcp.copyCode(event)">path</code> 和 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">regex</code> 分别被装饰器转换为 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Path</code> 对象和正则表达式</em>。<code style="user-select: auto;" onclick="mdcp.copyCode(event)">max</code> 没有类型注释，因此装饰器将其视为 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Any</code> 类型。</p> 
<p>这样的类型强制转换可能非常有用，但也会造成混乱或者不是我们想要的，请参阅[下面](# 3.8.7.2 强制和严格)关于 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">validate_arguments</code> 在这方面的限制的讨论。</p> 
<h3><a name="t62"></a><a id="382__5657"></a>3.8.2 函数签名</h3> 
<p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">validate_arguments</code> 装饰器被设计为使用所有可能的参数配置和下面这些所有可能的组合来处理函数：</p> 
<ul><li>有或者没有默认值的位置参数或关键字参数</li><li>通过 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">*</code> (通常为 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">*args</code>) 定义的可变位置参数</li><li>通过 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">**</code> (通常为 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">**kwargs</code>) 定义的可变关键字参数</li><li>仅限关键字参数，即 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">*,</code> 后面的参数</li><li>仅限位置参数，即 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">, /</code> 前面的参数（Python3.8的新功能）</li></ul> 
<p>下面的示例演示了上面所提到的所有参数类型：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> pydantic <span class="token keyword">import</span> validate_arguments


@validate_arguments
<span class="token keyword">def</span> <span class="token function">pos_or_kw</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">str</span><span class="token punctuation">:</span>
<span class="token keyword">return</span> f<span class="token string">'a={a} b={b}'</span>


<span class="token keyword">print</span><span class="token punctuation">(</span>pos_or_kw<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; a=1 b=2</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>pos_or_kw<span class="token punctuation">(</span>a<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; a=1 b=2</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>pos_or_kw<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; a=1 b=3</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>pos_or_kw<span class="token punctuation">(</span>a<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; a=1 b=3</span>


@validate_arguments
<span class="token keyword">def</span> <span class="token function">kw_only</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">,</span> a<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">str</span><span class="token punctuation">:</span>
<span class="token keyword">return</span> f<span class="token string">'a={a} b={b}'</span>


<span class="token keyword">print</span><span class="token punctuation">(</span>kw_only<span class="token punctuation">(</span>a<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; a=1 b=2</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>kw_only<span class="token punctuation">(</span>a<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; a=1 b=3</span>


@validate_arguments
<span class="token keyword">def</span> <span class="token function">pos_only</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">/</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">str</span><span class="token punctuation">:</span>  <span class="token comment"># python 3.8 only</span>
<span class="token keyword">return</span> f<span class="token string">'a={a} b={b}'</span>


<span class="token keyword">print</span><span class="token punctuation">(</span>pos_only<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; a=1 b=2</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>pos_only<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; a=1 b=2</span>


@validate_arguments
<span class="token keyword">def</span> <span class="token function">var_args</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">str</span><span class="token punctuation">:</span>
<span class="token keyword">return</span> <span class="token builtin">str</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span>


<span class="token keyword">print</span><span class="token punctuation">(</span>var_args<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; (1,)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>var_args<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; (1, 2)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>var_args<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; (1, 2, 3)</span>


@validate_arguments
<span class="token keyword">def</span> <span class="token function">var_kwargs</span><span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">str</span><span class="token punctuation">:</span>
<span class="token keyword">return</span> <span class="token builtin">str</span><span class="token punctuation">(</span>kwargs<span class="token punctuation">)</span>


<span class="token keyword">print</span><span class="token punctuation">(</span>var_kwargs<span class="token punctuation">(</span>a<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; {'a': 1}</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>var_kwargs<span class="token punctuation">(</span>a<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; {'a': 1, 'b': 2}</span>


@validate_arguments
<span class="token keyword">def</span> <span class="token function">armageddon</span><span class="token punctuation">(</span>
a<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span>
<span class="token operator">/</span><span class="token punctuation">,</span>  <span class="token comment"># python 3.8 only</span>
b<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span>
c<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
<span class="token operator">*</span>d<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span>
e<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span>
f<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
<span class="token operator">**</span>g<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">str</span><span class="token punctuation">:</span>
<span class="token keyword">return</span> f<span class="token string">'a={a} b={b} c={c} d={d} e={e} f={f} g={g}'</span>


<span class="token keyword">print</span><span class="token punctuation">(</span>armageddon<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> e<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; a=1 b=2 c=None d=() e=3 f=None g={}</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>armageddon<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span> e<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">,</span> f<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span> g<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> spam<span class="token operator">=</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; a=1 b=2 c=7 d=(4, 5, 6) e=8 f=9 g={'spam': 11}</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li><li style="color: rgb(153, 153, 153);">33</li><li style="color: rgb(153, 153, 153);">34</li><li style="color: rgb(153, 153, 153);">35</li><li style="color: rgb(153, 153, 153);">36</li><li style="color: rgb(153, 153, 153);">37</li><li style="color: rgb(153, 153, 153);">38</li><li style="color: rgb(153, 153, 153);">39</li><li style="color: rgb(153, 153, 153);">40</li><li style="color: rgb(153, 153, 153);">41</li><li style="color: rgb(153, 153, 153);">42</li><li style="color: rgb(153, 153, 153);">43</li><li style="color: rgb(153, 153, 153);">44</li><li style="color: rgb(153, 153, 153);">45</li><li style="color: rgb(153, 153, 153);">46</li><li style="color: rgb(153, 153, 153);">47</li><li style="color: rgb(153, 153, 153);">48</li><li style="color: rgb(153, 153, 153);">49</li><li style="color: rgb(153, 153, 153);">50</li><li style="color: rgb(153, 153, 153);">51</li><li style="color: rgb(153, 153, 153);">52</li><li style="color: rgb(153, 153, 153);">53</li><li style="color: rgb(153, 153, 153);">54</li><li style="color: rgb(153, 153, 153);">55</li><li style="color: rgb(153, 153, 153);">56</li><li style="color: rgb(153, 153, 153);">57</li><li style="color: rgb(153, 153, 153);">58</li><li style="color: rgb(153, 153, 153);">59</li><li style="color: rgb(153, 153, 153);">60</li><li style="color: rgb(153, 153, 153);">61</li><li style="color: rgb(153, 153, 153);">62</li><li style="color: rgb(153, 153, 153);">63</li><li style="color: rgb(153, 153, 153);">64</li><li style="color: rgb(153, 153, 153);">65</li><li style="color: rgb(153, 153, 153);">66</li><li style="color: rgb(153, 153, 153);">67</li><li style="color: rgb(153, 153, 153);">68</li><li style="color: rgb(153, 153, 153);">69</li><li style="color: rgb(153, 153, 153);">70</li><li style="color: rgb(153, 153, 153);">71</li><li style="color: rgb(153, 153, 153);">72</li><li style="color: rgb(153, 153, 153);">73</li><li style="color: rgb(153, 153, 153);">74</li><li style="color: rgb(153, 153, 153);">75</li><li style="color: rgb(153, 153, 153);">76</li><li style="color: rgb(153, 153, 153);">77</li><li style="color: rgb(153, 153, 153);">78</li><li style="color: rgb(153, 153, 153);">79</li><li style="color: rgb(153, 153, 153);">80</li><li style="color: rgb(153, 153, 153);">81</li><li style="color: rgb(153, 153, 153);">82</li></ul></pre> 
<h3><a name="t63"></a><a id="383__mypy__5754"></a>3.8.3 与 mypy 一起使用</h3> 
<p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">validate_arguments</code> 装饰器应该与mypy配合使用，因为它被定义为返回与装饰的函数具有相同签名的函数。 唯一的限制是，由于我们诱使mypy认为装饰器返回的函数与被装饰的函数相同； 要访问[原始函数](# 3.8.4 原始函数)或其他属性，将需要 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">type: ignore</code>。</p> 
<h3><a name="t64"></a><a id="384__5758"></a>3.8.4 原始函数</h3> 
<p>被装饰的原始函数是可访问的，如果在某些情况下您信任输入参数并希望以最高性能的方式调用该函数，则这是很有用的(请参见下面的[性能说明](# 3.8.7.3 性能))：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> pydantic <span class="token keyword">import</span> validate_arguments


@validate_arguments
<span class="token keyword">def</span> <span class="token function">repeat</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> count<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">,</span> separator<span class="token punctuation">:</span> <span class="token builtin">bytes</span> <span class="token operator">=</span> b<span class="token string">''</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bytes</span><span class="token punctuation">:</span>
b <span class="token operator">=</span> s<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">return</span> separator<span class="token punctuation">.</span>join<span class="token punctuation">(</span>b <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">)</span>


a <span class="token operator">=</span> repeat<span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
<span class="token comment">#&gt; b'hellohellohello'</span>

b <span class="token operator">=</span> repeat<span class="token punctuation">.</span>raw_function<span class="token punctuation">(</span><span class="token string">'good bye'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> separator<span class="token operator">=</span>b<span class="token string">', '</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>
<span class="token comment">#&gt; b'good bye, good bye'</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li></ul></pre> 
<h3><a name="t65"></a><a id="385__5781"></a>3.8.5 异步函数</h3> 
<p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">validate_arguments</code> 装饰器也可以在异步函数上使用：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">import</span> asyncio
<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> PositiveInt<span class="token punctuation">,</span> ValidationError<span class="token punctuation">,</span> validate_arguments


@validate_arguments
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">get_user_email</span><span class="token punctuation">(</span>user_id<span class="token punctuation">:</span> PositiveInt<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token comment"># `conn` is some fictional connection to a database</span>
email <span class="token operator">=</span> <span class="token keyword">await</span> conn<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'select email from users where id=$1'</span><span class="token punctuation">,</span> user_id<span class="token punctuation">)</span>
<span class="token keyword">if</span> email <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
    <span class="token keyword">raise</span> RuntimeError<span class="token punctuation">(</span><span class="token string">'user not found'</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> email


<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
email <span class="token operator">=</span> <span class="token keyword">await</span> get_user_email<span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>email<span class="token punctuation">)</span>
<span class="token comment">#&gt; testing@example.com</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
    <span class="token keyword">await</span> get_user_email<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> ValidationError <span class="token keyword">as</span> exc<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>exc<span class="token punctuation">.</span>errors<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token triple-quoted-string string">"""
    [
        {
            'loc': ('user_id',),
            'msg': 'ensure this value is greater than 0',
            'type': 'value_error.number.not_gt',
            'ctx': {'limit_value': 0},
        },
    ]
    """</span>


asyncio<span class="token punctuation">.</span>run<span class="token punctuation">(</span>main<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li><li style="color: rgb(153, 153, 153);">33</li><li style="color: rgb(153, 153, 153);">34</li><li style="color: rgb(153, 153, 153);">35</li></ul></pre> 
<h3><a name="t66"></a><a id="386__5823"></a>3.8.6 自定义配置</h3> 
<p>可以使用配置设置来自定义 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">validate_arguments</code> 后面的模型，这等同于在普通模型中设置 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Config</code> 子类。</p> 
<blockquote> 
<p><mark>警告</mark></p> 
<p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">@validate_arguments</code> 尚不支持允许配置别名的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Config</code> 的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">fields</code> 和 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">alias_generator</code> 属性，使用它们会引发错误。</p> 
</blockquote> 
<p>使用装饰器的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">config</code> 关键字参数设置配置，该参数可以是配置类，也可以是属性字典，这个属性字典之后会被转换成类。</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> pydantic <span class="token keyword">import</span> ValidationError<span class="token punctuation">,</span> validate_arguments


<span class="token keyword">class</span> <span class="token class-name">Foobar</span><span class="token punctuation">:</span>
<span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> v<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    self<span class="token punctuation">.</span>v <span class="token operator">=</span> v

<span class="token keyword">def</span> <span class="token function">__add__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> other<span class="token punctuation">:</span> <span class="token string">'Foobar'</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">str</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> f<span class="token string">'{self} + {other}'</span>

<span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">str</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> f<span class="token string">'Foobar({self.v})'</span>


@validate_arguments<span class="token punctuation">(</span>config<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>arbitrary_types_allowed<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">add_foobars</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span> Foobar<span class="token punctuation">,</span> b<span class="token punctuation">:</span> Foobar<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token keyword">return</span> a <span class="token operator">+</span> b


c <span class="token operator">=</span> add_foobars<span class="token punctuation">(</span>Foobar<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Foobar<span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
<span class="token comment">#&gt; Foobar(a) + Foobar(b)</span>

<span class="token keyword">try</span><span class="token punctuation">:</span>
add_foobars<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> ValidationError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
2 validation errors for AddFoobars
a
  instance of Foobar expected (type=type_error.arbitrary_type;
expected_arbitrary_type=Foobar)
b
  instance of Foobar expected (type=type_error.arbitrary_type;
expected_arbitrary_type=Foobar)
"""</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li><li style="color: rgb(153, 153, 153);">33</li><li style="color: rgb(153, 153, 153);">34</li><li style="color: rgb(153, 153, 153);">35</li><li style="color: rgb(153, 153, 153);">36</li></ul></pre> 
<h3><a name="t67"></a><a id="387__5872"></a>3.8.7 限制</h3> 
<p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">validate_arguments</code> 是临时发布的，没有添加任何附加功能(稍后可能会添加)，请参阅<a href="https://github.com/samuelcolvin/pydantic/issues/1205" target="_blank">#1205</a>了解更多有关此功能的讨论。</p> 
<h4><a id="3871__5876"></a>3.8.7.1 验证异常</h4> 
<p>当前，如果验证失败，则会引发标准的pydantic <code style="user-select: auto;" onclick="mdcp.copyCode(event)">ValidationError</code>，请参阅[模型错误处理](# 3.1.4 错误处理)。</p> 
<p>这很有用，因为它的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">str()</code> 方法提供了所发生错误的有用的详细信息，当将错误暴露给最终用户时，<code style="user-select: auto;" onclick="mdcp.copyCode(event)">.errors()</code> 和 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">.json()</code> 之类的方法很有用，但是 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">ValidationError</code> 继承自 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">ValueError</code> 而<strong>不是</strong> <code style="user-select: auto;" onclick="mdcp.copyCode(event)">TypeError</code>，这可能是意外的，因为Python会在参数无效或缺失时引发<code style="user-select: auto;" onclick="mdcp.copyCode(event)">TypeError</code>。 将来可以通过允许自定义错误或在默认情况下引发其他异常，或同时解决两者来解决此问题。</p> 
<h4><a id="3872__5882"></a>3.8.7.2 强制和严格</h4> 
<p>pydantic目前倾向于尝试强制类型转换，而不是在类型错误的情况下引发异常，请参见[模型数据转换](# 3.1.16 数据转换)，并且 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">validate_arguments</code> 采用了相同的机制。</p> 
<p>有关此问题的讨论，请参见<a href="https://github.com/samuelcolvin/pydantic/issues/1098" target="_blank">＃1098</a> 和带有 “strictness” 标签的其他问题。 如果pydantic将来获得 “strict” 模式，<code style="user-select: auto;" onclick="mdcp.copyCode(event)">validate_arguments</code> 将具有使用此模式的选项，它甚至可能成为装饰器的默认模式。</p> 
<h4><a id="3873__5888"></a>3.8.7.3 性能</h4> 
<p>我们已经尽了最大的努力使pydantic尽可能地具有高性能(请参阅[基准测试](# 4. 基准测试)，并且仅在定义函数时才执行一次参数检查和模型创建，但是与调用原始函数相比，使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">validate_arguments</code> 装饰器仍然会对性能产生影响。</p> 
<p>在许多情况下，这几乎没有或没有明显的影响，但是请注意，<code style="user-select: auto;" onclick="mdcp.copyCode(event)">validate_arguments</code> 不是强类型语言中的函数定义的等价物或替代项，并且永远不会。</p> 
<h4><a id="3874__5894"></a>3.8.7.4 返回值</h4> 
<p>函数的返回值没有根据它的返回类型注解进行验证，这可以在将来作为一个选项添加。</p> 
<h4><a id="3875__5898"></a>3.8.7.5 配置和验证器</h4> 
<p>不支持自定义的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Config</code> 上的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">fields</code> 和 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">alias_generator</code> ，参见 [上面](# 3.8.6 自定义配置)。</p> 
<p>[验证器](# 3.3 验证器) 也不支持。</p> 
<h4><a id="3876__5904"></a>3.8.7.6 模型字段和保留参数</h4> 
<p>以下名称不能由参数使用，因为它们可以在内部用于存储有关函数签名的信息：</p> 
<ul><li><code style="user-select: auto;" onclick="mdcp.copyCode(event)">v__args</code></li><li><code style="user-select: auto;" onclick="mdcp.copyCode(event)">v__kwargs</code></li><li><code style="user-select: auto;" onclick="mdcp.copyCode(event)">v__positional_only</code></li></ul> 
<p>这些名称 (以及 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">args</code> 和 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">kwargs</code> ) 可能会也可能不会 (取决于函数的签名) 作为字段出现在可通过 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">.model</code> 访问的内部pydantic模型中。因此，目前这个模型并不是特别有用(例如，对于生成一个模式)。</p> 
<p>这在将来应该是可以解决的，因为错误的提出方式被改变了。</p> 
<h2><a name="t68"></a><a id="39__5916"></a>3.9 设置管理</h2> 
<p>pydantic 最有用的功能之一就是配置管理。如果创建一个继承自 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">BaseSettings</code> 的模型，模型初始化器将尝试从环境变量中读取未作为关键字参数传递的任何字段的值。(如果没有设置匹配的环境变量，仍然使用默认值。)</p> 
<p>这使得如下的事情变得很容易：</p> 
<ul><li>创建一个明确定义的、具有类型提示的应用程序配置类</li><li>自动从环境变量中读取对配置的修改</li><li>在需要的地方手动覆盖初始化程序中的特定设置(例如在单元测试中)</li></ul> 
<p>例如：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">import</span> os
<span class="token keyword">from</span> typing <span class="token keyword">import</span> Set

<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> <span class="token punctuation">(</span>
BaseModel<span class="token punctuation">,</span>
BaseSettings<span class="token punctuation">,</span>
PyObject<span class="token punctuation">,</span>
RedisDsn<span class="token punctuation">,</span>
PostgresDsn<span class="token punctuation">,</span>
Field<span class="token punctuation">,</span>
<span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">SubModel</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
foo <span class="token operator">=</span> <span class="token string">'bar'</span>
apple <span class="token operator">=</span> <span class="token number">1</span>


<span class="token keyword">class</span> <span class="token class-name">Settings</span><span class="token punctuation">(</span>BaseSettings<span class="token punctuation">)</span><span class="token punctuation">:</span>
auth_key<span class="token punctuation">:</span> <span class="token builtin">str</span>
api_key<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> Field<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> env<span class="token operator">=</span><span class="token string">'my_api_key'</span><span class="token punctuation">)</span>

redis_dsn<span class="token punctuation">:</span> RedisDsn <span class="token operator">=</span> <span class="token string">'redis://user:pass@localhost:6379/1'</span>
pg_dsn<span class="token punctuation">:</span> PostgresDsn <span class="token operator">=</span> <span class="token string">'postgres://user:pass@localhost:5432/foobar'</span>

special_function<span class="token punctuation">:</span> PyObject <span class="token operator">=</span> <span class="token string">'math.cos'</span>

<span class="token comment"># to override domains:</span>
<span class="token comment"># export my_prefix_domains='["foo.com", "bar.com"]'</span>
domains<span class="token punctuation">:</span> Set<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># to override more_settings:</span>
<span class="token comment"># export my_prefix_more_settings='{"foo": "x", "apple": 1}'</span>
more_settings<span class="token punctuation">:</span> SubModel <span class="token operator">=</span> SubModel<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Config</span><span class="token punctuation">:</span>
    env_prefix <span class="token operator">=</span> <span class="token string">'my_prefix_'</span>  <span class="token comment"># defaults to no prefix, i.e. ""</span>
    fields <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">'auth_key'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">'env'</span><span class="token punctuation">:</span> <span class="token string">'my_auth_key'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">'redis_dsn'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">'env'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'service_redis_dsn'</span><span class="token punctuation">,</span> <span class="token string">'redis_url'</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">'my_api_key'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'abc123'</span>
os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">'my_auth_key'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'123abc'</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>Settings<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
{
'auth_key': '123abc',
'api_key': 'abc123',
'redis_dsn': RedisDsn('redis://user:pass@localhost:6379/1', scheme='redis', user='user', password='pass', host='localhost', host_type='int_domain', port='6379', path='/1'),
'pg_dsn': PostgresDsn('postgres://user:pass@localhost:5432/foobar', scheme='postgres', user='user', password='pass', host='localhost', host_type='int_domain', port='5432', path='/foobar'),
'special_function': &lt;built-in function cos&gt;,
'domains': set(),
'more_settings': {'foo': 'bar', 'apple': 1},
}
"""</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li><li style="color: rgb(153, 153, 153);">33</li><li style="color: rgb(153, 153, 153);">34</li><li style="color: rgb(153, 153, 153);">35</li><li style="color: rgb(153, 153, 153);">36</li><li style="color: rgb(153, 153, 153);">37</li><li style="color: rgb(153, 153, 153);">38</li><li style="color: rgb(153, 153, 153);">39</li><li style="color: rgb(153, 153, 153);">40</li><li style="color: rgb(153, 153, 153);">41</li><li style="color: rgb(153, 153, 153);">42</li><li style="color: rgb(153, 153, 153);">43</li><li style="color: rgb(153, 153, 153);">44</li><li style="color: rgb(153, 153, 153);">45</li><li style="color: rgb(153, 153, 153);">46</li><li style="color: rgb(153, 153, 153);">47</li><li style="color: rgb(153, 153, 153);">48</li><li style="color: rgb(153, 153, 153);">49</li><li style="color: rgb(153, 153, 153);">50</li><li style="color: rgb(153, 153, 153);">51</li><li style="color: rgb(153, 153, 153);">52</li><li style="color: rgb(153, 153, 153);">53</li><li style="color: rgb(153, 153, 153);">54</li><li style="color: rgb(153, 153, 153);">55</li><li style="color: rgb(153, 153, 153);">56</li><li style="color: rgb(153, 153, 153);">57</li><li style="color: rgb(153, 153, 153);">58</li><li style="color: rgb(153, 153, 153);">59</li><li style="color: rgb(153, 153, 153);">60</li></ul></pre> 
<h3><a name="t69"></a><a id="391__5991"></a>3.9.1 环境变量名称</h3> 
<p>以下规则用于确定为给定字段读取哪些环境变量：</p> 
<ul><li> <p>默认情况下，环境变量名是通过连接前缀和字段名构建的：</p> 
<ul><li> <p>例如，要覆盖上面的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">special_function</code>，可以使用：</p> <pre class="prettyprint" style="user-select: auto;"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token function">export</span> my_prefix_special_function<span class="token operator">=</span><span class="token string">'foo.bar'</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> </li><li> <p>注意 1：默认前缀是空字符串。</p> </li><li> <p>注意 2：构建变量名称时字段别名将被忽略。</p> </li></ul> </li><li> <p>自定义环境变量名称可以使用两种方法设置：</p> 
<ul><li><code style="user-select: auto;" onclick="mdcp.copyCode(event)">Config.fields['field_name']['env']</code> (参见上面的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">auth_key</code> 和 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">redis_dsn</code> )</li><li><code style="user-select: auto;" onclick="mdcp.copyCode(event)">Field(..., env=...)</code> (参见上面的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">api_key</code> )</li></ul> </li><li> <p>当指定了自定义环境变量名称时，可以提供一个字符串或者一个字符串列表。</p> 
<ul><li>当指定一个字符串列表时，顺序很重要：第一个发现的值将被使用。</li><li>例如，对于上面的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">redis_dns</code>，<code style="user-select: auto;" onclick="mdcp.copyCode(event)">service_redis_dns</code> 比 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">redis_url</code> 的优先级要高。</li></ul> </li></ul> 
<blockquote> 
<p><mark>警告</mark></p> 
<p>由于在查找环境变量来填充设置模型时，<strong>v1.0</strong> pydantic不考虑字段别名，所以按照上面的描述使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">env</code> 代替。</p> 
<p>为了帮助从别名过渡到 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">env</code>，当在没有自定义 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">env</code> 变量名称的设置模型上使用别名时，将发出警告。如果您真的打算使用别名，那么可以忽略警告，或者设置 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">env</code> 来禁止它。</p> 
</blockquote> 
<p>大小写敏感可以通过 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Config</code> 开启：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseSettings


<span class="token keyword">class</span> <span class="token class-name">Settings</span><span class="token punctuation">(</span>BaseSettings<span class="token punctuation">)</span><span class="token punctuation">:</span>
redis_host <span class="token operator">=</span> <span class="token string">'localhost'</span>

<span class="token keyword">class</span> <span class="token class-name">Config</span><span class="token punctuation">:</span>
    case_sensitive <span class="token operator">=</span> <span class="token boolean">True</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li></ul></pre> 
<p>当 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">case_sensitive</code> 为 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">True</code> 时，环境变量名必须匹配字段名(可选带有前缀)，因此在本例中只能通过 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">export redis_host</code> 修改<code style="user-select: auto;" onclick="mdcp.copyCode(event)">redis_host</code>。如果希望将环境变量命名为全大写，那么也应该将属性命名为全大写。您仍然可以通过 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Field(..., env=...)</code> 随意命名环境变量。</p> 
<blockquote> 
<p><mark>注意</mark></p> 
<p>在Windows上，Python的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">os</code> 模块总是将环境变量视为大小写不敏感的，因此 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">case_sensitive</code> 配置设置将不起作用——设置将总是被更新为忽略大小写。</p> 
</blockquote> 
<h3><a name="t70"></a><a id="392__6042"></a>3.9.2 解析环境变量</h3> 
<p>对于大多数简单的字段类型(比如 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">int</code>、<code style="user-select: auto;" onclick="mdcp.copyCode(event)">float</code>、<code style="user-select: auto;" onclick="mdcp.copyCode(event)">str</code> 等)，环境变量值的解析方式与直接传递给初始化器(作为字符串)的方式相同。</p> 
<p>复杂类型，如 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">List</code>、<code style="user-select: auto;" onclick="mdcp.copyCode(event)">Set</code>、<code style="user-select: auto;" onclick="mdcp.copyCode(event)">Dict</code> 和子模型，通过将环境变量的值作为JSON编码的字符串来填充。</p> 
<h3><a name="t71"></a><a id="393_Dotenv_env_6048"></a>3.9.3 Dotenv (.env)支持</h3> 
<blockquote> 
<p><mark>注意</mark></p> 
<p>dotenv文件解析需要安装 <a href="https://pypi.org/project/python-dotenv/" target="_blank">python-dotenv</a>。这可以通过 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">pip install python-dotenv</code> 或 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">pip install pydantic[dotenv]</code> 来完成。</p> 
</blockquote> 
<p>Dotenv文件 (通常命名为 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">.env</code> ) 是一种常见的模式，它可以方便地以独立于平台的方式使用环境变量。</p> 
<p>dotenv文件遵循与所有环境变量相同的一般原则，看起来如下：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-sh has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"># ignore comment
ENVIRONMENT="production"
REDIS_ADDRESS=localhost:6379
MEANING_OF_LIFE=42
MY_VAR='Hello world'
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li></ul></pre> 
<p>在 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">.env</code> 文件中填充变量后，pydantic支持通过两种方式加载该文件：</p> 
<ol><li> <p>在 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">BaseSetting</code> 类中的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Config</code> 上设置 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">env_file</code> (和 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">env_file_encoding</code> ，如果你不想使用 OS 的默认编码的话)。</p> <pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">class</span> <span class="token class-name">Settings</span><span class="token punctuation">(</span>BaseSettings<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token keyword">class</span> <span class="token class-name">Config</span><span class="token punctuation">:</span>
    env_file <span class="token operator">=</span> <span class="token string">'.env'</span>
    env_file_encoding <span class="token operator">=</span> <span class="token string">'utf-8'</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li></ul></pre> </li><li> <p>使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">_env_file</code> 关键字参数 (和 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">_env_file_encoding</code>，如果需要) 实例化 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">BaseSettings</code> 派生类：</p> <pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;">settings <span class="token operator">=</span> Settings<span class="token punctuation">(</span>_env_file<span class="token operator">=</span><span class="token string">'prod.env'</span><span class="token punctuation">,</span> _env_file_encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> </li></ol> 
<p>无论哪种情况，传递的参数的值都可以是任何有效路径或文件名，可以是绝对路径或相对于当前工作目录的相对路径。pydantic将从那里通过加载变量并对其进行验证来为您处理所有事情。</p> 
<p>即使使用dotenv文件，pydantic仍将读取环境变量以及dotenv文件，<strong>环境变量将始终优先于从dotenv文件加载的值</strong>。</p> 
<p>在实例化时(方法2)通过 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">_env_file</code> 关键字参数传递文件路径将覆盖 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Config</code> 类上设置的值(如果有)。如果以上代码段结合使用，则将加载 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">prod.env</code>，而将忽略 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">.env</code>。</p> 
<p>还可以通过将 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">None</code> 作为实例化关键字参数传递给 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">BaseSettings</code> 的派生类的初始化方法来使用关键字参数覆盖来告诉Pydantic根本不加载任何文件 (即使在 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Config</code> 类中设置了一个文件），例如 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">settings = Settings(_env_file = None)</code>。</p> 
<p>由于使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">python-dotenv</code> 来解析文件，因此可以使用类似于bash的语义(例如 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">export</code>) (取决于操作系统和环境) 来允许dotenv文件也与 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">source</code> 一起使用，请参阅 <a href="https://saurabh-kumar.com/python-dotenv/#usages" target="_blank">python-dotenv的文档</a> 以了解更多详细信息。</p> 
<h3><a name="t72"></a><a id="394__6095"></a>3.9.4 安全支持</h3> 
<p>在文件中放置机密值是一种常见的模式，可以为应用程序提供敏感的配置。</p> 
<p>安全文件遵循与dotenv文件相同的主体，只是它只包含一个值，并且文件名用作键。 机密文件如下所示：</p> 
<p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">/var/run/database_password</code>：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-ini has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;">super_secret_database_password
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>一旦有了安全文件，可以使用两种方式来加载：</p> 
<ol><li> <p>在 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">BaseSettings</code> 类的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Config</code> 中将 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">secrets_dir</code> 设置为安全文件所在的目录：</p> <pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">class</span> <span class="token class-name">Settings</span><span class="token punctuation">(</span>BaseSettings<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
database_password<span class="token punctuation">:</span> <span class="token builtin">str</span>

<span class="token keyword">class</span> <span class="token class-name">Config</span><span class="token punctuation">:</span>
    secrets_dir <span class="token operator">=</span> <span class="token string">'/var/run'</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li></ul></pre> </li><li> <p>使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">_secret_dir</code> 关键字参数实例化 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">BaseSettings</code> 的派生类：</p> <pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;">settings <span class="token operator">=</span> Settings<span class="token punctuation">(</span>_secrets_dir<span class="token operator">=</span><span class="token string">'/var/run'</span><span class="token punctuation">)</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> </li></ol> 
<p>无论哪种情况，传递的参数值可以是任意有效的目录，或者到当前工作目录的相对或绝对路径。pydantic将从那里通过加载变量并验证它们来为您处理一切。</p> 
<p>即使使用安全目录，pydantic 仍然会从 dotenv 文件或环境读取环境变量，<strong>dotenv文件和环境变量总是优先于从安全目录中读取的值</strong>。</p> 
<p>在初始化时通过 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">_secrets_dir</code> 关键字参数传递的文件路径将会覆盖在 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Config</code> 上设置的值(如果有的话)。</p> 
<h4><a id="3941_Docker_Secrets_6132"></a>3.9.4.1 用例：Docker Secrets</h4> 
<p>Docker Secrets可用于为在Docker容器中运行的应用程序提供敏感的配置。 要在一个pytantic应用程序中使用这些机密，过程很简单。 有关在Docker中创建、管理和使用机密的更多信息，请参阅<a href="https://docs.docker.com/engine/reference/commandline/secret/" target="_blank">Docker官方文档</a>。</p> 
<p>首先，定义 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Settings</code> 类：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">class</span> <span class="token class-name">Settings</span><span class="token punctuation">(</span>BaseSettings<span class="token punctuation">)</span><span class="token punctuation">:</span>
my_secret_data<span class="token punctuation">:</span> <span class="token builtin">str</span>

<span class="token keyword">class</span> <span class="token class-name">Config</span><span class="token punctuation">:</span>
    secrets_dir <span class="token operator">=</span> <span class="token string">'/run/secrets'</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li></ul></pre> 
<blockquote> 
<p><mark>注意</mark></p> 
<p>默认情况下，Docker使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">/run/secrets</code> 作为目标挂载点。如果你想使用一个不同的位置，改变相应地 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Config.secrets_dir</code>。</p> 
</blockquote> 
<p>然后，通过 Docker 命令行接口创建机密：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token function">printf</span> <span class="token string">"This is a secret"</span> <span class="token operator">|</span> docker secret create my_secret_data -
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>最后，运行 Docker 容器内的应用程序并提供新创建的机密：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;">docker <span class="token function">service</span> create --name pydantic-with-secrets --secret my_secret_data pydantic-app:latest
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<h3><a name="t73"></a><a id="395__6162"></a>3.9.5 字段值优先级</h3> 
<p>如果同一个设置字段有多种方式指定一个值，则选择的值按以下优先级降序确定：</p> 
<ol><li>传递给 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Settings</code> 类的初始化器的参数。</li><li>环境变量，例如上面描述的 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">my_prefix_special_function</code> 。</li><li>从 dotenv( <code style="user-select: auto;" onclick="mdcp.copyCode(event)">.env</code> 文件) 加载的变量。</li><li>从机密目录加载的变量。</li><li><code style="user-select: auto;" onclick="mdcp.copyCode(event)">Settings</code> 模型的默认字段值。</li></ol> 
<h2><a name="t74"></a><a id="310__6172"></a>3.10 延迟注解</h2> 
<blockquote> 
<p><mark>注意</mark></p> 
<p>通过 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">future</code> 导入和 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">ForwardRef</code> 的延迟注解都需要python 3.7以上。</p> 
</blockquote> 
<p>延迟注解 (如 <a href="https://www.python.org/dev/peps/pep-0563/" target="_blank">PEP563</a> 所述) “just work”。</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> __future__ <span class="token keyword">import</span> annotations
<span class="token keyword">from</span> typing <span class="token keyword">import</span> List
<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel


<span class="token keyword">class</span> <span class="token class-name">Model</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
a<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span>


<span class="token keyword">print</span><span class="token punctuation">(</span>Model<span class="token punctuation">(</span>a<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; a=[1, 2, 3]</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li></ul></pre> 
<p>在内部，pydantic将调用类似于 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">typing.get_type_hints</code> 的方法来解析注解。</p> 
<p>在引用类型尚未定义的情况下，可以使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">ForwardRef</code> (尽管在自引用模型的情况下直接引用类型或通过它的字符串引用是一个更简单的解决方案)。</p> 
<p>在某些情况下，一个 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">ForwardRef</code> 将不能在模型创建期间被解析。例如，当模型将自身引用为字段类型时，就会发生这种情况。当这种情况发生时，您需要在模型创建后调用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">update_forward_refs</code>，然后才能使用它：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> typing <span class="token keyword">import</span> ForwardRef
<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel

Foo <span class="token operator">=</span> ForwardRef<span class="token punctuation">(</span><span class="token string">'Foo'</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
a<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">123</span>
b<span class="token punctuation">:</span> Foo <span class="token operator">=</span> <span class="token boolean">None</span>


Foo<span class="token punctuation">.</span>update_forward_refs<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>Foo<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; a=123 b=None</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>Foo<span class="token punctuation">(</span>b<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'a'</span><span class="token punctuation">:</span> <span class="token string">'321'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; a=123 b=Foo(a=321, b=None)</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li></ul></pre> 
<blockquote> 
<p><mark>警告</mark></p> 
<p>为了将字符串(类型名称)解析为注解(类型)，pydantic需要一个名称空间字典来执行查找。 为此，它使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">module.__dict__</code>，就像 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">get_type_hints</code> 一样。 这意味着pydantic可能无法与模块的全局范围中未定义的类型配合使用。</p> 
</blockquote> 
<p>例如，下面的实例可以正常运行：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> __future__ <span class="token keyword">import</span> annotations
<span class="token keyword">from</span> typing <span class="token keyword">import</span> List  <span class="token comment"># &lt;-- List is defined in the module's global scope</span>
<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel


<span class="token keyword">def</span> <span class="token function">this_works</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token keyword">class</span> <span class="token class-name">Model</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
    a<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>Model<span class="token punctuation">(</span>a<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li></ul></pre> 
<p>而下面的则不行：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> __future__ <span class="token keyword">import</span> annotations
<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel


<span class="token keyword">def</span> <span class="token function">this_is_broken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token comment"># List is defined inside the function so is not in the module's</span>
<span class="token comment"># global scope!</span>
<span class="token keyword">from</span> typing <span class="token keyword">import</span> List

<span class="token keyword">class</span> <span class="token class-name">Model</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
    a<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>Model<span class="token punctuation">(</span>a<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li></ul></pre> 
<p>解决这个问题超出了pydantic的要求：要么删除 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">future</code> 的导入，要么全局声明类型。</p> 
<h3><a name="t75"></a><a id="3101__6259"></a>3.10.1 自引用模型</h3> 
<p>如果创建模型后调用了 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">update_forward_refs()</code> 函数，则还支持具有自引用模型的数据结构 (果您忘记了，将会提示一条友好的错误消息)。</p> 
<p>在模型中，可以使用字符串引用尚未构建的模型：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel


<span class="token keyword">class</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
a<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">123</span>
<span class="token comment">#: The sibling of `Foo` is referenced by string</span>
sibling<span class="token punctuation">:</span> <span class="token string">'Foo'</span> <span class="token operator">=</span> <span class="token boolean">None</span>


Foo<span class="token punctuation">.</span>update_forward_refs<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>Foo<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; a=123 sibling=None</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>Foo<span class="token punctuation">(</span>sibling<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'a'</span><span class="token punctuation">:</span> <span class="token string">'321'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; a=123 sibling=Foo(a=321, sibling=None)</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li></ul></pre> 
<p>从python 3.7开始，您还可以按其类型引用它，前提是您导入了 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">annotations</code> (请参见上文，具体取决于Python和pydantic版本)。</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> __future__ <span class="token keyword">import</span> annotations
<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel


<span class="token keyword">class</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
a<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">123</span>
<span class="token comment">#: The sibling of `Foo` is referenced directly by type</span>
sibling<span class="token punctuation">:</span> Foo <span class="token operator">=</span> <span class="token boolean">None</span>


Foo<span class="token punctuation">.</span>update_forward_refs<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>Foo<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; a=123 sibling=None</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>Foo<span class="token punctuation">(</span>sibling<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'a'</span><span class="token punctuation">:</span> <span class="token string">'321'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; a=123 sibling=Foo(a=321, sibling=None)</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li></ul></pre> 
<h2><a name="t76"></a><a id="311__mypy__6304"></a>3.11 与 mypy 一起使用</h2> 
<p>pydantic模型与mypy一起工作，只要你使用仅注解版本的必需字段：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime
<span class="token keyword">from</span> typing <span class="token keyword">import</span> List<span class="token punctuation">,</span> Optional
<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel<span class="token punctuation">,</span> NoneStr


<span class="token keyword">class</span> <span class="token class-name">Model</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
age<span class="token punctuation">:</span> <span class="token builtin">int</span>
first_name <span class="token operator">=</span> <span class="token string">'John'</span>
last_name<span class="token punctuation">:</span> NoneStr <span class="token operator">=</span> <span class="token boolean">None</span>
signup_ts<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>datetime<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span>
list_of_ints<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span>


m <span class="token operator">=</span> Model<span class="token punctuation">(</span>age<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">,</span> list_of_ints<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">,</span> b<span class="token string">'3'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>middle_name<span class="token punctuation">)</span>  <span class="token comment"># not a model field!</span>
Model<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># will raise a validation error for age and list_of_ints</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li></ul></pre> 
<p>可以通过下面的方式使用 mypy 运行你的代码：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;">mypy \
--ignore-missing-imports \
--follow-imports<span class="token operator">=</span>skip \
--strict-optional \
pydantic_mypy_test.py
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li></ul></pre> 
<p>如果你在上面的示例代码上调用 mypy，将会看到 mypy 发现了属性访问错误：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-ini has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;">13: error: "Model" has no attribute "middle_name"
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<h3><a name="t77"></a><a id="3111__6343"></a>3.11.1 严格模式</h3> 
<p>为了让您的代码在使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">--strict-optional</code> 选项时能够通过，您需要为所有字段使用 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Optional[]</code> 或 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Optional[]</code> 的别名，并将字段默认值设置为 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">None</code>。(这是mypy的标准。)</p> 
<p>Pydantic提供了一些有用的可选或联合类型：</p> 
<ul><li><code style="user-select: auto;" onclick="mdcp.copyCode(event)">NoneStr</code>，即 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Optional[str]</code></li><li><code style="user-select: auto;" onclick="mdcp.copyCode(event)">NoneBytes</code>，即 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Optional[bytes]</code></li><li><code style="user-select: auto;" onclick="mdcp.copyCode(event)">StrBytes</code>，即 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Union[str, bytes]</code></li><li><code style="user-select: auto;" onclick="mdcp.copyCode(event)">NoneStrBytes</code>，即 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">Optional[StrBytes]</code></li></ul> 
<p>这些还不够，你当然可以自己定义。</p> 
<h2><a name="t78"></a><a id="312__devtools__6356"></a>3.12 与 devtools 一起使用</h2> 
<blockquote> 
<p><mark>注意</mark></p> 
<p><code style="user-select: auto;" onclick="mdcp.copyCode(event)">python-devtools</code> 由 Pydantic 的主要开发者开发。</p> 
</blockquote> 
<p><a href="https://python-devtools.helpmanual.io/" target="_blank">python-devtools</a>（ <code style="user-select: auto;" onclick="mdcp.copyCode(event)">pip install devtools</code> ）提供了许多在python开发期间有用的工具，包括 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">debug()</code> 。这是 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">print()</code> 的一个替代品，它能提供更易阅读的格式化输出，并显式打印语句位于哪个文件的哪个行上，以及打印了什么值。</p> 
<p>pydantic通过在大多数公共类上实现 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">__pretty__</code> 方法与 <em>devtools</em> 集成。</p> 
<p>特别是在检查模型时，<code style="user-select: auto;" onclick="mdcp.copyCode(event)">debug()</code> 很有用：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime
<span class="token keyword">from</span> typing <span class="token keyword">import</span> List
<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel

<span class="token keyword">from</span> devtools <span class="token keyword">import</span> debug


<span class="token keyword">class</span> <span class="token class-name">Address</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
street<span class="token punctuation">:</span> <span class="token builtin">str</span>
country<span class="token punctuation">:</span> <span class="token builtin">str</span>
lat<span class="token punctuation">:</span> <span class="token builtin">float</span>
lng<span class="token punctuation">:</span> <span class="token builtin">float</span>


<span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token builtin">id</span><span class="token punctuation">:</span> <span class="token builtin">int</span>
name<span class="token punctuation">:</span> <span class="token builtin">str</span>
signup_ts<span class="token punctuation">:</span> datetime
friends<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span>
address<span class="token punctuation">:</span> Address


user <span class="token operator">=</span> User<span class="token punctuation">(</span>
<span class="token builtin">id</span><span class="token operator">=</span><span class="token string">'123'</span><span class="token punctuation">,</span>
name<span class="token operator">=</span><span class="token string">'John Doe'</span><span class="token punctuation">,</span>
signup_ts<span class="token operator">=</span><span class="token string">'2019-06-01 12:22'</span><span class="token punctuation">,</span>
friends<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1234</span><span class="token punctuation">,</span> <span class="token number">4567</span><span class="token punctuation">,</span> <span class="token number">7890</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
address<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>street<span class="token operator">=</span><span class="token string">'Testing'</span><span class="token punctuation">,</span> country<span class="token operator">=</span><span class="token string">'uk'</span><span class="token punctuation">,</span> lat<span class="token operator">=</span><span class="token number">51.5</span><span class="token punctuation">,</span> lng<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
debug<span class="token punctuation">(</span>user<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\nshould be much easier read than:\n'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'user:'</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li></ul></pre> 
<p>将会在终端打印如下输出：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;">docs/examples/devtools_main.py:31 <span class="token operator">&lt;</span>module<span class="token operator">&gt;</span>
user: User<span class="token punctuation">(</span>
    id<span class="token operator">=</span>123,
    name<span class="token operator">=</span><span class="token string">'John Doe'</span>,
    signup_ts<span class="token operator">=</span>datetime.datetime<span class="token punctuation">(</span>2019, 6, 1, 12, 22<span class="token punctuation">)</span>,
    friends<span class="token operator">=</span><span class="token punctuation">[</span>
        1234,
        4567,
        7890,
    <span class="token punctuation">]</span>,
    address<span class="token operator">=</span>Address<span class="token punctuation">(</span>
        street<span class="token operator">=</span><span class="token string">'Testing'</span>,
        country<span class="token operator">=</span><span class="token string">'uk'</span>,
        lat<span class="token operator">=</span>51.5,
        lng<span class="token operator">=</span>0.0,
    <span class="token punctuation">)</span>,
<span class="token punctuation">)</span> <span class="token punctuation">(</span>User<span class="token punctuation">)</span>

should be much easier <span class="token function">read</span> than:

user: id<span class="token operator">=</span>123 name<span class="token operator">=</span><span class="token string">'John Doe'</span> signup_ts<span class="token operator">=</span>datetime.datetime<span class="token punctuation">(</span>2019, 6, 1, 12, 22<span class="token punctuation">)</span> friends<span class="token operator">=</span><span class="token punctuation">[</span>1234, 4567, 7890<span class="token punctuation">]</span> address<span class="token operator">=</span>Address<span class="token punctuation">(</span>street<span class="token operator">=</span><span class="token string">'Testing'</span>, country<span class="token operator">=</span><span class="token string">'uk'</span>, lat<span class="token operator">=</span>51.5, lng<span class="token operator">=</span>0.0<span class="token punctuation">)</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li></ul></pre> 
<h1><a name="t79"></a><a id="4__6429"></a>4. 基准测试</h1> 
<p>以下是将pydantic与其他验证库进行比较的原始基准测试结果。</p> 
<div class="table-box"><table><thead><tr><th>pydantic</th><th><code style="user-select: auto;" onclick="mdcp.copyCode(event)">1.1</code></th><th></th><th>43.6μs</th></tr></thead><tbody><tr><td>attrs + cattrs</td><td><code style="user-select: auto;" onclick="mdcp.copyCode(event)">19.3.0</code></td><td>1.4x slower</td><td>59.9μs</td></tr><tr><td>valideer</td><td><code style="user-select: auto;" onclick="mdcp.copyCode(event)">0.4.2</code></td><td>1.4x slower</td><td>61.8μs</td></tr><tr><td>marshmallow</td><td><code style="user-select: auto;" onclick="mdcp.copyCode(event)">3.2.2</code></td><td>2.5x slower</td><td>107.6μs</td></tr><tr><td>trafaret</td><td><code style="user-select: auto;" onclick="mdcp.copyCode(event)">2.0.0</code></td><td>3.4x slower</td><td>148.7μs</td></tr><tr><td>django-rest-framework</td><td><code style="user-select: auto;" onclick="mdcp.copyCode(event)">3.10.3</code></td><td>12.6x slower</td><td>551.2μs</td></tr><tr><td>cerberus</td><td><code style="user-select: auto;" onclick="mdcp.copyCode(event)">1.3.2</code></td><td>26.3x slower</td><td>1146.3μs</td></tr></tbody></table></div>
<p>有关测试用例的更多详细信息，请参见<a href="https://github.com/samuelcolvin/pydantic/tree/master/benchmarks" target="_blank">基准代码</a>。 随意建议更多软件包以进行基准测试或改进现有软件包。</p> 
<p>基准测试是使用Python 3.7.4运行的，上面列出的软件包版本是通过pypi在Ubuntu 18.04上安装的。</p> 
<h1><a name="t80"></a><a id="5_Mypy__6446"></a>5. Mypy 插件</h1> 
<p>由于个人不使用 mypy，故略过。</p> 
<p>详情请参考<a href="https://pydantic-docs.helpmanual.io/mypy_plugin/" target="_blank">英文文档</a>。</p> 
<h1><a name="t81"></a><a id="6_Pycharm__6452"></a>6. Pycharm 插件</h1> 
<p>尽管pydantic可以与任何现成的IDE很好地兼容，但JetBrains插件存储库中的PyCharm可以使用提供改进的pydantic集成的PyCharm插件。 您可以从插件市场免费安装插件(PyCharm的Preferences-&gt;Plugin-&gt;Marketplace-&gt;搜索 “pydantic”）。</p> 
<p>该插件当前支持以下功能：</p> 
<ul><li>对 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">pydantic.BaseModel.__init__</code> 进行： 
<ul><li>审查</li><li>自动补全</li><li>类型检查</li></ul> </li><li>对 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">pydantic.BaseModel</code> 的字段进行： 
<ul><li>重构重命名字段会更新 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">__init__</code> 调用，并影响子类和超类；<br> 重构重命名 <code style="user-select: auto;" onclick="mdcp.copyCode(event)">__init__</code> 关键字参数会更新字段名称，并影响子类和超类；</li></ul> </li></ul> 
<p>可以在<a href="https://plugins.jetbrains.com/plugin/12861-pydantic" target="_blank">官方插件页面</a>和<a href="https://github.com/koxudaxi/pydantic-pycharm-plugin" target="_blank">Github存储库</a>中找到更多信息。</p> 
<h1><a name="t82"></a><a id="7__6468"></a>7. 代码生成</h1> 
<p><a href="https://github.com/koxudaxi/datamodel-code-generator/" target="_blank">datamodel-code-generator</a> 项目是一个库和命令行实用程序，可从几乎任何数据源生成pydantic模型，包括：</p> 
<ul><li>OpenAPI 3 (YAML/JSON)</li><li>JSON 模式</li><li>JSON/YAML 数据 (将会转变为 JSON 模式)</li></ul> 
<p>当您发现自己有任何JSON可转换数据但没有pydantic模型时，此工具将允许您根据需要生成类型安全的模型层次结构。</p> 
<h2><a name="t83"></a><a id="71__6478"></a>7.1 安装</h2> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;">pip <span class="token function">install</span> datamodel-code-generator
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<h2><a name="t84"></a><a id="72__6484"></a>7.2 示例</h2> 
<p>在这种情况下，datamodel-code-generator 从一个 JSON 模式文件创建 pydantic 模型：</p> 
<p>Person.json：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-json has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token punctuation">{<!-- --></span>
<span class="token string">"$id"</span><span class="token punctuation">:</span> <span class="token string">"person.json"</span><span class="token punctuation">,</span>
<span class="token string">"$schema"</span><span class="token punctuation">:</span> <span class="token string">"http://json-schema.org/draft-07/schema#"</span><span class="token punctuation">,</span>
<span class="token string">"title"</span><span class="token punctuation">:</span> <span class="token string">"Person"</span><span class="token punctuation">,</span>
<span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"object"</span><span class="token punctuation">,</span>
<span class="token string">"properties"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
<span class="token string">"first_name"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
  <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span>
  <span class="token string">"description"</span><span class="token punctuation">:</span> <span class="token string">"The person's first name."</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token string">"last_name"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
  <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span>
  <span class="token string">"description"</span><span class="token punctuation">:</span> <span class="token string">"The person's last name."</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token string">"age"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
  <span class="token string">"description"</span><span class="token punctuation">:</span> <span class="token string">"Age in years."</span><span class="token punctuation">,</span>
  <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"integer"</span><span class="token punctuation">,</span>
  <span class="token string">"minimum"</span><span class="token punctuation">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token string">"pets"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
  <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"array"</span><span class="token punctuation">,</span>
  <span class="token string">"items"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span>
      <span class="token string">"$ref"</span><span class="token punctuation">:</span> <span class="token string">"#/definitions/Pet"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token string">"comment"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
  <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"null"</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token string">"required"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
  <span class="token string">"first_name"</span><span class="token punctuation">,</span>
  <span class="token string">"last_name"</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token string">"definitions"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
<span class="token string">"Pet"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
  <span class="token string">"properties"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"string"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">"age"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"integer"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li><li style="color: rgb(153, 153, 153);">33</li><li style="color: rgb(153, 153, 153);">34</li><li style="color: rgb(153, 153, 153);">35</li><li style="color: rgb(153, 153, 153);">36</li><li style="color: rgb(153, 153, 153);">37</li><li style="color: rgb(153, 153, 153);">38</li><li style="color: rgb(153, 153, 153);">39</li><li style="color: rgb(153, 153, 153);">40</li><li style="color: rgb(153, 153, 153);">41</li><li style="color: rgb(153, 153, 153);">42</li><li style="color: rgb(153, 153, 153);">43</li><li style="color: rgb(153, 153, 153);">44</li><li style="color: rgb(153, 153, 153);">45</li><li style="color: rgb(153, 153, 153);">46</li><li style="color: rgb(153, 153, 153);">47</li><li style="color: rgb(153, 153, 153);">48</li></ul></pre> 
<p>model.py：</p> 
<pre class="prettyprint" style="user-select: auto;"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset; user-select: auto;"><span class="token comment"># generated by datamodel-codegen:</span>
<span class="token comment">#   filename:  person.json</span>
<span class="token comment">#   timestamp: 2020-05-19T15:07:31+00:00</span>
<span class="token keyword">from</span> __future__ <span class="token keyword">import</span> annotations
<span class="token keyword">from</span> typing <span class="token keyword">import</span> Any<span class="token punctuation">,</span> List<span class="token punctuation">,</span> Optional
<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel<span class="token punctuation">,</span> Field<span class="token punctuation">,</span> conint


<span class="token keyword">class</span> <span class="token class-name">Pet</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
name<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span>
age<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span>


<span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
first_name<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> Field<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> description<span class="token operator">=</span><span class="token string">"The person's first name."</span><span class="token punctuation">)</span>
last_name<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> Field<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> description<span class="token operator">=</span><span class="token string">"The person's last name."</span><span class="token punctuation">)</span>
age<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>conint<span class="token punctuation">(</span>ge<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> Field<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> description<span class="token operator">=</span><span class="token string">'Age in years.'</span><span class="token punctuation">)</span>
pets<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>List<span class="token punctuation">[</span>Pet<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span>
comment<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>Any<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span>
<div class="hljs-button {2}" data-title="免登录复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}" onclick="hljs.copyCode(event)"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li></ul></pre> 
<p>更多信息，请参考 <a href="https://koxudaxi.github.io/datamodel-code-generator/" target="_blank">官方文档</a>。</p>
            </div><div data-report-view="{&quot;mod&quot;:&quot;1585297308_001&quot;,&quot;spm&quot;:&quot;1001.2101.3001.6548&quot;,&quot;dest&quot;:&quot;https://blog.csdn.net/swinfans/article/details/89629641&quot;,&quot;extend1&quot;:&quot;pc&quot;,&quot;ab&quot;:&quot;new&quot;}"><div></div></div>
            <link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-89f5acb30b.css" rel="stylesheet">
            <link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-49037e4d27.css" rel="stylesheet">
    </div>
    
</article>
</body>